<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Chain.Direct.TxTraceSpec</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Semigroup.Internal.html#Any"><span class="hs-identifier">Any</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.State.Strict.html#State"><span class="hs-identifier">State</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-keyword">label</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">show</span></span><span class="hs-special">)</span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Hydra.Prelude</span></span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.OldList.html#%5C%5C"><span class="hs-operator">(\\)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/time-1.12.2/src/Data.Time.Clock.POSIX.html"><span class="hs-identifier">Data.Time.Clock.POSIX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/time-1.12.2/src/Data.Time.Clock.POSIX.html#posixSecondsToUTCTime"><span class="hs-identifier">posixSecondsToUTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkTxOutDatumInline</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">renderTxWithUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Contract.Mutation.html"><span class="hs-identifier">Hydra.Chain.Direct.Contract.Mutation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.Direct.Contract.Mutation.html#addParticipationTokens"><span class="hs-identifier">addParticipationTokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.Fixture</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Fixture</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.ScriptRegistry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ScriptRegistry</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genScriptRegistry</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">registryUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ChainContext</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">close</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">contest</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.Tx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HeadObservation</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">headIdToCurrencySymbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkHeadId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkHeadOutput</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">observeHeadTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.Tx</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tx</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.ContestationPeriod</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CP</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadState</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Head</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Crypto</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">aggregate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sign</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Ledger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hashUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Ledger.Cardano</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">adjustUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genUTxOFor</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genVerificationKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Ledger.Cardano.Evaluate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">evaluateTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Party</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partyToChain</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Snapshot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ConfirmedSnapshot</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Snapshot</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SnapshotNumber</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">number</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Builtins</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toBuiltin</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Hydra.Fixture.html"><span class="hs-identifier">Test.Hydra.Fixture</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Hydra.Fixture.html#genForParty"><span class="hs-identifier">genForParty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Hydra.Fixture.html"><span class="hs-identifier">Test.Hydra.Fixture</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Fixture</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Property</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Smart</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">checkCoverage</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cover</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">elements</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forAll</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">oneof</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">resize</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.Monadic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">monadicIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.StateModel</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-identifier">ActionWithPolarity</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-identifier">Actions</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><span class="hs-identifier">Any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="hs-identifier">HasVariables</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getAllVariables</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><span class="hs-identifier">LookUp</span></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="hs-identifier">RunModel</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><span class="hs-identifier">StateModel</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="hs-identifier">Step</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(:=)</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="hs-identifier">VarContext</span></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><span class="hs-identifier">mkVar</span></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="hs-identifier">runActions</span></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Pretty.Simple</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pShowNoColor</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Text.Show.html"><span class="hs-identifier">Text.Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#spec"><span class="hs-identifier hs-type">spec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec</span></span><span>
</span><span id="line-50"></span><span id="spec"><span class="annot"><span class="annottext">spec :: Spec
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#spec"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Spec
forall prop.
(HasCallStack, Testable prop) =&gt;
String -&gt; prop -&gt; Spec
</span><span class="hs-identifier hs-var">prop</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;generates interesting transaction traces&quot;</span></span><span> </span><span class="annot"><span class="annottext">Property
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#prop_traces"><span class="hs-identifier hs-var">prop_traces</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; (Actions Model -&gt; Property) -&gt; Spec
forall prop.
(HasCallStack, Testable prop) =&gt;
String -&gt; prop -&gt; Spec
</span><span class="hs-identifier hs-var">prop</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;all valid transactions&quot;</span></span><span> </span><span class="annot"><span class="annottext">Actions Model -&gt; Property
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#prop_runActions"><span class="hs-identifier hs-var">prop_runActions</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#prop_traces"><span class="hs-identifier hs-type">prop_traces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span><span>
</span><span id="line-55"></span><span id="prop_traces"><span class="annot"><span class="annottext">prop_traces :: Property
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#prop_traces"><span class="hs-identifier hs-var hs-var">prop_traces</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="annottext">Gen (Actions Model) -&gt; (Actions Model -&gt; Property) -&gt; Property
forall a prop.
(Show a, Testable prop) =&gt;
Gen a -&gt; (a -&gt; prop) -&gt; Property
</span><span class="hs-identifier hs-var">forAll</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Gen (Actions Model)
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Actions</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Actions Model -&gt; Property) -&gt; Property)
-&gt; (Actions Model -&gt; Property) -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Actions_</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Smart</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679540349"><span class="annot"><span class="annottext">[Step Model]
</span><a href="#local-6989586621679540349"><span class="hs-identifier hs-var">steps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="annottext">Property -&gt; Property
forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">checkCoverage</span></span><span> </span><span class="annot"><span class="annottext">(Property -&gt; Property) -&gt; Property -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; (Bool -&gt; Property) -&gt; Property
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool -&gt; String -&gt; Bool -&gt; Property
forall prop.
Testable prop =&gt;
Double -&gt; Bool -&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">cover</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Step Model] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Step Model]
</span><a href="#local-6989586621679540349"><span class="hs-identifier hs-var">steps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;empty&quot;</span></span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><span class="annottext">Property -&gt; (Property -&gt; Property) -&gt; Property
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool -&gt; String -&gt; Property -&gt; Property
forall prop.
Testable prop =&gt;
Double -&gt; Bool -&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">cover</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Step Model] -&gt; Bool
</span><a href="#local-6989586621679540352"><span class="hs-identifier hs-var">hasFanout</span></a></span><span> </span><span class="annot"><span class="annottext">[Step Model]
</span><a href="#local-6989586621679540349"><span class="hs-identifier hs-var">steps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reach fanout&quot;</span></span><span>
</span><span id="line-61"></span><span>        </span><span class="annot"><span class="annottext">Property -&gt; (Property -&gt; Property) -&gt; Property
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool -&gt; String -&gt; Property -&gt; Property
forall prop.
Testable prop =&gt;
Double -&gt; Bool -&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">cover</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Step Model] -&gt; Int
</span><a href="#local-6989586621679540353"><span class="hs-identifier hs-var">countContests</span></a></span><span> </span><span class="annot"><span class="annottext">[Step Model]
</span><a href="#local-6989586621679540349"><span class="hs-identifier hs-var">steps</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has multiple contests&quot;</span></span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><span class="annottext">Property -&gt; (Property -&gt; Property) -&gt; Property
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool -&gt; String -&gt; Property -&gt; Property
forall prop.
Testable prop =&gt;
Double -&gt; Bool -&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">cover</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Step Model] -&gt; Bool
</span><a href="#local-6989586621679540354"><span class="hs-identifier hs-var">containSomeSnapshots</span></a></span><span> </span><span class="annot"><span class="annottext">[Step Model]
</span><a href="#local-6989586621679540349"><span class="hs-identifier hs-var">steps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has some snapshots&quot;</span></span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><span class="annottext">Property -&gt; (Property -&gt; Property) -&gt; Property
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool -&gt; String -&gt; Property -&gt; Property
forall prop.
Testable prop =&gt;
Double -&gt; Bool -&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">cover</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">5</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Step Model] -&gt; Bool
</span><a href="#local-6989586621679540355"><span class="hs-identifier hs-var">closeNonInitial</span></a></span><span> </span><span class="annot"><span class="annottext">[Step Model]
</span><a href="#local-6989586621679540349"><span class="hs-identifier hs-var">steps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;close with non initial snapshots&quot;</span></span><span>
</span><span id="line-64"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>  </span><span id="local-6989586621679540354"><span class="annot"><span class="annottext">containSomeSnapshots :: [Step Model] -&gt; Bool
</span><a href="#local-6989586621679540354"><span class="hs-identifier hs-var hs-var">containSomeSnapshots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="annottext">(Step Model -&gt; Bool) -&gt; [Step Model] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">((Step Model -&gt; Bool) -&gt; [Step Model] -&gt; Bool)
-&gt; (Step Model -&gt; Bool) -&gt; [Step Model] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-67"></span><span>      </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ActionWithPolarity</span></span><span class="hs-special">{</span><span id="local-6989586621679540363"><span class="annot"><span class="annottext">Action Model a
polarAction :: Action Model a
polarAction :: forall state a. ActionWithPolarity state a -&gt; Action state a
</span><a href="#local-6989586621679540363"><span class="hs-identifier hs-var hs-var">polarAction</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action Model a
</span><a href="#local-6989586621679540363"><span class="hs-identifier hs-var">polarAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#ProduceSnapshots"><span class="hs-identifier hs-type">ProduceSnapshots</span></a></span><span> </span><span id="local-6989586621679540368"><span class="annot"><span class="annottext">[SnapshotNumber]
</span><a href="#local-6989586621679540368"><span class="hs-identifier hs-var">snapshots</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SnapshotNumber] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[SnapshotNumber]
</span><a href="#local-6989586621679540368"><span class="hs-identifier hs-var">snapshots</span></a></span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><span class="annottext">Action Model a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621679540352"><span class="annot"><span class="annottext">hasFanout :: [Step Model] -&gt; Bool
</span><a href="#local-6989586621679540352"><span class="hs-identifier hs-var hs-var">hasFanout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="annottext">(Step Model -&gt; Bool) -&gt; [Step Model] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">((Step Model -&gt; Bool) -&gt; [Step Model] -&gt; Bool)
-&gt; (Step Model -&gt; Bool) -&gt; [Step Model] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-73"></span><span>      </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ActionWithPolarity</span></span><span class="hs-special">{</span><span id="local-6989586621679540375"><span class="annot"><span class="annottext">Action Model a
polarAction :: forall state a. ActionWithPolarity state a -&gt; Action state a
polarAction :: Action Model a
</span><span class="hs-identifier hs-var hs-var">polarAction</span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action Model a
</span><a href="#local-6989586621679540375"><span class="hs-identifier hs-var">polarAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Fanout"><span class="hs-identifier hs-type">Fanout</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><span class="annottext">Action Model a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>  </span><span id="local-6989586621679540353"><span class="annot"><span class="annottext">countContests :: [Step Model] -&gt; Int
</span><a href="#local-6989586621679540353"><span class="hs-identifier hs-var hs-var">countContests</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="annottext">[Step Model] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span>
</span><span id="line-79"></span><span>      </span><span class="annot"><span class="annottext">([Step Model] -&gt; Int)
-&gt; ([Step Model] -&gt; [Step Model]) -&gt; [Step Model] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Step Model -&gt; Bool) -&gt; [Step Model] -&gt; [Step Model]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span>
</span><span id="line-80"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ActionWithPolarity</span></span><span class="hs-special">{</span><span id="local-6989586621679540385"><span class="annot"><span class="annottext">Action Model a
polarAction :: forall state a. ActionWithPolarity state a -&gt; Action state a
polarAction :: Action Model a
</span><span class="hs-identifier hs-var hs-var">polarAction</span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action Model a
</span><a href="#local-6989586621679540385"><span class="hs-identifier hs-var">polarAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-81"></span><span>            </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Contest"><span class="hs-identifier hs-type">Contest</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-82"></span><span>            </span><span class="annot"><span class="annottext">Action Model a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-83"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>  </span><span id="local-6989586621679540355"><span class="annot"><span class="annottext">closeNonInitial :: [Step Model] -&gt; Bool
</span><a href="#local-6989586621679540355"><span class="hs-identifier hs-var hs-var">closeNonInitial</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="annottext">(Step Model -&gt; Bool) -&gt; [Step Model] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">((Step Model -&gt; Bool) -&gt; [Step Model] -&gt; Bool)
-&gt; (Step Model -&gt; Bool) -&gt; [Step Model] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-87"></span><span>      </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ActionWithPolarity</span></span><span class="hs-special">{</span><span id="local-6989586621679540393"><span class="annot"><span class="annottext">Action Model a
polarAction :: forall state a. ActionWithPolarity state a -&gt; Action state a
polarAction :: Action Model a
</span><span class="hs-identifier hs-var hs-var">polarAction</span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action Model a
</span><a href="#local-6989586621679540393"><span class="hs-identifier hs-var">polarAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-88"></span><span>        </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span class="hs-special">{</span><span id="local-6989586621679540399"><span class="annot"><span class="annottext">SnapshotNumber
snapshotNumber :: SnapshotNumber
$sel:snapshotNumber:ProduceSnapshots :: Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; SnapshotNumber
</span><a href="#local-6989586621679540399"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540399"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; SnapshotNumber -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><span class="hs-number">0</span></span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="annottext">Action Model a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#prop_runActions"><span class="hs-identifier hs-type">prop_runActions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Actions</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span><span>
</span><span id="line-92"></span><span id="prop_runActions"><span class="annot"><span class="annottext">prop_runActions :: Actions Model -&gt; Property
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#prop_runActions"><span class="hs-identifier hs-var hs-var">prop_runActions</span></a></span></span><span> </span><span id="local-6989586621679540402"><span class="annot"><span class="annottext">Actions Model
</span><a href="#local-6989586621679540402"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="annottext">PropertyM IO () -&gt; Property
forall a. Testable a =&gt; PropertyM IO a -&gt; Property
</span><span class="hs-identifier hs-var">monadicIO</span></span><span> </span><span class="annot"><span class="annottext">(PropertyM IO () -&gt; Property) -&gt; PropertyM IO () -&gt; Property
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">PropertyM IO (Annotated Model, Env IO) -&gt; PropertyM IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Actions Model -&gt; PropertyM IO (Annotated Model, Env IO)
forall state (m :: * -&gt; *).
(StateModel state, RunModel state m) =&gt;
Actions state -&gt; PropertyM m (Annotated state, Env m)
</span><span class="hs-identifier hs-var">runActions</span></span><span> </span><span class="annot"><span class="annottext">Actions Model
</span><a href="#local-6989586621679540402"><span class="hs-identifier hs-var">actions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><span class="hs-comment">-- * Model</span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">data</span><span> </span><span id="Model"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-var">Model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Model"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-var">Model</span></a></span></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Asnapshots%3AModel"><span class="annot"><span class="annottext">Model -&gt; [SnapshotNumber]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Asnapshots%3AModel"><span class="hs-identifier hs-var hs-var">snapshots</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SnapshotNumber</span></span><span class="hs-special">]</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadState%3AModel"><span class="annot"><span class="annottext">Model -&gt; State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AheadState%3AModel"><span class="hs-identifier hs-var hs-var">headState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#State"><span class="hs-identifier hs-type">State</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AutxoV%3AModel"><span class="annot"><span class="annottext">Model -&gt; Var (UTxO' (TxOut CtxUTxO Era))
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AutxoV%3AModel"><span class="hs-identifier hs-var hs-var">utxoV</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Last known, spendable UTxO.</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AalreadyContested%3AModel"><span class="annot"><span class="annottext">Model -&gt; [Actor]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AalreadyContested%3AModel"><span class="hs-identifier hs-var hs-var">alreadyContested</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679540410"><span id="local-6989586621679540421"><span id="local-6989586621679540425"><span class="annot"><span class="annottext">Int -&gt; Model -&gt; ShowS
[Model] -&gt; ShowS
Model -&gt; String
(Int -&gt; Model -&gt; ShowS)
-&gt; (Model -&gt; String) -&gt; ([Model] -&gt; ShowS) -&gt; Show Model
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Model -&gt; ShowS
showsPrec :: Int -&gt; Model -&gt; ShowS
$cshow :: Model -&gt; String
show :: Model -&gt; String
$cshowList :: [Model] -&gt; ShowS
showList :: [Model] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-keyword">data</span><span> </span><span id="State"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#State"><span class="hs-identifier hs-var">State</span></a></span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Open"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Open"><span class="hs-identifier hs-var">Open</span></a></span></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Closed"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Closed"><span class="hs-identifier hs-var">Closed</span></a></span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Final"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Final"><span class="hs-identifier hs-var">Final</span></a></span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679540432"><span id="local-6989586621679540434"><span id="local-6989586621679540437"><span class="annot"><span class="annottext">Int -&gt; State -&gt; ShowS
[State] -&gt; ShowS
State -&gt; String
(Int -&gt; State -&gt; ShowS)
-&gt; (State -&gt; String) -&gt; ([State] -&gt; ShowS) -&gt; Show State
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; State -&gt; ShowS
showsPrec :: Int -&gt; State -&gt; ShowS
$cshow :: State -&gt; String
show :: State -&gt; String
$cshowList :: [State] -&gt; ShowS
showList :: [State] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679540440"><span id="local-6989586621679540442"><span class="annot"><span class="annottext">State -&gt; State -&gt; Bool
(State -&gt; State -&gt; Bool) -&gt; (State -&gt; State -&gt; Bool) -&gt; Eq State
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: State -&gt; State -&gt; Bool
== :: State -&gt; State -&gt; Bool
$c/= :: State -&gt; State -&gt; Bool
/= :: State -&gt; State -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">data</span><span> </span><span id="Actor"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Actor"><span class="hs-identifier hs-var">Actor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Alice"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Alice"><span class="hs-identifier hs-var">Alice</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Bob"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Bob"><span class="hs-identifier hs-var">Bob</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Carol"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Carol"><span class="hs-identifier hs-var">Carol</span></a></span></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679540450"><span id="local-6989586621679540452"><span id="local-6989586621679540455"><span class="annot"><span class="annottext">Int -&gt; Actor -&gt; ShowS
[Actor] -&gt; ShowS
Actor -&gt; String
(Int -&gt; Actor -&gt; ShowS)
-&gt; (Actor -&gt; String) -&gt; ([Actor] -&gt; ShowS) -&gt; Show Actor
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Actor -&gt; ShowS
showsPrec :: Int -&gt; Actor -&gt; ShowS
$cshow :: Actor -&gt; String
show :: Actor -&gt; String
$cshowList :: [Actor] -&gt; ShowS
showList :: [Actor] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679540458"><span id="local-6989586621679540460"><span class="annot"><span class="annottext">Actor -&gt; Actor -&gt; Bool
(Actor -&gt; Actor -&gt; Bool) -&gt; (Actor -&gt; Actor -&gt; Bool) -&gt; Eq Actor
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Actor -&gt; Actor -&gt; Bool
== :: Actor -&gt; Actor -&gt; Bool
$c/= :: Actor -&gt; Actor -&gt; Bool
/= :: Actor -&gt; Actor -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679540472"><span id="local-6989586621679540476"><span id="local-6989586621679540483"><span id="local-6989586621679540489"><span class="annot"><span class="hs-identifier hs-type">StateModel</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">data</span><span> </span><span id="Action"><span class="annot"><span class="hs-identifier hs-var">Action</span></span></span><span> </span><span id="local-6989586621679540492"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540492"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>    </span><span id="ProduceSnapshots"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#ProduceSnapshots"><span class="hs-identifier hs-var">ProduceSnapshots</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SnapshotNumber</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>    </span><span id="Close"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Close"><span class="hs-identifier hs-var">Close</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span id="%24sel%3Aactor%3AProduceSnapshots"><span class="annot"><span class="annottext">Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Aactor%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">actor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span class="hs-special">,</span><span> </span><span id="%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="annot"><span class="annottext">Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotNumber</span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-120"></span><span>    </span><span id="Contest"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Contest"><span class="hs-identifier hs-var">Contest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span id="%24sel%3Aactor%3AProduceSnapshots"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Aactor%3AProduceSnapshots"><span class="hs-identifier hs-var">actor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span class="hs-special">,</span><span> </span><span id="%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="hs-identifier hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotNumber</span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-121"></span><span>    </span><span id="Fanout"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-comment">-- \| Helper action to identify the terminal state 'Final' and shorten</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-comment">-- traces using the 'precondition'.</span><span>
</span><span id="line-124"></span><span>    </span><span id="Stop"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">arbitraryAction</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VarContext</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621679540532"><span class="annot"><span class="annottext">arbitraryAction :: VarContext -&gt; Model -&gt; Gen (Any (Action Model))
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitraryAction</span></span></span><span> </span><span id="local-6989586621679540533"><span class="annot"><span class="annottext">VarContext
</span><a href="#local-6989586621679540533"><span class="hs-identifier hs-var">_lookup</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span class="hs-special">{</span><span id="local-6989586621679540534"><span class="annot"><span class="annottext">State
$sel:headState:Model :: Model -&gt; State
headState :: State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AheadState%3AModel"><span class="hs-identifier hs-var hs-var">headState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679540535"><span class="annot"><span class="annottext">[SnapshotNumber]
$sel:snapshots:Model :: Model -&gt; [SnapshotNumber]
snapshots :: [SnapshotNumber]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Asnapshots%3AModel"><span class="hs-identifier hs-var hs-var">snapshots</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679540536"><span class="annot"><span class="annottext">[Actor]
$sel:alreadyContested:Model :: Model -&gt; [Actor]
alreadyContested :: [Actor]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AalreadyContested%3AModel"><span class="hs-identifier hs-var hs-var">alreadyContested</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679540534"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Open"><span class="hs-identifier hs-var">Open</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><span class="annottext">[Gen (Any (Action Model))] -&gt; Gen (Any (Action Model))
forall a. [Gen a] -&gt; Gen a
</span><span class="hs-identifier hs-var">oneof</span></span><span>
</span><span id="line-131"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- NOTE: non-continuous snapshot numbers are allowed in this model</span><span>
</span><span id="line-132"></span><span>            </span><span class="annot"><span class="annottext">Action Model () -&gt; Any (Action Model)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action Model () -&gt; Any (Action Model))
-&gt; ([SnapshotNumber] -&gt; Action Model ())
-&gt; [SnapshotNumber]
-&gt; Any (Action Model)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[SnapshotNumber] -&gt; Action Model ()
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#ProduceSnapshots"><span class="hs-identifier hs-var">ProduceSnapshots</span></a></span><span> </span><span class="annot"><span class="annottext">([SnapshotNumber] -&gt; Any (Action Model))
-&gt; Gen [SnapshotNumber] -&gt; Gen (Any (Action Model))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Gen [SnapshotNumber]
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-133"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>              </span><span id="local-6989586621679540539"><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540539"><span class="hs-identifier hs-var">actor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Actor] -&gt; Gen Actor
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#allActors"><span class="hs-identifier hs-var">allActors</span></a></span><span>
</span><span id="line-135"></span><span>              </span><span id="local-6989586621679540541"><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540541"><span class="hs-identifier hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SnapshotNumber] -&gt; Gen SnapshotNumber
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SnapshotNumber
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; [SnapshotNumber] -&gt; [SnapshotNumber]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[SnapshotNumber]
</span><a href="#local-6989586621679540535"><span class="hs-identifier hs-var">snapshots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>              </span><span class="annot"><span class="annottext">Any (Action Model) -&gt; Gen (Any (Action Model))
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action Model) -&gt; Gen (Any (Action Model)))
-&gt; Any (Action Model) -&gt; Gen (Any (Action Model))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; Any (Action Model)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; Any (Action Model))
-&gt; Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; Any (Action Model)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">Actor
$sel:actor:ProduceSnapshots :: Actor
actor :: Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Aactor%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">actor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
$sel:snapshotNumber:ProduceSnapshots :: SnapshotNumber
snapshotNumber :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-137"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="annottext">State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Closed"><span class="hs-identifier hs-var">Closed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Gen (Any (Action Model)))
</span><a href="#local-6989586621679540542"><span class="hs-identifier hs-var">maybeGenContest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-140"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Gen (Any (Action Model)))
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action Model))
</span><a href="#local-6989586621679540543"><span class="hs-identifier hs-var">genFanout</span></a></span><span>
</span><span id="line-141"></span><span>          </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679540544"><span class="annot"><span class="annottext">Gen (Any (Action Model))
</span><a href="#local-6989586621679540544"><span class="hs-identifier hs-var">contestAction</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Gen (Any (Action Model))] -&gt; Gen (Any (Action Model))
forall a. [Gen a] -&gt; Gen a
</span><span class="hs-identifier hs-var">oneof</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Gen (Any (Action Model))
</span><a href="#local-6989586621679540544"><span class="hs-identifier hs-var">contestAction</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action Model))
</span><a href="#local-6989586621679540543"><span class="hs-identifier hs-var">genFanout</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-142"></span><span>      </span><span class="annot"><span class="annottext">State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Final"><span class="hs-identifier hs-var">Final</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Any (Action Model) -&gt; Gen (Any (Action Model))
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action Model) -&gt; Gen (Any (Action Model)))
-&gt; Any (Action Model) -&gt; Gen (Any (Action Model))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Action Model () -&gt; Any (Action Model)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">Action Model ()
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span>
</span><span id="line-143"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621679540543"><span class="annot"><span class="annottext">genFanout :: Gen (Any (Action Model))
</span><a href="#local-6989586621679540543"><span class="hs-identifier hs-var hs-var">genFanout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any (Action Model) -&gt; Gen (Any (Action Model))
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action Model) -&gt; Gen (Any (Action Model)))
-&gt; Any (Action Model) -&gt; Gen (Any (Action Model))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Action Model () -&gt; Any (Action Model)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">Action Model ()
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679540549"><span class="annot"><span class="annottext">possibleContesters :: [Actor]
</span><a href="#local-6989586621679540549"><span class="hs-identifier hs-var hs-var">possibleContesters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#allActors"><span class="hs-identifier hs-var">allActors</span></a></span><span> </span><span class="annot"><span class="annottext">[Actor] -&gt; [Actor] -&gt; [Actor]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.OldList.html#%5C%5C"><span class="hs-operator hs-var">\\</span></a></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679540536"><span class="hs-identifier hs-var">alreadyContested</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679540542"><span class="annot"><span class="annottext">maybeGenContest :: Maybe (Gen (Any (Action Model)))
</span><a href="#local-6989586621679540542"><span class="hs-identifier hs-var hs-var">maybeGenContest</span></a></span></span><span>
</span><span id="line-149"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Actor] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679540549"><span class="hs-identifier hs-var">possibleContesters</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">[SnapshotNumber] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[SnapshotNumber]
</span><a href="#local-6989586621679540535"><span class="hs-identifier hs-var">snapshots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Gen (Any (Action Model)))
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action Model)) -&gt; Maybe (Gen (Any (Action Model)))
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Gen (Any (Action Model)) -&gt; Maybe (Gen (Any (Action Model))))
-&gt; Gen (Any (Action Model)) -&gt; Maybe (Gen (Any (Action Model)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>          </span><span id="local-6989586621679540551"><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540551"><span class="hs-identifier hs-var">actor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Actor] -&gt; Gen Actor
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679540549"><span class="hs-identifier hs-var">possibleContesters</span></a></span><span>
</span><span id="line-152"></span><span>          </span><span id="local-6989586621679540552"><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540552"><span class="hs-identifier hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SnapshotNumber] -&gt; Gen SnapshotNumber
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[SnapshotNumber]
</span><a href="#local-6989586621679540535"><span class="hs-identifier hs-var">snapshots</span></a></span><span>
</span><span id="line-153"></span><span>          </span><span class="annot"><span class="annottext">Any (Action Model) -&gt; Gen (Any (Action Model))
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action Model) -&gt; Gen (Any (Action Model)))
-&gt; Any (Action Model) -&gt; Gen (Any (Action Model))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; Any (Action Model)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Contest"><span class="hs-identifier hs-type">Contest</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">Actor
$sel:actor:ProduceSnapshots :: Actor
actor :: Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Aactor%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">actor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
$sel:snapshotNumber:ProduceSnapshots :: SnapshotNumber
snapshotNumber :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679540555"><span class="annot"><span class="annottext">initialState :: Model
</span><a href="#local-6989586621679540555"><span class="hs-identifier hs-var hs-var hs-var hs-var">initialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:snapshots:Model :: [SnapshotNumber]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Asnapshots%3AModel"><span class="hs-identifier hs-var">snapshots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headState:Model :: State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AheadState%3AModel"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Open"><span class="hs-identifier hs-var">Open</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoV:Model :: Var (UTxO' (TxOut CtxUTxO Era))
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AutxoV%3AModel"><span class="hs-identifier hs-var">utxoV</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Var (UTxO' (TxOut CtxUTxO Era))
forall a. Int -&gt; Var a
</span><span class="hs-identifier hs-var">mkVar</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:alreadyContested:Model :: [Actor]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AalreadyContested%3AModel"><span class="hs-identifier hs-var">alreadyContested</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">nextState</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679540087"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540087"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679540087"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span></span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621679540559"><span class="annot"><span class="annottext">nextState :: forall a. Model -&gt; Action Model a -&gt; Var a -&gt; Model
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">nextState</span></span></span><span> </span><span id="local-6989586621679540560"><span class="annot"><span class="annottext">Model
</span><a href="#local-6989586621679540560"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">Action Model a
R:ActionModela a
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="annot"><span class="annottext">Var a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Model
</span><a href="#local-6989586621679540560"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">nextState</span></span><span> </span><span id="local-6989586621679540562"><span class="annot"><span class="annottext">Model
</span><a href="#local-6989586621679540562"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679540563"><span class="annot"><span class="annottext">Action Model a
</span><a href="#local-6989586621679540563"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679540564"><span class="annot"><span class="annottext">Var a
</span><a href="#local-6989586621679540564"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action Model a
</span><a href="#local-6989586621679540563"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-167"></span><span>      </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#ProduceSnapshots"><span class="hs-identifier hs-type">ProduceSnapshots</span></a></span><span> </span><span id="local-6989586621679540566"><span class="annot"><span class="annottext">[SnapshotNumber]
</span><a href="#local-6989586621679540566"><span class="hs-identifier hs-var">snapshots</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Model
</span><a href="#local-6989586621679540562"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Asnapshots%3AModel"><span class="hs-identifier hs-var">snapshots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679540566"><span class="hs-identifier hs-type">snapshots</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span class="hs-special">{</span><span id="local-6989586621679540569"><span class="annot"><span class="annottext">SnapshotNumber
$sel:snapshotNumber:ProduceSnapshots :: Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; SnapshotNumber
snapshotNumber :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">Model
</span><a href="#local-6989586621679540562"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-170"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AheadState%3AModel"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span>
</span><span id="line-171"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AutxoV%3AModel"><span class="hs-identifier hs-var">utxoV</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679540564"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-172"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Asnapshots%3AModel"><span class="hs-identifier hs-var">snapshots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.List.html#filter"><span class="hs-identifier hs-type">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier">snapshotNumber</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Asnapshots%3AModel"><span class="hs-identifier hs-var">snapshots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540562"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-173"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AalreadyContested%3AModel"><span class="hs-identifier hs-var">alreadyContested</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Contest"><span class="hs-identifier hs-type">Contest</span></a></span><span class="hs-special">{</span><span id="local-6989586621679540572"><span class="annot"><span class="annottext">Actor
$sel:actor:ProduceSnapshots :: Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; Actor
actor :: Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Aactor%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">actor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679540573"><span class="annot"><span class="annottext">SnapshotNumber
$sel:snapshotNumber:ProduceSnapshots :: Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; SnapshotNumber
snapshotNumber :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><span class="annottext">Model
</span><a href="#local-6989586621679540562"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AheadState%3AModel"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span>
</span><span id="line-178"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AutxoV%3AModel"><span class="hs-identifier hs-var">utxoV</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679540564"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-179"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Asnapshots%3AModel"><span class="hs-identifier hs-var">snapshots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.List.html#filter"><span class="hs-identifier hs-type">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier">snapshotNumber</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Asnapshots%3AModel"><span class="hs-identifier hs-var">snapshots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540562"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-180"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AalreadyContested%3AModel"><span class="hs-identifier hs-var">alreadyContested</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679540572"><span class="hs-identifier hs-type">actor</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AalreadyContested%3AModel"><span class="hs-identifier hs-var">alreadyContested</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540562"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-181"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">Action Model a
R:ActionModela a
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Model
</span><a href="#local-6989586621679540562"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AheadState%3AModel"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Final"><span class="hs-identifier hs-type">Final</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">precondition</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679540576"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540576"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621679540577"><span class="annot"><span class="annottext">precondition :: forall a. Model -&gt; Action Model a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">precondition</span></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:headState:Model :: Model -&gt; State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AheadState%3AModel"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Final"><span class="hs-identifier hs-var">Final</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Action Model a
R:ActionModela a
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span class="hs-special">{</span><span id="local-6989586621679540579"><span class="annot"><span class="annottext">State
$sel:headState:Model :: Model -&gt; State
headState :: State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AheadState%3AModel"><span class="hs-identifier hs-var hs-var">headState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Contest"><span class="hs-identifier hs-type">Contest</span></a></span><span class="hs-special">{</span><span id="local-6989586621679540584"><span class="annot"><span class="annottext">SnapshotNumber
$sel:snapshotNumber:ProduceSnapshots :: Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; SnapshotNumber
snapshotNumber :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679540579"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="annot"><span class="annottext">State -&gt; State -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Closed"><span class="hs-identifier hs-var">Closed</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540584"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; SnapshotNumber -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><span class="hs-number">0</span></span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><span class="annottext">Model
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Action Model a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasVariables</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621679540596"><span class="annot"><span class="annottext">getAllVariables :: Model -&gt; Set (Any Var)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">getAllVariables</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Model -&gt; Set (Any Var)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679540597"><span class="annot"><span class="hs-identifier hs-type">HasVariables</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540597"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621679540604"><span class="annot"><span class="annottext">getAllVariables :: Action Model a -&gt; Set (Any Var)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">getAllVariables</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Action Model a -&gt; Set (Any Var)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span id="local-6989586621679540074"><span id="local-6989586621679540606"><span id="local-6989586621679540608"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540074"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-198"></span><span id="local-6989586621679540610"><span id="local-6989586621679540612"><span id="local-6989586621679540614"><span id="local-6989586621679540618"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540610"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679540625"><span id="local-6989586621679540628"><span id="local-6989586621679540631"><span class="annot"><span class="hs-identifier hs-type">RunModel</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">perform</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679540108"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540108"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LookUp</span></span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540108"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-202"></span><span>  </span><span id="local-6989586621679540636"><span class="annot"><span class="annottext">perform :: forall a. Model -&gt; Action Model a -&gt; LookUp IO -&gt; IO a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">perform</span></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span class="hs-special">{</span><span id="local-6989586621679540637"><span class="annot"><span class="annottext">Var (UTxO' (TxOut CtxUTxO Era))
$sel:utxoV:Model :: Model -&gt; Var (UTxO' (TxOut CtxUTxO Era))
utxoV :: Var (UTxO' (TxOut CtxUTxO Era))
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AutxoV%3AModel"><span class="hs-identifier hs-var hs-var">utxoV</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679540638"><span class="annot"><span class="annottext">[Actor]
$sel:alreadyContested:Model :: Model -&gt; [Actor]
alreadyContested :: [Actor]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AalreadyContested%3AModel"><span class="hs-identifier hs-var hs-var">alreadyContested</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679540639"><span class="annot"><span class="annottext">Action Model a
</span><a href="#local-6989586621679540639"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621679540640"><span class="annot"><span class="annottext">LookUp IO
</span><a href="#local-6989586621679540640"><span class="hs-identifier hs-var">lookupVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action Model a
</span><a href="#local-6989586621679540639"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-204"></span><span>      </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#ProduceSnapshots"><span class="hs-identifier hs-type">ProduceSnapshots</span></a></span><span> </span><span id="local-6989586621679540644"><span class="annot"><span class="annottext">[SnapshotNumber]
</span><a href="#local-6989586621679540644"><span class="hs-identifier hs-var">_snapshots</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span class="hs-special">{</span><span id="local-6989586621679540659"><span class="annot"><span class="annottext">Actor
$sel:actor:ProduceSnapshots :: Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; Actor
actor :: Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Aactor%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">actor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679540660"><span class="annot"><span class="annottext">SnapshotNumber
$sel:snapshotNumber:ProduceSnapshots :: Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; SnapshotNumber
snapshotNumber :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>        </span><span id="local-6989586621679540661"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540661"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Actor -&gt; ConfirmedSnapshot Tx -&gt; IO Tx
Actor -&gt; ConfirmedSnapshot Tx -&gt; IO Tx
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#newCloseTx"><span class="hs-identifier hs-var">newCloseTx</span></a></span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540659"><span class="hs-identifier hs-var">actor</span></a></span><span> </span><span class="annot"><span class="annottext">(ConfirmedSnapshot Tx -&gt; IO Tx) -&gt; ConfirmedSnapshot Tx -&gt; IO Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; ConfirmedSnapshot Tx
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#correctlySignedSnapshot"><span class="hs-identifier hs-var">correctlySignedSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540660"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; Tx -&gt; IO ()
forall (m :: * -&gt; *).
(HasCallStack, MonadThrow m) =&gt;
UTxO' (TxOut CtxUTxO Era) -&gt; Tx -&gt; m ()
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#validateTx"><span class="hs-identifier hs-var">validateTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#openHeadUTxO"><span class="hs-identifier hs-var">openHeadUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540661"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
-&gt; Tx -&gt; (HeadObservation -&gt; Maybe ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
UTxO' (TxOut CtxUTxO Era)
-&gt; Tx -&gt; (HeadObservation -&gt; Maybe a) -&gt; m a
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#observeTxMatching"><span class="hs-identifier hs-var">observeTxMatching</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#openHeadUTxO"><span class="hs-identifier hs-var">openHeadUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540661"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((HeadObservation -&gt; Maybe ()) -&gt; IO ())
-&gt; (HeadObservation -&gt; Maybe ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-209"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Tx.Close</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Maybe ()
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>          </span><span class="annot"><span class="annottext">HeadObservation
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ()
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; IO (UTxO' (TxOut CtxUTxO Era))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO' (TxOut CtxUTxO Era) -&gt; IO (UTxO' (TxOut CtxUTxO Era)))
-&gt; UTxO' (TxOut CtxUTxO Era) -&gt; IO (UTxO' (TxOut CtxUTxO Era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; UTxO' (TxOut CtxUTxO Era) -&gt; UTxO' (TxOut CtxUTxO Era)
</span><span class="hs-identifier hs-var">adjustUTxO</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540661"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#openHeadUTxO"><span class="hs-identifier hs-var">openHeadUTxO</span></a></span><span>
</span><span id="line-212"></span><span>      </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Contest"><span class="hs-identifier hs-type">Contest</span></a></span><span class="hs-special">{</span><span id="local-6989586621679540726"><span class="annot"><span class="annottext">Actor
$sel:actor:ProduceSnapshots :: Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; Actor
actor :: Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3Aactor%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">actor</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679540727"><span class="annot"><span class="annottext">SnapshotNumber
$sel:snapshotNumber:ProduceSnapshots :: Action Model (UTxO' (TxOut CtxUTxO Era)) -&gt; SnapshotNumber
snapshotNumber :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#%24sel%3AsnapshotNumber%3AProduceSnapshots"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679540728"><span class="annot"><span class="annottext">utxo :: Realized IO (UTxO' (TxOut CtxUTxO Era))
</span><a href="#local-6989586621679540728"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var (UTxO' (TxOut CtxUTxO Era))
-&gt; Realized IO (UTxO' (TxOut CtxUTxO Era))
LookUp IO
</span><a href="#local-6989586621679540640"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var (UTxO' (TxOut CtxUTxO Era))
</span><a href="#local-6989586621679540637"><span class="hs-identifier hs-var">utxoV</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span id="local-6989586621679540729"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540729"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
UTxO' (TxOut CtxUTxO Era) -&gt; Actor -&gt; ConfirmedSnapshot Tx -&gt; IO Tx
UTxO' (TxOut CtxUTxO Era) -&gt; Actor -&gt; ConfirmedSnapshot Tx -&gt; IO Tx
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#newContestTx"><span class="hs-identifier hs-var">newContestTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
Realized IO (UTxO' (TxOut CtxUTxO Era))
</span><a href="#local-6989586621679540728"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540726"><span class="hs-identifier hs-var">actor</span></a></span><span> </span><span class="annot"><span class="annottext">(ConfirmedSnapshot Tx -&gt; IO Tx) -&gt; ConfirmedSnapshot Tx -&gt; IO Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; ConfirmedSnapshot Tx
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#correctlySignedSnapshot"><span class="hs-identifier hs-var">correctlySignedSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540727"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; Tx -&gt; IO ()
forall (m :: * -&gt; *).
(HasCallStack, MonadThrow m) =&gt;
UTxO' (TxOut CtxUTxO Era) -&gt; Tx -&gt; m ()
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#validateTx"><span class="hs-identifier hs-var">validateTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
Realized IO (UTxO' (TxOut CtxUTxO Era))
</span><a href="#local-6989586621679540728"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540729"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span id="local-6989586621679540731"><span class="annot"><span class="annottext">observation :: ContestObservation
</span><a href="#local-6989586621679540731"><span class="hs-identifier hs-var">observation</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Tx.ContestObservation</span></span><span class="hs-special">{</span><span id="local-6989586621679540733"><span class="annot"><span class="annottext">[PubKeyHash]
contesters :: [PubKeyHash]
$sel:contesters:ContestObservation :: ContestObservation -&gt; [PubKeyHash]
</span><a href="#local-6989586621679540733"><span class="hs-identifier hs-var hs-var">contesters</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-217"></span><span>          </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
-&gt; Tx
-&gt; (HeadObservation -&gt; Maybe ContestObservation)
-&gt; IO ContestObservation
forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
UTxO' (TxOut CtxUTxO Era)
-&gt; Tx -&gt; (HeadObservation -&gt; Maybe a) -&gt; m a
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#observeTxMatching"><span class="hs-identifier hs-var">observeTxMatching</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
Realized IO (UTxO' (TxOut CtxUTxO Era))
</span><a href="#local-6989586621679540728"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540729"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((HeadObservation -&gt; Maybe ContestObservation)
 -&gt; IO ContestObservation)
-&gt; (HeadObservation -&gt; Maybe ContestObservation)
-&gt; IO ContestObservation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-218"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Tx.Contest</span></span><span> </span><span id="local-6989586621679540736"><span class="annot"><span class="annottext">ContestObservation
</span><a href="#local-6989586621679540736"><span class="hs-identifier hs-var">obs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContestObservation -&gt; Maybe ContestObservation
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ContestObservation
</span><a href="#local-6989586621679540736"><span class="hs-identifier hs-var">obs</span></a></span><span>
</span><span id="line-219"></span><span>            </span><span class="annot"><span class="annottext">HeadObservation
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ContestObservation
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679540737"><span class="annot"><span class="annottext">newContesters :: [Actor]
</span><a href="#local-6989586621679540737"><span class="hs-identifier hs-var hs-var">newContesters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540726"><span class="hs-identifier hs-var">actor</span></a></span><span> </span><span class="annot"><span class="annottext">Actor -&gt; [Actor] -&gt; [Actor]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679540638"><span class="hs-identifier hs-var">alreadyContested</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PubKeyHash] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621679540733"><span class="hs-identifier hs-var">contesters</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">[Actor] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679540737"><span class="hs-identifier hs-var">newContesters</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-222"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
String -&gt; m a
</span><span class="hs-identifier hs-var">failure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; ([Text] -&gt; String) -&gt; [Text] -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. ToString a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall t. IsText t &quot;unlines&quot; =&gt; [t] -&gt; t
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; IO ()) -&gt; [Text] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Text
forall a. IsString a =&gt; String -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.String.html#fromString"><span class="hs-identifier hs-var">fromString</span></a></span><span>
</span><span id="line-224"></span><span>              </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; [String] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected contesters &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Actor] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679540737"><span class="hs-identifier hs-var">newContesters</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, but observed only &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[PubKeyHash] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621679540733"><span class="hs-identifier hs-var">contesters</span></a></span><span>
</span><span id="line-225"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. ToString a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Text -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ContestObservation -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">pShowNoColor</span></span><span> </span><span class="annot"><span class="annottext">ContestObservation
</span><a href="#local-6989586621679540731"><span class="hs-identifier hs-var">observation</span></a></span><span>
</span><span id="line-226"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Transaction: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; Tx -&gt; String
</span><span class="hs-identifier hs-var">renderTxWithUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
Realized IO (UTxO' (TxOut CtxUTxO Era))
</span><a href="#local-6989586621679540728"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540729"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-227"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>        </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; IO (UTxO' (TxOut CtxUTxO Era))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO' (TxOut CtxUTxO Era) -&gt; IO (UTxO' (TxOut CtxUTxO Era)))
-&gt; UTxO' (TxOut CtxUTxO Era) -&gt; IO (UTxO' (TxOut CtxUTxO Era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; UTxO' (TxOut CtxUTxO Era) -&gt; UTxO' (TxOut CtxUTxO Era)
</span><span class="hs-identifier hs-var">adjustUTxO</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540729"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
Realized IO (UTxO' (TxOut CtxUTxO Era))
</span><a href="#local-6989586621679540728"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-229"></span><span>      </span><span class="annot"><span class="annottext">Action Model a
R:ActionModela a
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>      </span><span class="annot"><span class="annottext">Action Model a
R:ActionModela a
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><span class="hs-comment">-- * Fixtures and glue code</span></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="annot"><span class="hs-comment">-- | List of all model actors corresponding to the fixtures used.</span></span><span>
</span><span id="line-235"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#allActors"><span class="hs-identifier hs-type">allActors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-236"></span><span id="allActors"><span class="annot"><span class="annottext">allActors :: [Actor]
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#allActors"><span class="hs-identifier hs-var hs-var">allActors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Alice"><span class="hs-identifier hs-var">Alice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Bob"><span class="hs-identifier hs-var">Bob</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Carol"><span class="hs-identifier hs-var">Carol</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="hs-comment">-- | A &quot;random&quot; UTxO distribution for a given snapshot number. This always</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- contains one UTxO for alice, bob, and carol.</span><span>
</span><span id="line-240"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#snapshotUTxO"><span class="hs-identifier hs-type">snapshotUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotNumber</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-241"></span><span id="snapshotUTxO"><span class="annot"><span class="annottext">snapshotUTxO :: SnapshotNumber -&gt; UTxO' (TxOut CtxUTxO Era)
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#snapshotUTxO"><span class="hs-identifier hs-var hs-var">snapshotUTxO</span></a></span></span><span> </span><span id="local-6989586621679540748"><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540748"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Gen (UTxO' (TxOut CtxUTxO Era)) -&gt; Int -&gt; UTxO' (TxOut CtxUTxO Era)
forall a. Gen a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`generateWith`</span></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540748"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Gen (UTxO' (TxOut CtxUTxO Era)) -&gt; UTxO' (TxOut CtxUTxO Era))
-&gt; (Gen (UTxO' (TxOut CtxUTxO Era))
    -&gt; Gen (UTxO' (TxOut CtxUTxO Era)))
-&gt; Gen (UTxO' (TxOut CtxUTxO Era))
-&gt; UTxO' (TxOut CtxUTxO Era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Gen (UTxO' (TxOut CtxUTxO Era))
-&gt; Gen (UTxO' (TxOut CtxUTxO Era))
forall a. Int -&gt; Gen a -&gt; Gen a
</span><span class="hs-identifier hs-var">resize</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Gen (UTxO' (TxOut CtxUTxO Era)) -&gt; UTxO' (TxOut CtxUTxO Era))
-&gt; Gen (UTxO' (TxOut CtxUTxO Era)) -&gt; UTxO' (TxOut CtxUTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621679540750"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540750"><span class="hs-identifier hs-var">aliceUTxO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Gen (UTxO' (TxOut CtxUTxO Era))
</span><span class="hs-identifier hs-var">genUTxOFor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
-&gt; Party -&gt; VerificationKey PaymentKey
forall a. Gen a -&gt; Party -&gt; a
</span><a href="Test.Hydra.Fixture.html#genForParty"><span class="hs-operator hs-var">`genForParty`</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="Test.Hydra.Fixture.html#alice"><span class="hs-identifier hs-var">Fixture.alice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>  </span><span id="local-6989586621679540752"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540752"><span class="hs-identifier hs-var">bobUTxO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Gen (UTxO' (TxOut CtxUTxO Era))
</span><span class="hs-identifier hs-var">genUTxOFor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
-&gt; Party -&gt; VerificationKey PaymentKey
forall a. Gen a -&gt; Party -&gt; a
</span><a href="Test.Hydra.Fixture.html#genForParty"><span class="hs-operator hs-var">`genForParty`</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="Test.Hydra.Fixture.html#bob"><span class="hs-identifier hs-var">Fixture.bob</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>  </span><span id="local-6989586621679540754"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540754"><span class="hs-identifier hs-var">carolUTxO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Gen (UTxO' (TxOut CtxUTxO Era))
</span><span class="hs-identifier hs-var">genUTxOFor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
-&gt; Party -&gt; VerificationKey PaymentKey
forall a. Gen a -&gt; Party -&gt; a
</span><a href="Test.Hydra.Fixture.html#genForParty"><span class="hs-operator hs-var">`genForParty`</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="Test.Hydra.Fixture.html#carol"><span class="hs-identifier hs-var">Fixture.carol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; Gen (UTxO' (TxOut CtxUTxO Era))
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO' (TxOut CtxUTxO Era) -&gt; Gen (UTxO' (TxOut CtxUTxO Era)))
-&gt; UTxO' (TxOut CtxUTxO Era) -&gt; Gen (UTxO' (TxOut CtxUTxO Era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540750"><span class="hs-identifier hs-var">aliceUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
-&gt; UTxO' (TxOut CtxUTxO Era) -&gt; UTxO' (TxOut CtxUTxO Era)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540752"><span class="hs-identifier hs-var">bobUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
-&gt; UTxO' (TxOut CtxUTxO Era) -&gt; UTxO' (TxOut CtxUTxO Era)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540754"><span class="hs-identifier hs-var">carolUTxO</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | A model of a correctly signed snapshot. Given a snapshot number a snapshot</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- signed by all participants (alice, bob and carol) with some UTxO contained is</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- produced.</span><span>
</span><span id="line-250"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#correctlySignedSnapshot"><span class="hs-identifier hs-type">correctlySignedSnapshot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotNumber</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConfirmedSnapshot</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-251"></span><span id="correctlySignedSnapshot"><span class="annot"><span class="annottext">correctlySignedSnapshot :: SnapshotNumber -&gt; ConfirmedSnapshot Tx
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#correctlySignedSnapshot"><span class="hs-identifier hs-var hs-var">correctlySignedSnapshot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="annottext">SnapshotNumber
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">InitialSnapshot</span></span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- -- NOTE: The close validator would not check headId on close with</span><span>
</span><span id="line-255"></span><span>        </span><span class="hs-comment">-- initial snapshot, but we need to provide it still.</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">$sel:headId:InitialSnapshot :: HeadId
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">Fixture.testPolicyId</span></span><span>
</span><span id="line-257"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:initialUTxO:InitialSnapshot :: UTxOType Tx
</span><span class="hs-identifier hs-var">initialUTxO</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; UTxO' (TxOut CtxUTxO Era)
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#snapshotUTxO"><span class="hs-identifier hs-var">snapshotUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><span class="hs-number">0</span></span><span>
</span><span id="line-258"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-259"></span><span>  </span><span id="local-6989586621679540760"><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540760"><span class="hs-identifier hs-var">number</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConfirmedSnapshot</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">Snapshot Tx
snapshot :: Snapshot Tx
$sel:snapshot:InitialSnapshot :: Snapshot Tx
</span><a href="#local-6989586621679540762"><span class="hs-identifier hs-var hs-var">snapshot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
signatures :: MultiSignature (Snapshot Tx)
$sel:signatures:InitialSnapshot :: MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621679540764"><span class="hs-identifier hs-var hs-var">signatures</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621679540762"><span class="annot"><span class="annottext">snapshot :: Snapshot Tx
</span><a href="#local-6989586621679540762"><span class="hs-identifier hs-var hs-var">snapshot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Snapshot</span></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Snapshot :: HeadId
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">Fixture.testPolicyId</span></span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
$sel:number:Snapshot :: SnapshotNumber
number :: SnapshotNumber
</span><span class="hs-identifier hs-var hs-var">number</span></span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxo:Snapshot :: UTxOType Tx
</span><span class="hs-identifier hs-var">utxo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; UTxO' (TxOut CtxUTxO Era)
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#snapshotUTxO"><span class="hs-identifier hs-var">snapshotUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679540760"><span class="hs-identifier hs-var">number</span></a></span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:confirmed:Snapshot :: [TxIdType Tx]
</span><span class="hs-identifier hs-var">confirmed</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621679540764"><span class="annot"><span class="annottext">signatures :: MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621679540764"><span class="hs-identifier hs-var hs-var">signatures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Signature (Snapshot Tx)] -&gt; MultiSignature (Snapshot Tx)
forall {k} (a :: k). [Signature a] -&gt; MultiSignature a
</span><span class="hs-identifier hs-var">aggregate</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Snapshot Tx -&gt; Signature (Snapshot Tx)
forall a.
SignableRepresentation a =&gt;
SigningKey HydraKey -&gt; a -&gt; Signature a
</span><span class="hs-identifier hs-var">sign</span></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679540770"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">Snapshot Tx
</span><a href="#local-6989586621679540762"><span class="hs-identifier hs-var">snapshot</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679540770"><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679540770"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="Test.Hydra.Fixture.html#aliceSk"><span class="hs-identifier hs-var">Fixture.aliceSk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="Test.Hydra.Fixture.html#bobSk"><span class="hs-identifier hs-var">Fixture.bobSk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="Test.Hydra.Fixture.html#carolSk"><span class="hs-identifier hs-var">Fixture.carolSk</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="annot"><span class="hs-comment">-- | UTxO of the open head on-chain. NOTE: This uses fixtures for headId, parties, and cperiod.</span></span><span>
</span><span id="line-272"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#openHeadUTxO"><span class="hs-identifier hs-type">openHeadUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-273"></span><span id="openHeadUTxO"><span class="annot"><span class="annottext">openHeadUTxO :: UTxO' (TxOut CtxUTxO Era)
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#openHeadUTxO"><span class="hs-identifier hs-var hs-var">openHeadUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era) -&gt; UTxO' (TxOut CtxUTxO Era)
forall out. (TxIn, out) -&gt; UTxO' out
</span><span class="hs-identifier hs-var">UTxO.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679540775"><span class="hs-identifier hs-var">headTxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679540776"><span class="hs-identifier hs-var">openHeadTxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
-&gt; UTxO' (TxOut CtxUTxO Era) -&gt; UTxO' (TxOut CtxUTxO Era)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry -&gt; UTxO' (TxOut CtxUTxO Era)
</span><span class="hs-identifier hs-var">registryUTxO</span></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#testScriptRegistry"><span class="hs-identifier hs-var">testScriptRegistry</span></a></span><span>
</span><span id="line-276"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-277"></span><span>  </span><span id="local-6989586621679540775"><span class="annot"><span class="annottext">headTxIn :: TxIn
</span><a href="#local-6989586621679540775"><span class="hs-identifier hs-var hs-var">headTxIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen TxIn
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="annot"><span class="annottext">Gen TxIn -&gt; Int -&gt; TxIn
forall a. Gen a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`generateWith`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">42</span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>  </span><span id="local-6989586621679540776"><span class="annot"><span class="annottext">openHeadTxOut :: TxOut CtxUTxO Era
</span><a href="#local-6989586621679540776"><span class="hs-identifier hs-var hs-var">openHeadTxOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><span class="annottext">NetworkId -&gt; PolicyId -&gt; TxOutDatum CtxUTxO -&gt; TxOut CtxUTxO Era
forall ctx. NetworkId -&gt; PolicyId -&gt; TxOutDatum ctx -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">mkHeadOutput</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">Fixture.testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">Fixture.testPolicyId</span></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxUTxO
forall {ctx}. TxOutDatum ctx Era
</span><a href="#local-6989586621679540781"><span class="hs-identifier hs-var">openHeadDatum</span></a></span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
-&gt; (TxOut CtxUTxO Era -&gt; TxOut CtxUTxO Era) -&gt; TxOut CtxUTxO Era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
-&gt; TxOut CtxUTxO Era -&gt; TxOut CtxUTxO Era
</span><a href="Hydra.Chain.Direct.Contract.Mutation.html#addParticipationTokens"><span class="hs-identifier hs-var">addParticipationTokens</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="Test.Hydra.Fixture.html#alicePVk"><span class="hs-identifier hs-var">Fixture.alicePVk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="Test.Hydra.Fixture.html#bobPVk"><span class="hs-identifier hs-var">Fixture.bobPVk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="Test.Hydra.Fixture.html#carolPVk"><span class="hs-identifier hs-var">Fixture.carolPVk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621679540781"><span class="annot"><span class="annottext">openHeadDatum :: TxOutDatum ctx Era
</span><a href="#local-6989586621679540781"><span class="hs-identifier hs-var hs-var">openHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">State -&gt; TxOutDatum ctx Era
forall era a ctx.
(ToScriptData a, IsBabbageEraOnwards era) =&gt;
a -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">mkTxOutDatumInline</span></span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:parties:Initial :: [Party]
</span><span class="hs-identifier hs-var">parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party -&gt; Party
</span><span class="hs-identifier hs-var">partyToChain</span></span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Party) -&gt; [Party] -&gt; [Party]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Party
</span><a href="Test.Hydra.Fixture.html#alice"><span class="hs-identifier hs-var">Fixture.alice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="Test.Hydra.Fixture.html#bob"><span class="hs-identifier hs-var">Fixture.bob</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="Test.Hydra.Fixture.html#carol"><span class="hs-identifier hs-var">Fixture.carol</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoHash:Initial :: Hash
</span><span class="hs-identifier hs-var">utxoHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Hash
forall a arep. ToBuiltin a arep =&gt; a -&gt; arep
</span><span class="hs-identifier hs-var">toBuiltin</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Hash) -&gt; ByteString -&gt; Hash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tx. IsTx tx =&gt; UTxOType tx -&gt; ByteString
</span><span class="hs-identifier hs-var">hashUTxO</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><span class="annottext">(UTxOType Tx -&gt; ByteString) -&gt; UTxOType Tx -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; UTxO' (TxOut CtxUTxO Era)
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#snapshotUTxO"><span class="hs-identifier hs-var">snapshotUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><span class="hs-number">0</span></span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:Initial :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><span class="hs-identifier hs-var">CP.toChain</span></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="Test.Hydra.Fixture.html#cperiod"><span class="hs-identifier hs-var">Fixture.cperiod</span></a></span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Initial :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">(HeadId -&gt; CurrencySymbol) -&gt; HeadId -&gt; CurrencySymbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">Fixture.testPolicyId</span></span><span>
</span><span id="line-290"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- | Creates a transaction that closes 'openHeadUTxO' with given the snapshot.</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- NOTE: This uses fixtures for headId, parties (alice, bob, carol),</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- contestation period and also claims to close at time 0 resulting in a</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- contestation deadline of 0 + cperiod.</span><span>
</span><span id="line-296"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#newCloseTx"><span class="hs-identifier hs-type">newCloseTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConfirmedSnapshot</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-297"></span><span id="newCloseTx"><span class="annot"><span class="annottext">newCloseTx :: HasCallStack =&gt; Actor -&gt; ConfirmedSnapshot Tx -&gt; IO Tx
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#newCloseTx"><span class="hs-identifier hs-var hs-var">newCloseTx</span></a></span></span><span> </span><span id="local-6989586621679540808"><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540808"><span class="hs-identifier hs-var">actor</span></a></span></span><span> </span><span id="local-6989586621679540809"><span class="annot"><span class="annottext">ConfirmedSnapshot Tx
</span><a href="#local-6989586621679540809"><span class="hs-identifier hs-var">snapshot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="annottext">(CloseTxError -&gt; IO Tx)
-&gt; (Tx -&gt; IO Tx) -&gt; Either CloseTxError Tx -&gt; IO Tx
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO Tx
forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
String -&gt; m a
</span><span class="hs-identifier hs-var">failure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO Tx)
-&gt; (CloseTxError -&gt; String) -&gt; CloseTxError -&gt; IO Tx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CloseTxError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; IO Tx
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either CloseTxError Tx -&gt; IO Tx)
-&gt; Either CloseTxError Tx -&gt; IO Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">ChainContext
-&gt; UTxO' (TxOut CtxUTxO Era)
-&gt; HeadId
-&gt; HeadParameters
-&gt; ConfirmedSnapshot Tx
-&gt; SlotNo
-&gt; PointInTime
-&gt; Either CloseTxError Tx
</span><span class="hs-identifier hs-var">close</span></span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Actor -&gt; ChainContext
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#actorChainContext"><span class="hs-identifier hs-var">actorChainContext</span></a></span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540808"><span class="hs-identifier hs-var">actor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>      </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#openHeadUTxO"><span class="hs-identifier hs-var">openHeadUTxO</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">Fixture.testPolicyId</span></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><span class="annottext">HeadParameters
</span><a href="Test.Hydra.Fixture.html#testHeadParameters"><span class="hs-identifier hs-var">Fixture.testHeadParameters</span></a></span><span>
</span><span id="line-304"></span><span>      </span><span class="annot"><span class="annottext">ConfirmedSnapshot Tx
</span><a href="#local-6989586621679540809"><span class="hs-identifier hs-var">snapshot</span></a></span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679540813"><span class="hs-identifier hs-var">lowerBound</span></a></span><span>
</span><span id="line-306"></span><span>      </span><span class="annot"><span class="annottext">PointInTime
</span><a href="#local-6989586621679540814"><span class="hs-identifier hs-var">upperBound</span></a></span><span>
</span><span id="line-307"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-308"></span><span>  </span><span id="local-6989586621679540813"><span class="annot"><span class="annottext">lowerBound :: SlotNo
</span><a href="#local-6989586621679540813"><span class="hs-identifier hs-var hs-var">lowerBound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-number">0</span></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>  </span><span id="local-6989586621679540814"><span class="annot"><span class="annottext">upperBound :: PointInTime
</span><a href="#local-6989586621679540814"><span class="hs-identifier hs-var hs-var">upperBound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; UTCTime
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/time-1.12.2/src/Data.Time.Clock.POSIX.html#posixSecondsToUTCTime"><span class="hs-identifier hs-var">posixSecondsToUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="hs-comment">-- | Creates a contest transaction using given utxo and contesting with given</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- snapshot. NOTE: This uses fixtures for headId, contestation period and also</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- claims to contest at time 0.</span><span>
</span><span id="line-315"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#newContestTx"><span class="hs-identifier hs-type">newContestTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConfirmedSnapshot</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-316"></span><span id="newContestTx"><span class="annot"><span class="annottext">newContestTx :: HasCallStack =&gt;
UTxO' (TxOut CtxUTxO Era) -&gt; Actor -&gt; ConfirmedSnapshot Tx -&gt; IO Tx
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#newContestTx"><span class="hs-identifier hs-var hs-var">newContestTx</span></a></span></span><span> </span><span id="local-6989586621679540827"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540827"><span class="hs-identifier hs-var">spendableUTxO</span></a></span></span><span> </span><span id="local-6989586621679540828"><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540828"><span class="hs-identifier hs-var">actor</span></a></span></span><span> </span><span id="local-6989586621679540829"><span class="annot"><span class="annottext">ConfirmedSnapshot Tx
</span><a href="#local-6989586621679540829"><span class="hs-identifier hs-var">snapshot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><span class="annottext">(ContestTxError -&gt; IO Tx)
-&gt; (Tx -&gt; IO Tx) -&gt; Either ContestTxError Tx -&gt; IO Tx
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO Tx
forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
String -&gt; m a
</span><span class="hs-identifier hs-var">failure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO Tx)
-&gt; (ContestTxError -&gt; String) -&gt; ContestTxError -&gt; IO Tx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContestTxError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; IO Tx
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ContestTxError Tx -&gt; IO Tx)
-&gt; Either ContestTxError Tx -&gt; IO Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">ChainContext
-&gt; UTxO' (TxOut CtxUTxO Era)
-&gt; HeadId
-&gt; ContestationPeriod
-&gt; ConfirmedSnapshot Tx
-&gt; PointInTime
-&gt; Either ContestTxError Tx
</span><span class="hs-identifier hs-var">contest</span></span><span>
</span><span id="line-319"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Actor -&gt; ChainContext
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#actorChainContext"><span class="hs-identifier hs-var">actorChainContext</span></a></span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540828"><span class="hs-identifier hs-var">actor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>      </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540827"><span class="hs-identifier hs-var">spendableUTxO</span></a></span><span>
</span><span id="line-321"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">Fixture.testPolicyId</span></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>      </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="Test.Hydra.Fixture.html#cperiod"><span class="hs-identifier hs-var">Fixture.cperiod</span></a></span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="annottext">ConfirmedSnapshot Tx
</span><a href="#local-6989586621679540829"><span class="hs-identifier hs-var">snapshot</span></a></span><span>
</span><span id="line-324"></span><span>      </span><span class="annot"><span class="annottext">PointInTime
</span><a href="#local-6989586621679540830"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-325"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-326"></span><span>  </span><span id="local-6989586621679540830"><span class="annot"><span class="annottext">currentTime :: PointInTime
</span><a href="#local-6989586621679540830"><span class="hs-identifier hs-var hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; UTCTime
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/time-1.12.2/src/Data.Time.Clock.POSIX.html#posixSecondsToUTCTime"><span class="hs-identifier hs-var">posixSecondsToUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="annot"><span class="hs-comment">-- | Fixture for the chain context of a model 'Actor' on 'testNetworkId'. Uses a generated 'ScriptRegistry'.</span></span><span>
</span><span id="line-329"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#actorChainContext"><span class="hs-identifier hs-type">actorChainContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainContext</span></span><span>
</span><span id="line-330"></span><span id="actorChainContext"><span class="annot"><span class="annottext">actorChainContext :: Actor -&gt; ChainContext
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#actorChainContext"><span class="hs-identifier hs-var hs-var">actorChainContext</span></a></span></span><span> </span><span id="local-6989586621679540833"><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540833"><span class="hs-identifier hs-var">actor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ChainContext</span></span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:networkId:ChainContext :: NetworkId
</span><span class="hs-identifier hs-var">networkId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">Fixture.testNetworkId</span></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:ownVerificationKey:ChainContext :: VerificationKey PaymentKey
</span><span class="hs-identifier hs-var">ownVerificationKey</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540833"><span class="hs-identifier hs-var">actor</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-335"></span><span>          </span><span class="annot"><span class="annottext">Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Alice"><span class="hs-identifier hs-var">Alice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="Test.Hydra.Fixture.html#alicePVk"><span class="hs-identifier hs-var">Fixture.alicePVk</span></a></span><span>
</span><span id="line-336"></span><span>          </span><span class="annot"><span class="annottext">Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Bob"><span class="hs-identifier hs-var">Bob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="Test.Hydra.Fixture.html#bobPVk"><span class="hs-identifier hs-var">Fixture.bobPVk</span></a></span><span>
</span><span id="line-337"></span><span>          </span><span class="annot"><span class="annottext">Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Carol"><span class="hs-identifier hs-var">Carol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="Test.Hydra.Fixture.html#carolPVk"><span class="hs-identifier hs-var">Fixture.carolPVk</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:ownParty:ChainContext :: Party
</span><span class="hs-identifier hs-var">ownParty</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679540833"><span class="hs-identifier hs-var">actor</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-340"></span><span>          </span><span class="annot"><span class="annottext">Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Alice"><span class="hs-identifier hs-var">Alice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="Test.Hydra.Fixture.html#alice"><span class="hs-identifier hs-var">Fixture.alice</span></a></span><span>
</span><span id="line-341"></span><span>          </span><span class="annot"><span class="annottext">Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Bob"><span class="hs-identifier hs-var">Bob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="Test.Hydra.Fixture.html#bob"><span class="hs-identifier hs-var">Fixture.bob</span></a></span><span>
</span><span id="line-342"></span><span>          </span><span class="annot"><span class="annottext">Actor
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#Carol"><span class="hs-identifier hs-var">Carol</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="Test.Hydra.Fixture.html#carol"><span class="hs-identifier hs-var">Fixture.carol</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:scriptRegistry:ChainContext :: ScriptRegistry
</span><span class="hs-identifier hs-var">scriptRegistry</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#testScriptRegistry"><span class="hs-identifier hs-var">testScriptRegistry</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#testScriptRegistry"><span class="hs-identifier hs-type">testScriptRegistry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptRegistry</span></span><span>
</span><span id="line-347"></span><span id="testScriptRegistry"><span class="annot"><span class="annottext">testScriptRegistry :: ScriptRegistry
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#testScriptRegistry"><span class="hs-identifier hs-var hs-var">testScriptRegistry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen ScriptRegistry
</span><span class="hs-identifier hs-var">genScriptRegistry</span></span><span> </span><span class="annot"><span class="annottext">Gen ScriptRegistry -&gt; Int -&gt; ScriptRegistry
forall a. Gen a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`generateWith`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">42</span></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="annot"><span class="hs-comment">-- * Helpers</span></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- | Thin wrapper around 'evaluateTx' that fails with 'failure' if any of the</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- scripts/redeemers fail to evaluate.</span><span>
</span><span id="line-353"></span><span id="local-6989586621679540113"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#validateTx"><span class="hs-identifier hs-type">validateTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679540113"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679540113"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-354"></span><span id="validateTx"><span class="annot"><span class="annottext">validateTx :: forall (m :: * -&gt; *).
(HasCallStack, MonadThrow m) =&gt;
UTxO' (TxOut CtxUTxO Era) -&gt; Tx -&gt; m ()
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#validateTx"><span class="hs-identifier hs-var hs-var">validateTx</span></a></span></span><span> </span><span id="local-6989586621679540877"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540877"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679540878"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540878"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Tx
-&gt; UTxO' (TxOut CtxUTxO Era)
-&gt; Either EvaluationError EvaluationReport
</span><span class="hs-identifier hs-var">evaluateTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540878"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540877"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679540879"><span class="annot"><span class="annottext">EvaluationError
</span><a href="#local-6989586621679540879"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
String -&gt; m a
</span><span class="hs-identifier hs-var">failure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m ()) -&gt; String -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationError
</span><a href="#local-6989586621679540879"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679540880"><span class="annot"><span class="annottext">EvaluationReport
</span><a href="#local-6989586621679540880"><span class="hs-identifier hs-var">redeemerReport</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-359"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either ScriptExecutionError ExecutionUnits -&gt; Bool)
-&gt; [Either ScriptExecutionError ExecutionUnits] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">Either ScriptExecutionError ExecutionUnits -&gt; Bool
forall a b. Either a b -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#isLeft"><span class="hs-identifier hs-var">isLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationReport -&gt; [Either ScriptExecutionError ExecutionUnits]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationReport
</span><a href="#local-6989586621679540880"><span class="hs-identifier hs-var">redeemerReport</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
String -&gt; m a
</span><span class="hs-identifier hs-var">failure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m ()) -&gt; ([Text] -&gt; String) -&gt; [Text] -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
forall a. ToString a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall t. IsText t &quot;unlines&quot; =&gt; [t] -&gt; t
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; m ()) -&gt; [Text] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-361"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Text
forall a. IsString a =&gt; String -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.String.html#fromString"><span class="hs-identifier hs-var">fromString</span></a></span><span>
</span><span id="line-362"></span><span>            </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; [String] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Transaction evaluation failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; Tx -&gt; String
</span><span class="hs-identifier hs-var">renderTxWithUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540877"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540878"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-363"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Some redeemers failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationReport -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationReport
</span><a href="#local-6989586621679540880"><span class="hs-identifier hs-var">redeemerReport</span></a></span><span>
</span><span id="line-364"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-comment">-- | Expect to observe a transaction matching given predicate. This fails with</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- 'failure' if the predicate yields 'Nothing'.</span><span>
</span><span id="line-368"></span><span id="local-6989586621679540115"><span id="local-6989586621679540116"><span class="annot"><a href="Hydra.Chain.Direct.TxTraceSpec.html#observeTxMatching"><span class="hs-identifier hs-type">observeTxMatching</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679540115"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HeadObservation</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540116"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679540115"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679540116"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-369"></span><span id="observeTxMatching"><span class="annot"><span class="annottext">observeTxMatching :: forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
UTxO' (TxOut CtxUTxO Era)
-&gt; Tx -&gt; (HeadObservation -&gt; Maybe a) -&gt; m a
</span><a href="Hydra.Chain.Direct.TxTraceSpec.html#observeTxMatching"><span class="hs-identifier hs-var hs-var">observeTxMatching</span></a></span></span><span> </span><span id="local-6989586621679540897"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540897"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679540898"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540898"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span id="local-6989586621679540899"><span class="annot"><span class="annottext">HeadObservation -&gt; Maybe a
</span><a href="#local-6989586621679540899"><span class="hs-identifier hs-var">predicate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679540900"><span class="annot"><span class="annottext">res :: HeadObservation
</span><a href="#local-6989586621679540900"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; UTxO' (TxOut CtxUTxO Era) -&gt; Tx -&gt; HeadObservation
</span><span class="hs-identifier hs-var">observeHeadTx</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">Fixture.testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679540897"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679540898"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HeadObservation -&gt; Maybe a
</span><a href="#local-6989586621679540899"><span class="hs-identifier hs-var">predicate</span></a></span><span> </span><span class="annot"><span class="annottext">HeadObservation
</span><a href="#local-6989586621679540900"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679540901"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679540901"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679540901"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><span class="annottext">Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; m a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
String -&gt; m a
</span><span class="hs-identifier hs-var">failure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m a) -&gt; String -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Observation result not matching expectation, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HeadObservation -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">HeadObservation
</span><a href="#local-6989586621679540900"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-374"></span></pre></body></html>