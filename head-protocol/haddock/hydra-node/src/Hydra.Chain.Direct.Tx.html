<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | Smart constructors for creating Hydra protocol transactions to be used in</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- the 'Hydra.Chain.Direct' way of talking to the main-chain.</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- This module also encapsulates the transaction format used when talking to the</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- cardano-node, which is currently different from the 'Hydra.Ledger.Cardano',</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- thus we have not yet &quot;reached&quot; 'isomorphism'.</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Chain.Direct.Tx</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.Scripts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExUnits</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.TxAuxData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AlonzoTxAuxData</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Api</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><span class="hs-identifier">AlonzoPlutusPurpose</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><span class="hs-identifier">AsIndex</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><span class="hs-identifier">AsItem</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><span class="hs-identifier">EraTxAuxData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hashTxAuxData</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><span class="hs-identifier">Redeemers</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><span class="hs-identifier">auxDataHashTxBodyL</span></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="hs-identifier">auxDataTxL</span></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-identifier">bodyTxL</span></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-identifier">inputsTxBodyL</span></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-identifier">mintTxBodyL</span></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-identifier">outputsTxBodyL</span></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-identifier">rdmrsTxWitsL</span></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-identifier">referenceInputsTxBodyL</span></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-identifier">reqSignerHashesTxBodyL</span></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-identifier">unRedeemers</span></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-identifier">witsTxL</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Babbage.Core</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">redeemerPointerInverse</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StrictMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(.~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;&gt;~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/bytestring-0.11.5.3/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Base16</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Base16</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">StrictSeq</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api.Network</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">networkIdToNetwork</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Chain.html"><span class="hs-identifier">Hydra.Chain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.html#CommitBlueprintTx"><span class="hs-identifier">CommitBlueprintTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier">HeadParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html"><span class="hs-identifier">Hydra.Chain.Direct.ScriptRegistry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier">ScriptRegistry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html"><span class="hs-identifier">Hydra.Chain.Direct.TimeHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#PointInTime"><span class="hs-identifier">PointInTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.ContestationPeriod.html"><span class="hs-identifier">Hydra.ContestationPeriod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.ContestationPeriod.html#ContestationPeriod"><span class="hs-identifier">ContestationPeriod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.ContestationPeriod.html#fromChain"><span class="hs-identifier">fromChain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.ContestationPeriod.html#toChain"><span class="hs-identifier">toChain</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Commit</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Commit</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Head</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Head</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadState</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Head</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadTokens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HeadTokens</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Initial</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Initial</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.MintAction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MintAction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Burn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Mint</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Util</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hydraHeadV1</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Crypto.html"><span class="hs-identifier">Hydra.Crypto</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Crypto.html#MultiSignature"><span class="hs-identifier">MultiSignature</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Crypto.html#toPlutusSignatures"><span class="hs-identifier">toPlutusSignatures</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Data.ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">addContestationPeriod</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Data.ContestationPeriod</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OnChain</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Data.Party</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OnChain</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.HeadId.html"><span class="hs-identifier">Hydra.HeadId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier">HeadId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadSeed"><span class="hs-identifier">HeadSeed</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Ledger.html"><span class="hs-identifier">Hydra.Ledger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Ledger.html#IsTx"><span class="hs-identifier">IsTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Ledger.html#hashUTxO"><span class="hs-identifier">hashUTxO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Ledger.Cardano.html"><span class="hs-identifier">Hydra.Ledger.Cardano</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier">addReferenceInputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html"><span class="hs-identifier">Hydra.Ledger.Cardano.Builder</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier">addExtraRequiredSigners</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier">addInputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier">addOutputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addVkInputs"><span class="hs-identifier">addVkInputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#burnTokens"><span class="hs-identifier">burnTokens</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier">emptyTxBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#mintTokens"><span class="hs-identifier">mintTokens</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#setValidityLowerBound"><span class="hs-identifier">setValidityLowerBound</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#setValidityUpperBound"><span class="hs-identifier">setValidityUpperBound</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier">unsafeBuildTransaction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.OnChainId.html"><span class="hs-identifier">Hydra.OnChainId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.OnChainId.html#OnChainId"><span class="hs-identifier">OnChainId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Party.html"><span class="hs-identifier">Hydra.Party</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier">Party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Party.html#partyFromChain"><span class="hs-identifier">partyFromChain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Party.html#partyToChain"><span class="hs-identifier">partyToChain</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Plutus.Extras</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">posixFromUTCTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">posixToUTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Plutus.Orphans</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html"><span class="hs-identifier">Hydra.Snapshot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier">Snapshot</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#SnapshotNumber"><span class="hs-identifier">SnapshotNumber</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#fromChainSnapshot"><span class="hs-identifier">fromChainSnapshot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CurrencySymbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CurrencySymbol</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromBuiltin</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getPubKeyHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toBuiltin</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V2</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">vectorOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="annot"><span class="hs-comment">-- | Needed on-chain data to create Head transactions.</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">type</span><span> </span><span id="UTxOWithScript"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-var">UTxOWithScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">newtype</span><span> </span><span id="UTxOHash"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UTxOHash"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680309794"><span id="local-6989586621680309798"><span class="annot"><span class="annottext">UTxOHash -&gt; UTxOHash -&gt; Bool
(UTxOHash -&gt; UTxOHash -&gt; Bool)
-&gt; (UTxOHash -&gt; UTxOHash -&gt; Bool) -&gt; Eq UTxOHash
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: UTxOHash -&gt; UTxOHash -&gt; Bool
== :: UTxOHash -&gt; UTxOHash -&gt; Bool
$c/= :: UTxOHash -&gt; UTxOHash -&gt; Bool
/= :: UTxOHash -&gt; UTxOHash -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680309803"><span id="local-6989586621680309809"><span id="local-6989586621680309813"><span class="annot"><span class="annottext">Int -&gt; UTxOHash -&gt; ShowS
[UTxOHash] -&gt; ShowS
UTxOHash -&gt; String
(Int -&gt; UTxOHash -&gt; ShowS)
-&gt; (UTxOHash -&gt; String) -&gt; ([UTxOHash] -&gt; ShowS) -&gt; Show UTxOHash
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; UTxOHash -&gt; ShowS
showsPrec :: Int -&gt; UTxOHash -&gt; ShowS
$cshow :: UTxOHash -&gt; String
show :: UTxOHash -&gt; String
$cshowList :: [UTxOHash] -&gt; ShowS
showList :: [UTxOHash] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680309817"><span id="local-6989586621680309819"><span class="annot"><span class="annottext">(forall x. UTxOHash -&gt; Rep UTxOHash x)
-&gt; (forall x. Rep UTxOHash x -&gt; UTxOHash) -&gt; Generic UTxOHash
forall x. Rep UTxOHash x -&gt; UTxOHash
forall x. UTxOHash -&gt; Rep UTxOHash x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. UTxOHash -&gt; Rep UTxOHash x
from :: forall x. UTxOHash -&gt; Rep UTxOHash x
$cto :: forall x. Rep UTxOHash x -&gt; UTxOHash
to :: forall x. Rep UTxOHash x -&gt; UTxOHash
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680309824"><span id="local-6989586621680309828"><span id="local-6989586621680309831"><span id="local-6989586621680309834"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-92"></span><span>  </span><span id="local-6989586621680309839"><span class="annot"><span class="annottext">toJSON :: UTxOHash -&gt; Value
</span><a href="#local-6989586621680309839"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span> </span><span id="local-6989586621680309841"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680309841"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">Aeson.String</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; (ByteString -&gt; Text) -&gt; ByteString -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
forall a b. ConvertUtf8 a b =&gt; b -&gt; a
</span><span class="hs-identifier hs-var">decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Value) -&gt; ByteString -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">Base16.encode</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680309841"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680309848"><span id="local-6989586621680309852"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-96"></span><span>  </span><span id="local-6989586621680309860"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser UTxOHash
</span><a href="#local-6989586621680309860"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Text -&gt; Parser UTxOHash) -&gt; Value -&gt; Parser UTxOHash
forall a. String -&gt; (Text -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">Aeson.withText</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UTxOHash&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Text -&gt; Parser UTxOHash) -&gt; Value -&gt; Parser UTxOHash)
-&gt; (Text -&gt; Parser UTxOHash) -&gt; Value -&gt; Parser UTxOHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680309863"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680309863"><span class="hs-identifier hs-var">cborText</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String ByteString
</span><span class="hs-identifier hs-var">Base16.decode</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String ByteString)
-&gt; ByteString -&gt; Either String ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
forall a b. ConvertUtf8 a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680309863"><span class="hs-identifier hs-var">cborText</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-98"></span><span>      </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680309866"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680309866"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser UTxOHash
forall a. String -&gt; Parser a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.Fail.html#fail"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680309866"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680309867"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680309867"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOHash -&gt; Parser UTxOHash
forall a. a -&gt; Parser a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxOHash -&gt; Parser UTxOHash) -&gt; UTxOHash -&gt; Parser UTxOHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680309867"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680309870"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621680309878"><span class="annot"><span class="annottext">arbitrary :: Gen UTxOHash
</span><a href="#local-6989586621680309878"><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; UTxOHash)
-&gt; ([Word8] -&gt; ByteString) -&gt; [Word8] -&gt; UTxOHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/bytestring-0.11.5.3/src/Data.ByteString.html#pack"><span class="hs-identifier hs-var">BS.pack</span></a></span><span> </span><span class="annot"><span class="annottext">([Word8] -&gt; UTxOHash) -&gt; Gen [Word8] -&gt; Gen UTxOHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen Word8 -&gt; Gen [Word8]
forall a. Int -&gt; Gen a -&gt; Gen [a]
</span><span class="hs-identifier hs-var">vectorOf</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Gen Word8
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><span class="hs-comment">-- | Representation of the Head output after an Init transaction.</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">data</span><span> </span><span id="InitialThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-var">InitialThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InitialThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-var">InitialThreadOutput</span></a></span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AinitialThreadUTxO%3AInitialThreadOutput"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialThreadUTxO%3AInitialThreadOutput"><span class="hs-identifier hs-var hs-var">initialThreadUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AinitialContestationPeriod%3AInitialThreadOutput"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialContestationPeriod%3AInitialThreadOutput"><span class="hs-identifier hs-var hs-var">initialContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnChain.ContestationPeriod</span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AinitialParties%3AInitialThreadOutput"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialParties%3AInitialThreadOutput"><span class="hs-identifier hs-var hs-var">initialParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChain.Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680309887"><span id="local-6989586621680309898"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
(InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool)
-&gt; (InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool)
-&gt; Eq InitialThreadOutput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
== :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
$c/= :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
/= :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680309905"><span id="local-6989586621680309917"><span id="local-6989586621680309921"><span class="annot"><span class="annottext">Int -&gt; InitialThreadOutput -&gt; ShowS
[InitialThreadOutput] -&gt; ShowS
InitialThreadOutput -&gt; String
(Int -&gt; InitialThreadOutput -&gt; ShowS)
-&gt; (InitialThreadOutput -&gt; String)
-&gt; ([InitialThreadOutput] -&gt; ShowS)
-&gt; Show InitialThreadOutput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; InitialThreadOutput -&gt; ShowS
showsPrec :: Int -&gt; InitialThreadOutput -&gt; ShowS
$cshow :: InitialThreadOutput -&gt; String
show :: InitialThreadOutput -&gt; String
$cshowList :: [InitialThreadOutput] -&gt; ShowS
showList :: [InitialThreadOutput] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680309927"><span id="local-6989586621680309929"><span class="annot"><span class="annottext">(forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x)
-&gt; (forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput)
-&gt; Generic InitialThreadOutput
forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput
forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x
from :: forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x
$cto :: forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput
to :: forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680309932"><span id="local-6989586621680309939"><span id="local-6989586621680309942"><span id="local-6989586621680309945"><span id="local-6989586621680309948"><span class="annot"><span class="annottext">[InitialThreadOutput] -&gt; Value
[InitialThreadOutput] -&gt; Encoding
InitialThreadOutput -&gt; Bool
InitialThreadOutput -&gt; Value
InitialThreadOutput -&gt; Encoding
(InitialThreadOutput -&gt; Value)
-&gt; (InitialThreadOutput -&gt; Encoding)
-&gt; ([InitialThreadOutput] -&gt; Value)
-&gt; ([InitialThreadOutput] -&gt; Encoding)
-&gt; (InitialThreadOutput -&gt; Bool)
-&gt; ToJSON InitialThreadOutput
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: InitialThreadOutput -&gt; Value
toJSON :: InitialThreadOutput -&gt; Value
$ctoEncoding :: InitialThreadOutput -&gt; Encoding
toEncoding :: InitialThreadOutput -&gt; Encoding
$ctoJSONList :: [InitialThreadOutput] -&gt; Value
toJSONList :: [InitialThreadOutput] -&gt; Value
$ctoEncodingList :: [InitialThreadOutput] -&gt; Encoding
toEncodingList :: [InitialThreadOutput] -&gt; Encoding
$comitField :: InitialThreadOutput -&gt; Bool
omitField :: InitialThreadOutput -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310073"><span id="local-6989586621680310080"><span id="local-6989586621680310083"><span class="annot"><span class="annottext">Maybe InitialThreadOutput
Value -&gt; Parser [InitialThreadOutput]
Value -&gt; Parser InitialThreadOutput
(Value -&gt; Parser InitialThreadOutput)
-&gt; (Value -&gt; Parser [InitialThreadOutput])
-&gt; Maybe InitialThreadOutput
-&gt; FromJSON InitialThreadOutput
forall a.
(Value -&gt; Parser a)
-&gt; (Value -&gt; Parser [a]) -&gt; Maybe a -&gt; FromJSON a
$cparseJSON :: Value -&gt; Parser InitialThreadOutput
parseJSON :: Value -&gt; Parser InitialThreadOutput
$cparseJSONList :: Value -&gt; Parser [InitialThreadOutput]
parseJSONList :: Value -&gt; Parser [InitialThreadOutput]
$comittedField :: Maybe InitialThreadOutput
omittedField :: Maybe InitialThreadOutput
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-type">InitialThreadOutput</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>  </span><span id="local-6989586621680310223"><span class="annot"><span class="annottext">arbitrary :: Gen InitialThreadOutput
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen InitialThreadOutput
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621680310262"><span class="annot"><span class="annottext">shrink :: InitialThreadOutput -&gt; [InitialThreadOutput]
</span><a href="#local-6989586621680310262"><span class="hs-identifier hs-var hs-var hs-var hs-var">shrink</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InitialThreadOutput -&gt; [InitialThreadOutput]
forall a.
(Generic a, RecursivelyShrink (Rep a), GSubterms (Rep a) a) =&gt;
a -&gt; [a]
</span><span class="hs-identifier hs-var">genericShrink</span></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><span class="hs-comment">-- | Representation of the Head output after a CollectCom transaction.</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">data</span><span> </span><span id="OpenThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-var">OpenThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OpenThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-var">OpenThreadOutput</span></a></span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AopenThreadUTxO%3AOpenThreadOutput"><span class="annot"><span class="annottext">OpenThreadOutput -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenThreadUTxO%3AOpenThreadOutput"><span class="hs-identifier hs-var hs-var">openThreadUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AopenContestationPeriod%3AOpenThreadOutput"><span class="annot"><span class="annottext">OpenThreadOutput -&gt; ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenContestationPeriod%3AOpenThreadOutput"><span class="hs-identifier hs-var hs-var">openContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnChain.ContestationPeriod</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AopenParties%3AOpenThreadOutput"><span class="annot"><span class="annottext">OpenThreadOutput -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenParties%3AOpenThreadOutput"><span class="hs-identifier hs-var hs-var">openParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChain.Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680310270"><span id="local-6989586621680310278"><span class="annot"><span class="annottext">OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
(OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool)
-&gt; (OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool)
-&gt; Eq OpenThreadOutput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
== :: OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
$c/= :: OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
/= :: OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310282"><span id="local-6989586621680310291"><span id="local-6989586621680310295"><span class="annot"><span class="annottext">Int -&gt; OpenThreadOutput -&gt; ShowS
[OpenThreadOutput] -&gt; ShowS
OpenThreadOutput -&gt; String
(Int -&gt; OpenThreadOutput -&gt; ShowS)
-&gt; (OpenThreadOutput -&gt; String)
-&gt; ([OpenThreadOutput] -&gt; ShowS)
-&gt; Show OpenThreadOutput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; OpenThreadOutput -&gt; ShowS
showsPrec :: Int -&gt; OpenThreadOutput -&gt; ShowS
$cshow :: OpenThreadOutput -&gt; String
show :: OpenThreadOutput -&gt; String
$cshowList :: [OpenThreadOutput] -&gt; ShowS
showList :: [OpenThreadOutput] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310298"><span id="local-6989586621680310300"><span class="annot"><span class="annottext">(forall x. OpenThreadOutput -&gt; Rep OpenThreadOutput x)
-&gt; (forall x. Rep OpenThreadOutput x -&gt; OpenThreadOutput)
-&gt; Generic OpenThreadOutput
forall x. Rep OpenThreadOutput x -&gt; OpenThreadOutput
forall x. OpenThreadOutput -&gt; Rep OpenThreadOutput x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. OpenThreadOutput -&gt; Rep OpenThreadOutput x
from :: forall x. OpenThreadOutput -&gt; Rep OpenThreadOutput x
$cto :: forall x. Rep OpenThreadOutput x -&gt; OpenThreadOutput
to :: forall x. Rep OpenThreadOutput x -&gt; OpenThreadOutput
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680310303"><span id="local-6989586621680310310"><span id="local-6989586621680310313"><span id="local-6989586621680310316"><span id="local-6989586621680310319"><span class="annot"><span class="annottext">[OpenThreadOutput] -&gt; Value
[OpenThreadOutput] -&gt; Encoding
OpenThreadOutput -&gt; Bool
OpenThreadOutput -&gt; Value
OpenThreadOutput -&gt; Encoding
(OpenThreadOutput -&gt; Value)
-&gt; (OpenThreadOutput -&gt; Encoding)
-&gt; ([OpenThreadOutput] -&gt; Value)
-&gt; ([OpenThreadOutput] -&gt; Encoding)
-&gt; (OpenThreadOutput -&gt; Bool)
-&gt; ToJSON OpenThreadOutput
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: OpenThreadOutput -&gt; Value
toJSON :: OpenThreadOutput -&gt; Value
$ctoEncoding :: OpenThreadOutput -&gt; Encoding
toEncoding :: OpenThreadOutput -&gt; Encoding
$ctoJSONList :: [OpenThreadOutput] -&gt; Value
toJSONList :: [OpenThreadOutput] -&gt; Value
$ctoEncodingList :: [OpenThreadOutput] -&gt; Encoding
toEncodingList :: [OpenThreadOutput] -&gt; Encoding
$comitField :: OpenThreadOutput -&gt; Bool
omitField :: OpenThreadOutput -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310402"><span id="local-6989586621680310409"><span id="local-6989586621680310412"><span class="annot"><span class="annottext">Maybe OpenThreadOutput
Value -&gt; Parser [OpenThreadOutput]
Value -&gt; Parser OpenThreadOutput
(Value -&gt; Parser OpenThreadOutput)
-&gt; (Value -&gt; Parser [OpenThreadOutput])
-&gt; Maybe OpenThreadOutput
-&gt; FromJSON OpenThreadOutput
forall a.
(Value -&gt; Parser a)
-&gt; (Value -&gt; Parser [a]) -&gt; Maybe a -&gt; FromJSON a
$cparseJSON :: Value -&gt; Parser OpenThreadOutput
parseJSON :: Value -&gt; Parser OpenThreadOutput
$cparseJSONList :: Value -&gt; Parser [OpenThreadOutput]
parseJSONList :: Value -&gt; Parser [OpenThreadOutput]
$comittedField :: Maybe OpenThreadOutput
omittedField :: Maybe OpenThreadOutput
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-type">OpenThreadOutput</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621680310515"><span class="annot"><span class="annottext">arbitrary :: Gen OpenThreadOutput
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen OpenThreadOutput
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621680310545"><span class="annot"><span class="annottext">shrink :: OpenThreadOutput -&gt; [OpenThreadOutput]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">shrink</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenThreadOutput -&gt; [OpenThreadOutput]
forall a.
(Generic a, RecursivelyShrink (Rep a), GSubterms (Rep a) a) =&gt;
a -&gt; [a]
</span><span class="hs-identifier hs-var">genericShrink</span></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-keyword">data</span><span> </span><span id="ClosedThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-var">ClosedThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ClosedThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-var">ClosedThreadOutput</span></a></span></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AclosedThreadUTxO%3AClosedThreadOutput"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedThreadUTxO%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedThreadUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AclosedParties%3AClosedThreadOutput"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedParties%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChain.Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AclosedContestationDeadline%3AClosedThreadOutput"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; POSIXTime
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContestationDeadline%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedContestationDeadline</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Plutus.POSIXTime</span></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AclosedContesters%3AClosedThreadOutput"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContesters%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedContesters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Plutus.PubKeyHash</span></span><span class="hs-special">]</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680310552"><span id="local-6989586621680310563"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
(ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool)
-&gt; (ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool)
-&gt; Eq ClosedThreadOutput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
== :: ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
$c/= :: ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
/= :: ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310568"><span id="local-6989586621680310580"><span id="local-6989586621680310584"><span class="annot"><span class="annottext">Int -&gt; ClosedThreadOutput -&gt; ShowS
[ClosedThreadOutput] -&gt; ShowS
ClosedThreadOutput -&gt; String
(Int -&gt; ClosedThreadOutput -&gt; ShowS)
-&gt; (ClosedThreadOutput -&gt; String)
-&gt; ([ClosedThreadOutput] -&gt; ShowS)
-&gt; Show ClosedThreadOutput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ClosedThreadOutput -&gt; ShowS
showsPrec :: Int -&gt; ClosedThreadOutput -&gt; ShowS
$cshow :: ClosedThreadOutput -&gt; String
show :: ClosedThreadOutput -&gt; String
$cshowList :: [ClosedThreadOutput] -&gt; ShowS
showList :: [ClosedThreadOutput] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310588"><span id="local-6989586621680310590"><span class="annot"><span class="annottext">(forall x. ClosedThreadOutput -&gt; Rep ClosedThreadOutput x)
-&gt; (forall x. Rep ClosedThreadOutput x -&gt; ClosedThreadOutput)
-&gt; Generic ClosedThreadOutput
forall x. Rep ClosedThreadOutput x -&gt; ClosedThreadOutput
forall x. ClosedThreadOutput -&gt; Rep ClosedThreadOutput x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. ClosedThreadOutput -&gt; Rep ClosedThreadOutput x
from :: forall x. ClosedThreadOutput -&gt; Rep ClosedThreadOutput x
$cto :: forall x. Rep ClosedThreadOutput x -&gt; ClosedThreadOutput
to :: forall x. Rep ClosedThreadOutput x -&gt; ClosedThreadOutput
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680310593"><span id="local-6989586621680310600"><span id="local-6989586621680310603"><span id="local-6989586621680310606"><span id="local-6989586621680310609"><span class="annot"><span class="annottext">[ClosedThreadOutput] -&gt; Value
[ClosedThreadOutput] -&gt; Encoding
ClosedThreadOutput -&gt; Bool
ClosedThreadOutput -&gt; Value
ClosedThreadOutput -&gt; Encoding
(ClosedThreadOutput -&gt; Value)
-&gt; (ClosedThreadOutput -&gt; Encoding)
-&gt; ([ClosedThreadOutput] -&gt; Value)
-&gt; ([ClosedThreadOutput] -&gt; Encoding)
-&gt; (ClosedThreadOutput -&gt; Bool)
-&gt; ToJSON ClosedThreadOutput
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: ClosedThreadOutput -&gt; Value
toJSON :: ClosedThreadOutput -&gt; Value
$ctoEncoding :: ClosedThreadOutput -&gt; Encoding
toEncoding :: ClosedThreadOutput -&gt; Encoding
$ctoJSONList :: [ClosedThreadOutput] -&gt; Value
toJSONList :: [ClosedThreadOutput] -&gt; Value
$ctoEncodingList :: [ClosedThreadOutput] -&gt; Encoding
toEncodingList :: [ClosedThreadOutput] -&gt; Encoding
$comitField :: ClosedThreadOutput -&gt; Bool
omitField :: ClosedThreadOutput -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310713"><span id="local-6989586621680310720"><span id="local-6989586621680310723"><span class="annot"><span class="annottext">Maybe ClosedThreadOutput
Value -&gt; Parser [ClosedThreadOutput]
Value -&gt; Parser ClosedThreadOutput
(Value -&gt; Parser ClosedThreadOutput)
-&gt; (Value -&gt; Parser [ClosedThreadOutput])
-&gt; Maybe ClosedThreadOutput
-&gt; FromJSON ClosedThreadOutput
forall a.
(Value -&gt; Parser a)
-&gt; (Value -&gt; Parser [a]) -&gt; Maybe a -&gt; FromJSON a
$cparseJSON :: Value -&gt; Parser ClosedThreadOutput
parseJSON :: Value -&gt; Parser ClosedThreadOutput
$cparseJSONList :: Value -&gt; Parser [ClosedThreadOutput]
parseJSONList :: Value -&gt; Parser [ClosedThreadOutput]
$comittedField :: Maybe ClosedThreadOutput
omittedField :: Maybe ClosedThreadOutput
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-type">ClosedThreadOutput</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>  </span><span id="local-6989586621680310853"><span class="annot"><span class="annottext">arbitrary :: Gen ClosedThreadOutput
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen ClosedThreadOutput
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-141"></span><span>  </span><span id="local-6989586621680310891"><span class="annot"><span class="annottext">shrink :: ClosedThreadOutput -&gt; [ClosedThreadOutput]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">shrink</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; [ClosedThreadOutput]
forall a.
(Generic a, RecursivelyShrink (Rep a), GSubterms (Rep a) a) =&gt;
a -&gt; [a]
</span><span class="hs-identifier hs-var">genericShrink</span></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-type">hydraHeadV1AssetName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span>
</span><span id="line-144"></span><span id="hydraHeadV1AssetName"><span class="annot"><span class="annottext">hydraHeadV1AssetName :: AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var hs-var">hydraHeadV1AssetName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; AssetName
</span><span class="hs-identifier hs-var">AssetName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ByteString
forall arep a. FromBuiltin arep a =&gt; arep -&gt; a
</span><span class="hs-identifier hs-var">fromBuiltin</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><span class="hs-identifier hs-var">hydraHeadV1</span></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | The metadata label used for identifying Hydra protocol transactions. As</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- suggested by a friendly large language model: The number most commonly</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- associated with &quot;Hydra&quot; is 5, as in the mythological creature Hydra, which</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- had multiple heads, and the number 5 often symbolizes multiplicity or</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- diversity. However, there is no specific numerical association for Hydra</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- smaller than 10000 beyond this mythological reference.</span><span>
</span><span id="line-152"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#hydraMetadataLabel"><span class="hs-identifier hs-type">hydraMetadataLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Word.html#Word64"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-153"></span><span id="hydraMetadataLabel"><span class="annot"><span class="annottext">hydraMetadataLabel :: Word64
</span><a href="Hydra.Chain.Direct.Tx.html#hydraMetadataLabel"><span class="hs-identifier hs-var hs-var">hydraMetadataLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">55555</span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">-- | Create a transaction metadata entry to identify Hydra transactions (for</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- informational purposes).</span><span>
</span><span id="line-157"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkHydraHeadV1TxName"><span class="hs-identifier hs-type">mkHydraHeadV1TxName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxMetadata</span></span><span>
</span><span id="line-158"></span><span id="mkHydraHeadV1TxName"><span class="annot"><span class="annottext">mkHydraHeadV1TxName :: Text -&gt; TxMetadata
</span><a href="Hydra.Chain.Direct.Tx.html#mkHydraHeadV1TxName"><span class="hs-identifier hs-var hs-var">mkHydraHeadV1TxName</span></a></span></span><span> </span><span id="local-6989586621680310896"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680310896"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue -&gt; TxMetadata
</span><span class="hs-identifier hs-var">TxMetadata</span></span><span> </span><span class="annot"><span class="annottext">(Map Word64 TxMetadataValue -&gt; TxMetadata)
-&gt; Map Word64 TxMetadataValue -&gt; TxMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word64, TxMetadataValue)] -&gt; Map Word64 TxMetadataValue
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="Hydra.Chain.Direct.Tx.html#hydraMetadataLabel"><span class="hs-identifier hs-var">hydraMetadataLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TxMetadataValue
</span><span class="hs-identifier hs-var">TxMetaText</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; TxMetadataValue) -&gt; Text -&gt; TxMetadataValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;HydraV1/&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680310896"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | Get the metadata entry to identify Hydra transactions (for informational</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- purposes).</span><span>
</span><span id="line-163"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#getHydraHeadV1TxName"><span class="hs-identifier hs-type">getHydraHeadV1TxName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-164"></span><span id="getHydraHeadV1TxName"><span class="annot"><span class="annottext">getHydraHeadV1TxName :: Tx -&gt; Maybe Text
</span><a href="Hydra.Chain.Direct.Tx.html#getHydraHeadV1TxName"><span class="hs-identifier hs-var hs-var">getHydraHeadV1TxName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="annottext">TxMetadataInEra -&gt; Maybe Text
</span><a href="#local-6989586621680310901"><span class="hs-identifier hs-var">lookupName</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMetadataInEra -&gt; Maybe Text)
-&gt; (Tx -&gt; TxMetadataInEra) -&gt; Tx -&gt; Maybe Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx -&gt; TxMetadataInEra
forall buidl. TxBodyContent buidl -&gt; TxMetadataInEra
</span><span class="hs-identifier hs-var">txMetadata</span></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent ViewTx -&gt; TxMetadataInEra)
-&gt; (Tx -&gt; TxBodyContent ViewTx) -&gt; Tx -&gt; TxMetadataInEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody Era -&gt; TxBodyContent ViewTx
forall era. TxBody era -&gt; TxBodyContent ViewTx era
</span><span class="hs-identifier hs-var">getTxBodyContent</span></span><span> </span><span class="annot"><span class="annottext">(TxBody Era -&gt; TxBodyContent ViewTx)
-&gt; (Tx -&gt; TxBody Era) -&gt; Tx -&gt; TxBodyContent ViewTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxBody Era
forall era. Tx era -&gt; TxBody era
</span><span class="hs-identifier hs-var">getTxBody</span></span><span>
</span><span id="line-166"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621680310901"><span class="annot"><span class="annottext">lookupName :: TxMetadataInEra -&gt; Maybe Text
</span><a href="#local-6989586621680310901"><span class="hs-identifier hs-var hs-var">lookupName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">TxMetadataInEra
</span><span class="hs-identifier hs-var">TxMetadataNone</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">TxMetadataInEra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxMetadata</span></span><span> </span><span id="local-6989586621680310908"><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621680310908"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-170"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Map Word64 TxMetadataValue -&gt; Maybe TxMetadataValue
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="Hydra.Chain.Direct.Tx.html#hydraMetadataLabel"><span class="hs-identifier hs-var">hydraMetadataLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621680310908"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxMetaText</span></span><span> </span><span id="local-6989586621680310910"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680310910"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680310910"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><span class="annottext">Maybe TxMetadataValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="annot"><span class="hs-comment">-- * Create Hydra Head transactions</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- | Create the init transaction from some 'HeadParameters' and a single TxIn</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- which will be used as unique parameter for minting NFTs.</span><span>
</span><span id="line-178"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#initTx"><span class="hs-identifier hs-type">initTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Seed input.</span></span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Verification key hashes of all participants.</span></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.OnChainId.html#OnChainId"><span class="hs-identifier hs-type">OnChainId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier hs-type">HeadParameters</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-186"></span><span id="initTx"><span class="annot"><span class="annottext">initTx :: NetworkId -&gt; TxIn -&gt; [OnChainId] -&gt; HeadParameters -&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#initTx"><span class="hs-identifier hs-var hs-var">initTx</span></a></span></span><span> </span><span id="local-6989586621680310913"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310913"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680310914"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310914"><span class="hs-identifier hs-var">seedTxIn</span></a></span></span><span> </span><span id="local-6989586621680310915"><span class="annot"><span class="annottext">[OnChainId]
</span><a href="#local-6989586621680310915"><span class="hs-identifier hs-var">participants</span></a></span></span><span> </span><span id="local-6989586621680310916"><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621680310916"><span class="hs-identifier hs-var">parameters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addVkInputs"><span class="hs-identifier hs-var">addVkInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310914"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; TxIn -&gt; HeadParameters -&gt; TxOut CtxTx
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutputInitial"><span class="hs-identifier hs-var">mkHeadOutputInitial</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310913"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310914"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621680310916"><span class="hs-identifier hs-var">parameters</span></a></span><span>
</span><span id="line-192"></span><span>            </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; [TxOut CtxTx] -&gt; [TxOut CtxTx]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">(OnChainId -&gt; TxOut CtxTx) -&gt; [OnChainId] -&gt; [TxOut CtxTx]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; TxIn -&gt; OnChainId -&gt; TxOut CtxTx
</span><a href="Hydra.Chain.Direct.Tx.html#mkInitialOutput"><span class="hs-identifier hs-var">mkInitialOutput</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310913"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310914"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[OnChainId]
</span><a href="#local-6989586621680310915"><span class="hs-identifier hs-var">participants</span></a></span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
-&gt; MintAction
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
forall redeemer.
ToScriptData redeemer =&gt;
PlutusScript
-&gt; redeemer
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#mintTokens"><span class="hs-identifier hs-var">mintTokens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; PlutusScript
</span><span class="hs-identifier hs-var">HeadTokens.mkHeadTokenScript</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310914"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MintAction
</span><span class="hs-identifier hs-var">Mint</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AssetName, Quantity)
-&gt; [(AssetName, Quantity)] -&gt; [(AssetName, Quantity)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetName, Quantity)]
</span><a href="#local-6989586621680310921"><span class="hs-identifier hs-var">participationTokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
forall era build.
TxMetadataInEra era
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><span class="hs-identifier hs-var">setTxMetadata</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxMetadata -&gt; TxMetadataInEra
</span><span class="hs-identifier hs-var">TxMetadataInEra</span></span><span> </span><span class="annot"><span class="annottext">(TxMetadata -&gt; TxMetadataInEra) -&gt; TxMetadata -&gt; TxMetadataInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TxMetadata
</span><a href="Hydra.Chain.Direct.Tx.html#mkHydraHeadV1TxName"><span class="hs-identifier hs-var">mkHydraHeadV1TxName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;InitTx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621680310921"><span class="annot"><span class="annottext">participationTokens :: [(AssetName, Quantity)]
</span><a href="#local-6989586621680310921"><span class="hs-identifier hs-var hs-var">participationTokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">OnChainId -&gt; AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#onChainIdToAssetName"><span class="hs-identifier hs-var">onChainIdToAssetName</span></a></span><span> </span><span class="annot"><span class="annottext">OnChainId
</span><a href="#local-6989586621680310924"><span class="hs-identifier hs-var">oid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680310924"><span class="annot"><span class="annottext">OnChainId
</span><a href="#local-6989586621680310924"><span class="hs-identifier hs-var">oid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[OnChainId]
</span><a href="#local-6989586621680310915"><span class="hs-identifier hs-var">participants</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span id="local-6989586621680308831"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutput"><span class="hs-identifier hs-type">mkHeadOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOutDatum</span></span><span> </span><span class="annot"><a href="#local-6989586621680308831"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621680308831"><span class="hs-identifier hs-type">ctx</span></a></span></span><span>
</span><span id="line-201"></span><span id="mkHeadOutput"><span class="annot"><span class="annottext">mkHeadOutput :: forall ctx. NetworkId -&gt; PolicyId -&gt; TxOutDatum ctx -&gt; TxOut ctx
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutput"><span class="hs-identifier hs-var hs-var">mkHeadOutput</span></a></span></span><span> </span><span id="local-6989586621680310929"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310929"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680310930"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680310930"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span></span><span> </span><span id="local-6989586621680310931"><span class="annot"><span class="annottext">TxOutDatum ctx
</span><a href="#local-6989586621680310931"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310929"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680310934"><span class="hs-identifier hs-var">headScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Value
</span><span class="hs-identifier hs-var">valueFromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680310930"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">TxOutDatum ctx
</span><a href="#local-6989586621680310931"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-207"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>  </span><span id="local-6989586621680310934"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621680310934"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutputInitial"><span class="hs-identifier hs-type">mkHeadOutputInitial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier hs-type">HeadParameters</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxTx</span></span><span>
</span><span id="line-211"></span><span id="mkHeadOutputInitial"><span class="annot"><span class="annottext">mkHeadOutputInitial :: NetworkId -&gt; TxIn -&gt; HeadParameters -&gt; TxOut CtxTx
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutputInitial"><span class="hs-identifier hs-var hs-var">mkHeadOutputInitial</span></a></span></span><span> </span><span id="local-6989586621680310940"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310940"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680310941"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310941"><span class="hs-identifier hs-var">seedTxIn</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier hs-type">HeadParameters</span></a></span><span class="hs-special">{</span><span id="local-6989586621680310942"><span class="annot"><span class="annottext">ContestationPeriod
contestationPeriod :: ContestationPeriod
$sel:contestationPeriod:HeadParameters :: HeadParameters -&gt; ContestationPeriod
</span><a href="#local-6989586621680310942"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310944"><span class="annot"><span class="annottext">[Party]
parties :: [Party]
$sel:parties:HeadParameters :: HeadParameters -&gt; [Party]
</span><a href="#local-6989586621680310944"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><span class="annottext">NetworkId -&gt; PolicyId -&gt; TxOutDatum CtxTx -&gt; TxOut CtxTx
forall ctx. NetworkId -&gt; PolicyId -&gt; TxOutDatum ctx -&gt; TxOut ctx
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutput"><span class="hs-identifier hs-var">mkHeadOutput</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310940"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680310946"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680310947"><span class="hs-identifier hs-var">headDatum</span></a></span><span>
</span><span id="line-213"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-214"></span><span>  </span><span id="local-6989586621680310946"><span class="annot"><span class="annottext">tokenPolicyId :: PolicyId
</span><a href="#local-6989586621680310946"><span class="hs-identifier hs-var hs-var">tokenPolicyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; PolicyId
</span><span class="hs-identifier hs-var">HeadTokens.headPolicyId</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310941"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621680310947"><span class="annot"><span class="annottext">headDatum :: TxOutDatum CtxTx
</span><a href="#local-6989586621680310947"><span class="hs-identifier hs-var hs-var">headDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">State -&gt; TxOutDatum CtxTx
forall era a ctx.
(ToScriptData a, IsBabbageEraOnwards era) =&gt;
a -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">mkTxOutDatumInline</span></span><span> </span><span class="annot"><span class="annottext">(State -&gt; TxOutDatum CtxTx) -&gt; State -&gt; TxOutDatum CtxTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-217"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Initial</span></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:Initial :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><a href="Hydra.ContestationPeriod.html#toChain"><span class="hs-identifier hs-var">toChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680310942"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:Initial :: [Party]
</span><span class="hs-identifier hs-var">parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Party) -&gt; [Party] -&gt; [Party]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Party
</span><a href="Hydra.Party.html#partyToChain"><span class="hs-identifier hs-var">partyToChain</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680310944"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Initial :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">toPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680310946"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:seed:Initial :: TxOutRef
</span><span class="hs-identifier hs-var">seed</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; TxOutRef
</span><span class="hs-identifier hs-var">toPlutusTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310941"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkInitialOutput"><span class="hs-identifier hs-type">mkInitialOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.OnChainId.html#OnChainId"><span class="hs-identifier hs-type">OnChainId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxTx</span></span><span>
</span><span id="line-225"></span><span id="mkInitialOutput"><span class="annot"><span class="annottext">mkInitialOutput :: NetworkId -&gt; TxIn -&gt; OnChainId -&gt; TxOut CtxTx
</span><a href="Hydra.Chain.Direct.Tx.html#mkInitialOutput"><span class="hs-identifier hs-var hs-var">mkInitialOutput</span></a></span></span><span> </span><span id="local-6989586621680310957"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310957"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680310958"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310958"><span class="hs-identifier hs-var">seedTxIn</span></a></span></span><span> </span><span id="local-6989586621680310959"><span class="annot"><span class="annottext">OnChainId
</span><a href="#local-6989586621680310959"><span class="hs-identifier hs-var">participant</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value -&gt; TxOutDatum CtxTx -&gt; ReferenceScript -&gt; TxOut CtxTx
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621680310960"><span class="hs-identifier hs-var">initialAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680310961"><span class="hs-identifier hs-var">initialValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680310962"><span class="hs-identifier hs-var">initialDatum</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-227"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621680310963"><span class="annot"><span class="annottext">tokenPolicyId :: PolicyId
</span><a href="#local-6989586621680310963"><span class="hs-identifier hs-var hs-var">tokenPolicyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; PolicyId
</span><span class="hs-identifier hs-var">HeadTokens.headPolicyId</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310958"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621680310961"><span class="annot"><span class="annottext">initialValue :: Value
</span><a href="#local-6989586621680310961"><span class="hs-identifier hs-var hs-var">initialValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Value
</span><span class="hs-identifier hs-var">valueFromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680310963"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OnChainId -&gt; AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#onChainIdToAssetName"><span class="hs-identifier hs-var">onChainIdToAssetName</span></a></span><span> </span><span class="annot"><span class="annottext">OnChainId
</span><a href="#local-6989586621680310959"><span class="hs-identifier hs-var">participant</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621680310960"><span class="annot"><span class="annottext">initialAddress :: AddressInEra
</span><a href="#local-6989586621680310960"><span class="hs-identifier hs-var hs-var">initialAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310957"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680310964"><span class="hs-identifier hs-var">initialScript</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621680310964"><span class="annot"><span class="annottext">initialScript :: PlutusScript lang
</span><a href="#local-6989586621680310964"><span class="hs-identifier hs-var hs-var">initialScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Initial.validatorScript</span></span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621680310962"><span class="annot"><span class="annottext">initialDatum :: TxOutDatum CtxTx
</span><a href="#local-6989586621680310962"><span class="hs-identifier hs-var hs-var">initialDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="annottext">Datum -&gt; TxOutDatum CtxTx
forall era a ctx.
(ToScriptData a, IsBabbageEraOnwards era) =&gt;
a -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">mkTxOutDatumInline</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; TxOutDatum CtxTx) -&gt; Datum -&gt; TxOutDatum CtxTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Datum
</span><span class="hs-identifier hs-var">Initial.datum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">toPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680310963"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><span class="hs-comment">-- | Craft a commit transaction which includes the &quot;committed&quot; utxo as a datum.</span></span><span>
</span><span id="line-239"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#commitTx"><span class="hs-identifier hs-type">commitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Published Hydra scripts to reference.</span></span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#CommitBlueprintTx"><span class="hs-identifier hs-type">CommitBlueprintTx</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-comment">-- | The initial output (sent to each party) which should contain the PT and is</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-comment">-- locked by initial script</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-250"></span><span id="commitTx"><span class="annot"><span class="annottext">commitTx :: NetworkId
-&gt; ScriptRegistry
-&gt; HeadId
-&gt; Party
-&gt; CommitBlueprintTx Tx
-&gt; (TxIn, TxOut CtxUTxO, Hash PaymentKey)
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#commitTx"><span class="hs-identifier hs-var hs-var">commitTx</span></a></span></span><span> </span><span id="local-6989586621680310968"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310968"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680310969"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680310969"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621680310970"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680310970"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span id="local-6989586621680310971"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680310971"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621680310972"><span class="annot"><span class="annottext">CommitBlueprintTx Tx
</span><a href="#local-6989586621680310972"><span class="hs-identifier hs-var">commitBlueprintTx</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680310973"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310973"><span class="hs-identifier hs-var">initialInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310974"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680310974"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310975"><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621680310975"><span class="hs-identifier hs-var">vkh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-comment">-- NOTE: We use the cardano-ledger-api functions here such that we can use the</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-comment">-- blueprint transaction as a starting point (cardano-api does not allow</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-comment">-- convenient transaction modifications).</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="annottext">Tx LedgerEra -&gt; Tx
forall era.
IsShelleyBasedEra era =&gt;
Tx (ShelleyLedgerEra era) -&gt; Tx era
</span><span class="hs-identifier hs-var">fromLedgerTx</span></span><span> </span><span class="annot"><span class="annottext">(Tx LedgerEra -&gt; Tx) -&gt; Tx LedgerEra -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">Tx -&gt; Tx LedgerEra
forall era. Tx era -&gt; Tx (ShelleyLedgerEra era)
</span><span class="hs-identifier hs-var">toLedgerTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680310978"><span class="hs-identifier hs-var">blueprintTx</span></a></span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><span class="annottext">Tx StandardBabbage
-&gt; (Tx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Tx StandardBabbage -&gt; AlonzoTx StandardBabbage
</span><a href="#local-6989586621680310979"><span class="hs-identifier hs-var">spendFromInitial</span></a></span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
-&gt; (AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; Tx StandardBabbage -&gt; Identity (Tx StandardBabbage)
(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx StandardBabbage) (TxBody StandardBabbage)
</span><span class="hs-identifier hs-var">bodyTxL</span></span><span> </span><span class="annot"><span class="annottext">((TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; ((StrictSeq (TxOut StandardBabbage)
     -&gt; Identity (StrictSeq (TxOut StandardBabbage)))
    -&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; (StrictSeq (TxOut StandardBabbage)
    -&gt; Identity (StrictSeq (TxOut StandardBabbage)))
-&gt; AlonzoTx StandardBabbage
-&gt; Identity (AlonzoTx StandardBabbage)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut StandardBabbage)
 -&gt; Identity (StrictSeq (TxOut StandardBabbage)))
-&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody StandardBabbage) (StrictSeq (TxOut StandardBabbage))
</span><span class="hs-identifier hs-var">outputsTxBodyL</span></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxOut StandardBabbage)
  -&gt; Identity (StrictSeq (TxOut StandardBabbage)))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; StrictSeq (TxOut StandardBabbage)
-&gt; AlonzoTx StandardBabbage
-&gt; AlonzoTx StandardBabbage
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">TxOut StandardBabbage -&gt; StrictSeq (TxOut StandardBabbage)
forall a. a -&gt; StrictSeq a
</span><span class="hs-identifier hs-var">StrictSeq.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut LedgerEra
</span><span class="hs-identifier hs-var">toLedgerTxOut</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680310982"><span class="hs-identifier hs-var">commitOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>      </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
-&gt; (AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; Tx StandardBabbage -&gt; Identity (Tx StandardBabbage)
(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx StandardBabbage) (TxBody StandardBabbage)
</span><span class="hs-identifier hs-var">bodyTxL</span></span><span> </span><span class="annot"><span class="annottext">((TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; ((Set (KeyHash 'Witness StandardCrypto)
     -&gt; Identity (Set (KeyHash 'Witness StandardCrypto)))
    -&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; (Set (KeyHash 'Witness StandardCrypto)
    -&gt; Identity (Set (KeyHash 'Witness StandardCrypto)))
-&gt; AlonzoTx StandardBabbage
-&gt; Identity (AlonzoTx StandardBabbage)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (KeyHash 'Witness StandardCrypto)
 -&gt; Identity (Set (KeyHash 'Witness StandardCrypto)))
-&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage)
(Set (KeyHash 'Witness (EraCrypto StandardBabbage))
 -&gt; Identity (Set (KeyHash 'Witness (EraCrypto StandardBabbage))))
-&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage)
forall era.
AlonzoEraTxBody era =&gt;
Lens' (TxBody era) (Set (KeyHash 'Witness (EraCrypto era)))
Lens'
  (TxBody StandardBabbage)
  (Set (KeyHash 'Witness (EraCrypto StandardBabbage)))
</span><span class="hs-identifier hs-var">reqSignerHashesTxBodyL</span></span><span> </span><span class="annot"><span class="annottext">((Set (KeyHash 'Witness StandardCrypto)
  -&gt; Identity (Set (KeyHash 'Witness StandardCrypto)))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; Set (KeyHash 'Witness StandardCrypto)
-&gt; AlonzoTx StandardBabbage
-&gt; AlonzoTx StandardBabbage
forall a s t. Semigroup a =&gt; ASetter s t a a -&gt; a -&gt; s -&gt; t
</span><span class="hs-operator hs-var">&lt;&gt;~</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness StandardCrypto
-&gt; Set (KeyHash 'Witness StandardCrypto)
forall a. a -&gt; Set a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; KeyHash 'Witness StandardCrypto
</span><span class="hs-identifier hs-var">toLedgerKeyHash</span></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621680310975"><span class="hs-identifier hs-var">vkh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
-&gt; (AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; Tx StandardBabbage -&gt; Identity (Tx StandardBabbage)
(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx StandardBabbage) (TxBody StandardBabbage)
</span><span class="hs-identifier hs-var">bodyTxL</span></span><span> </span><span class="annot"><span class="annottext">((TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; ((MultiAsset (EraCrypto StandardBabbage)
     -&gt; Identity (MultiAsset (EraCrypto StandardBabbage)))
    -&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; (MultiAsset (EraCrypto StandardBabbage)
    -&gt; Identity (MultiAsset (EraCrypto StandardBabbage)))
-&gt; AlonzoTx StandardBabbage
-&gt; Identity (AlonzoTx StandardBabbage)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(MultiAsset (EraCrypto StandardBabbage)
 -&gt; Identity (MultiAsset (EraCrypto StandardBabbage)))
-&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage)
forall era.
MaryEraTxBody era =&gt;
Lens' (TxBody era) (MultiAsset (EraCrypto era))
Lens'
  (TxBody StandardBabbage) (MultiAsset (EraCrypto StandardBabbage))
</span><span class="hs-identifier hs-var">mintTxBodyL</span></span><span> </span><span class="annot"><span class="annottext">((MultiAsset (EraCrypto StandardBabbage)
  -&gt; Identity (MultiAsset (EraCrypto StandardBabbage)))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; MultiAsset (EraCrypto StandardBabbage)
-&gt; AlonzoTx StandardBabbage
-&gt; AlonzoTx StandardBabbage
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">MultiAsset (EraCrypto StandardBabbage)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
-&gt; (AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadata -&gt; AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage
</span><a href="#local-6989586621680310985"><span class="hs-identifier hs-var">addMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; TxMetadata
</span><a href="Hydra.Chain.Direct.Tx.html#mkHydraHeadV1TxName"><span class="hs-identifier hs-var">mkHydraHeadV1TxName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;CommitTx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>  </span><span id="local-6989586621680310985"><span class="annot"><span class="annottext">addMetadata :: TxMetadata -&gt; AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage
</span><a href="#local-6989586621680310985"><span class="hs-identifier hs-var hs-var">addMetadata</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxMetadata</span></span><span> </span><span id="local-6989586621680310986"><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621680310986"><span class="hs-identifier hs-var">newMetadata</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680310987"><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
</span><a href="#local-6989586621680310987"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-264"></span><span>      </span><span id="local-6989586621680310988"><span class="annot"><span class="annottext">newMetadataMap :: Map Word64 Metadatum
</span><a href="#local-6989586621680310988"><span class="hs-identifier hs-var hs-var">newMetadataMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue -&gt; Map Word64 Metadatum
</span><span class="hs-identifier hs-var">toShelleyMetadata</span></span><span> </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621680310986"><span class="hs-identifier hs-var">newMetadata</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span id="local-6989586621680310990"><span class="annot"><span class="annottext">newAuxData :: AlonzoTxAuxData StandardBabbage
</span><a href="#local-6989586621680310990"><span class="hs-identifier hs-var hs-var">newAuxData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; Tx LedgerEra
forall era. Tx era -&gt; Tx (ShelleyLedgerEra era)
</span><span class="hs-identifier hs-var">toLedgerTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680310978"><span class="hs-identifier hs-var">blueprintTx</span></a></span><span> </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
-&gt; Getting
     (StrictMaybe (AlonzoTxAuxData StandardBabbage))
     (AlonzoTx StandardBabbage)
     (StrictMaybe (AlonzoTxAuxData StandardBabbage))
-&gt; StrictMaybe (AlonzoTxAuxData StandardBabbage)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (StrictMaybe (AlonzoTxAuxData StandardBabbage))
  (AlonzoTx StandardBabbage)
  (StrictMaybe (AlonzoTxAuxData StandardBabbage))
(StrictMaybe (AuxiliaryData StandardBabbage)
 -&gt; Const
      (StrictMaybe (AlonzoTxAuxData StandardBabbage))
      (StrictMaybe (AuxiliaryData StandardBabbage)))
-&gt; Tx StandardBabbage
-&gt; Const
     (StrictMaybe (AlonzoTxAuxData StandardBabbage))
     (Tx StandardBabbage)
forall era.
EraTx era =&gt;
Lens' (Tx era) (StrictMaybe (AuxiliaryData era))
Lens'
  (Tx StandardBabbage) (StrictMaybe (AuxiliaryData StandardBabbage))
</span><span class="hs-identifier hs-var">auxDataTxL</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-267"></span><span>          </span><span class="annot"><span class="annottext">StrictMaybe (AlonzoTxAuxData StandardBabbage)
</span><span class="hs-identifier hs-var">SNothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Word64 Metadatum
-&gt; StrictSeq (Timelock StandardBabbage)
-&gt; Map Language (NonEmpty PlutusBinary)
-&gt; AlonzoTxAuxData StandardBabbage
forall era.
(HasCallStack, AlonzoEraScript era) =&gt;
Map Word64 Metadatum
-&gt; StrictSeq (Timelock era)
-&gt; Map Language (NonEmpty PlutusBinary)
-&gt; AlonzoTxAuxData era
</span><span class="hs-identifier hs-var">AlonzoTxAuxData</span></span><span> </span><span class="annot"><span class="annottext">Map Word64 Metadatum
</span><a href="#local-6989586621680310988"><span class="hs-identifier hs-var">newMetadataMap</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (Timelock StandardBabbage)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Map Language (NonEmpty PlutusBinary)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-268"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">SJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AlonzoTxAuxData</span></span><span> </span><span id="local-6989586621680310994"><span class="annot"><span class="annottext">Map Word64 Metadatum
</span><a href="#local-6989586621680310994"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span id="local-6989586621680310995"><span class="annot"><span class="annottext">StrictSeq (Timelock StandardBabbage)
</span><a href="#local-6989586621680310995"><span class="hs-identifier hs-var">timeLocks</span></a></span></span><span> </span><span id="local-6989586621680310996"><span class="annot"><span class="annottext">Map Language (NonEmpty PlutusBinary)
</span><a href="#local-6989586621680310996"><span class="hs-identifier hs-var">languageMap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-269"></span><span>            </span><span class="annot"><span class="annottext">Map Word64 Metadatum
-&gt; StrictSeq (Timelock StandardBabbage)
-&gt; Map Language (NonEmpty PlutusBinary)
-&gt; AlonzoTxAuxData StandardBabbage
forall era.
(HasCallStack, AlonzoEraScript era) =&gt;
Map Word64 Metadatum
-&gt; StrictSeq (Timelock era)
-&gt; Map Language (NonEmpty PlutusBinary)
-&gt; AlonzoTxAuxData era
</span><span class="hs-identifier hs-var">AlonzoTxAuxData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Word64 Metadatum
-&gt; Map Word64 Metadatum -&gt; Map Word64 Metadatum
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">Map.union</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word64 Metadatum
</span><a href="#local-6989586621680310994"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word64 Metadatum
</span><a href="#local-6989586621680310988"><span class="hs-identifier hs-var">newMetadataMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictSeq (Timelock StandardBabbage)
</span><a href="#local-6989586621680310995"><span class="hs-identifier hs-var">timeLocks</span></a></span><span> </span><span class="annot"><span class="annottext">Map Language (NonEmpty PlutusBinary)
</span><a href="#local-6989586621680310996"><span class="hs-identifier hs-var">languageMap</span></a></span><span>
</span><span id="line-270"></span><span>     </span><span class="hs-keyword">in</span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
</span><a href="#local-6989586621680310987"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
-&gt; (AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (AuxiliaryData StandardBabbage)
 -&gt; Identity (StrictMaybe (AlonzoTxAuxData StandardBabbage)))
-&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage)
(StrictMaybe (AuxiliaryData StandardBabbage)
 -&gt; Identity (StrictMaybe (AuxiliaryData StandardBabbage)))
-&gt; Tx StandardBabbage -&gt; Identity (Tx StandardBabbage)
forall era.
EraTx era =&gt;
Lens' (Tx era) (StrictMaybe (AuxiliaryData era))
Lens'
  (Tx StandardBabbage) (StrictMaybe (AuxiliaryData StandardBabbage))
</span><span class="hs-identifier hs-var">auxDataTxL</span></span><span> </span><span class="annot"><span class="annottext">((StrictMaybe (AuxiliaryData StandardBabbage)
  -&gt; Identity (StrictMaybe (AlonzoTxAuxData StandardBabbage)))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; StrictMaybe (AlonzoTxAuxData StandardBabbage)
-&gt; AlonzoTx StandardBabbage
-&gt; AlonzoTx StandardBabbage
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">AlonzoTxAuxData StandardBabbage
-&gt; StrictMaybe (AlonzoTxAuxData StandardBabbage)
forall a. a -&gt; StrictMaybe a
</span><span class="hs-identifier hs-var">SJust</span></span><span> </span><span class="annot"><span class="annottext">AlonzoTxAuxData StandardBabbage
</span><a href="#local-6989586621680310990"><span class="hs-identifier hs-var">newAuxData</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
-&gt; (AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; Tx StandardBabbage -&gt; Identity (Tx StandardBabbage)
(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx StandardBabbage) (TxBody StandardBabbage)
</span><span class="hs-identifier hs-var">bodyTxL</span></span><span> </span><span class="annot"><span class="annottext">((TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; ((StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))
     -&gt; Identity
          (StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))))
    -&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; (StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))
    -&gt; Identity
         (StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))))
-&gt; AlonzoTx StandardBabbage
-&gt; Identity (AlonzoTx StandardBabbage)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))
 -&gt; Identity
      (StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))))
-&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage)
forall era.
EraTxBody era =&gt;
Lens'
  (TxBody era) (StrictMaybe (AuxiliaryDataHash (EraCrypto era)))
Lens'
  (TxBody StandardBabbage)
  (StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage)))
</span><span class="hs-identifier hs-var">auxDataHashTxBodyL</span></span><span> </span><span class="annot"><span class="annottext">((StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))
  -&gt; Identity
       (StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))
-&gt; AlonzoTx StandardBabbage
-&gt; AlonzoTx StandardBabbage
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">AuxiliaryDataHash (EraCrypto StandardBabbage)
-&gt; StrictMaybe (AuxiliaryDataHash (EraCrypto StandardBabbage))
forall a. a -&gt; StrictMaybe a
</span><span class="hs-identifier hs-var">SJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AuxiliaryData StandardBabbage
-&gt; AuxiliaryDataHash (EraCrypto StandardBabbage)
forall era.
EraTxAuxData era =&gt;
TxAuxData era -&gt; AuxiliaryDataHash (EraCrypto era)
</span><span class="hs-identifier hs-var">hashTxAuxData</span></span><span> </span><span class="annot"><span class="annottext">AlonzoTxAuxData StandardBabbage
AuxiliaryData StandardBabbage
</span><a href="#local-6989586621680310990"><span class="hs-identifier hs-var">newAuxData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621680310979"><span class="annot"><span class="annottext">spendFromInitial :: Tx StandardBabbage -&gt; AlonzoTx StandardBabbage
</span><a href="#local-6989586621680310979"><span class="hs-identifier hs-var hs-var">spendFromInitial</span></a></span></span><span> </span><span id="local-6989586621680310998"><span class="annot"><span class="annottext">Tx StandardBabbage
</span><a href="#local-6989586621680310998"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680310999"><span class="annot"><span class="annottext">newRedeemers :: Map (TxIn StandardCrypto) (Data StandardBabbage)
</span><a href="#local-6989586621680310999"><span class="hs-identifier hs-var hs-var">newRedeemers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>          </span><span class="annot"><span class="annottext">Tx StandardBabbage
-&gt; Map (TxIn (EraCrypto StandardBabbage)) (Data StandardBabbage)
forall {era} {era}.
(PlutusPurpose AsItem era ~ AlonzoPlutusPurpose AsItem era,
 Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 AlonzoEraTxBody era, EraTx era, AlonzoEraTxWits era, Era era,
 NFData (TxCert era), EncCBOR (TxCert era), DecCBOR (TxCert era),
 Show (TxCert era), Eq (TxCert era), NoThunks (TxCert era)) =&gt;
Tx era -&gt; Map (TxIn (EraCrypto era)) (Data era)
</span><a href="#local-6989586621680311000"><span class="hs-identifier hs-var">resolveSpendingRedeemers</span></a></span><span> </span><span class="annot"><span class="annottext">Tx StandardBabbage
</span><a href="#local-6989586621680310998"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-278"></span><span>            </span><span class="annot"><span class="annottext">Map (TxIn StandardCrypto) (Data StandardBabbage)
-&gt; (Map (TxIn StandardCrypto) (Data StandardBabbage)
    -&gt; Map (TxIn StandardCrypto) (Data StandardBabbage))
-&gt; Map (TxIn StandardCrypto) (Data StandardBabbage)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn StandardCrypto
-&gt; Data StandardBabbage
-&gt; Map (TxIn StandardCrypto) (Data StandardBabbage)
-&gt; Map (TxIn StandardCrypto) (Data StandardBabbage)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; TxIn StandardCrypto
</span><span class="hs-identifier hs-var">toLedgerTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310973"><span class="hs-identifier hs-var">initialInput</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall era. Era era =&gt; HashableScriptData -&gt; Data era
</span><span class="hs-identifier hs-var">toLedgerData</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">LedgerEra</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680311004"><span class="hs-identifier hs-var">initialRedeemer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>        </span><span id="local-6989586621680311005"><span class="annot"><span class="annottext">newInputs :: Set (TxIn StandardCrypto)
</span><a href="#local-6989586621680311005"><span class="hs-identifier hs-var hs-var">newInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx StandardBabbage
</span><a href="#local-6989586621680310998"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx StandardBabbage
-&gt; Getting
     (Set (TxIn StandardCrypto))
     (Tx StandardBabbage)
     (Set (TxIn StandardCrypto))
-&gt; Set (TxIn StandardCrypto)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">(TxBody StandardBabbage
 -&gt; Const (Set (TxIn StandardCrypto)) (TxBody StandardBabbage))
-&gt; Tx StandardBabbage
-&gt; Const (Set (TxIn StandardCrypto)) (Tx StandardBabbage)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx StandardBabbage) (TxBody StandardBabbage)
</span><span class="hs-identifier hs-var">bodyTxL</span></span><span> </span><span class="annot"><span class="annottext">((TxBody StandardBabbage
  -&gt; Const (Set (TxIn StandardCrypto)) (TxBody StandardBabbage))
 -&gt; Tx StandardBabbage
 -&gt; Const (Set (TxIn StandardCrypto)) (Tx StandardBabbage))
-&gt; ((Set (TxIn StandardCrypto)
     -&gt; Const (Set (TxIn StandardCrypto)) (Set (TxIn StandardCrypto)))
    -&gt; TxBody StandardBabbage
    -&gt; Const (Set (TxIn StandardCrypto)) (TxBody StandardBabbage))
-&gt; Getting
     (Set (TxIn StandardCrypto))
     (Tx StandardBabbage)
     (Set (TxIn StandardCrypto))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (TxIn StandardCrypto)
 -&gt; Const (Set (TxIn StandardCrypto)) (Set (TxIn StandardCrypto)))
-&gt; TxBody StandardBabbage
-&gt; Const (Set (TxIn StandardCrypto)) (TxBody StandardBabbage)
(Set (TxIn (EraCrypto StandardBabbage))
 -&gt; Const
      (Set (TxIn StandardCrypto))
      (Set (TxIn (EraCrypto StandardBabbage))))
-&gt; TxBody StandardBabbage
-&gt; Const (Set (TxIn StandardCrypto)) (TxBody StandardBabbage)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (Set (TxIn (EraCrypto era)))
Lens'
  (TxBody StandardBabbage) (Set (TxIn (EraCrypto StandardBabbage)))
</span><span class="hs-identifier hs-var">inputsTxBodyL</span></span><span> </span><span class="annot"><span class="annottext">Set (TxIn StandardCrypto)
-&gt; Set (TxIn StandardCrypto) -&gt; Set (TxIn StandardCrypto)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn StandardCrypto -&gt; Set (TxIn StandardCrypto)
forall a. a -&gt; Set a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; TxIn StandardCrypto
</span><span class="hs-identifier hs-var">toLedgerTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680310973"><span class="hs-identifier hs-var">initialInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Tx StandardBabbage
</span><a href="#local-6989586621680310998"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-281"></span><span>          </span><span class="annot"><span class="annottext">Tx StandardBabbage
-&gt; (Tx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; Tx StandardBabbage -&gt; Identity (Tx StandardBabbage)
(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; Tx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx StandardBabbage) (TxBody StandardBabbage)
</span><span class="hs-identifier hs-var">bodyTxL</span></span><span> </span><span class="annot"><span class="annottext">((TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
 -&gt; Tx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; ((Set (TxIn (EraCrypto StandardBabbage))
     -&gt; Identity (Set (TxIn StandardCrypto)))
    -&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; (Set (TxIn (EraCrypto StandardBabbage))
    -&gt; Identity (Set (TxIn StandardCrypto)))
-&gt; Tx StandardBabbage
-&gt; Identity (AlonzoTx StandardBabbage)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (TxIn (EraCrypto StandardBabbage))
 -&gt; Identity (Set (TxIn StandardCrypto)))
-&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage)
(Set (TxIn (EraCrypto StandardBabbage))
 -&gt; Identity (Set (TxIn (EraCrypto StandardBabbage))))
-&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (Set (TxIn (EraCrypto era)))
Lens'
  (TxBody StandardBabbage) (Set (TxIn (EraCrypto StandardBabbage)))
</span><span class="hs-identifier hs-var">inputsTxBodyL</span></span><span> </span><span class="annot"><span class="annottext">((Set (TxIn (EraCrypto StandardBabbage))
  -&gt; Identity (Set (TxIn StandardCrypto)))
 -&gt; Tx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; Set (TxIn StandardCrypto)
-&gt; Tx StandardBabbage
-&gt; AlonzoTx StandardBabbage
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Set (TxIn StandardCrypto)
</span><a href="#local-6989586621680311005"><span class="hs-identifier hs-var">newInputs</span></a></span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
-&gt; (AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; Tx StandardBabbage -&gt; Identity (Tx StandardBabbage)
(TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx StandardBabbage) (TxBody StandardBabbage)
</span><span class="hs-identifier hs-var">bodyTxL</span></span><span> </span><span class="annot"><span class="annottext">((TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; ((Set (TxIn StandardCrypto)
     -&gt; Identity (Set (TxIn StandardCrypto)))
    -&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage))
-&gt; (Set (TxIn StandardCrypto)
    -&gt; Identity (Set (TxIn StandardCrypto)))
-&gt; AlonzoTx StandardBabbage
-&gt; Identity (AlonzoTx StandardBabbage)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (TxIn StandardCrypto) -&gt; Identity (Set (TxIn StandardCrypto)))
-&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage)
(Set (TxIn (EraCrypto StandardBabbage))
 -&gt; Identity (Set (TxIn (EraCrypto StandardBabbage))))
-&gt; TxBody StandardBabbage -&gt; Identity (TxBody StandardBabbage)
forall era.
BabbageEraTxBody era =&gt;
Lens' (TxBody era) (Set (TxIn (EraCrypto era)))
Lens'
  (TxBody StandardBabbage) (Set (TxIn (EraCrypto StandardBabbage)))
</span><span class="hs-identifier hs-var">referenceInputsTxBodyL</span></span><span> </span><span class="annot"><span class="annottext">((Set (TxIn StandardCrypto)
  -&gt; Identity (Set (TxIn StandardCrypto)))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; Set (TxIn StandardCrypto)
-&gt; AlonzoTx StandardBabbage
-&gt; AlonzoTx StandardBabbage
forall a s t. Semigroup a =&gt; ASetter s t a a -&gt; a -&gt; s -&gt; t
</span><span class="hs-operator hs-var">&lt;&gt;~</span></span><span> </span><span class="annot"><span class="annottext">TxIn StandardCrypto -&gt; Set (TxIn StandardCrypto)
forall a. a -&gt; Set a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; TxIn StandardCrypto
</span><span class="hs-identifier hs-var">toLedgerTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680311006"><span class="hs-identifier hs-var">initialScriptRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>          </span><span class="annot"><span class="annottext">AlonzoTx StandardBabbage
-&gt; (AlonzoTx StandardBabbage -&gt; AlonzoTx StandardBabbage)
-&gt; AlonzoTx StandardBabbage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxWits StandardBabbage -&gt; Identity (TxWits StandardBabbage))
-&gt; Tx StandardBabbage -&gt; Identity (Tx StandardBabbage)
(TxWits StandardBabbage -&gt; Identity (TxWits StandardBabbage))
-&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage)
forall era. EraTx era =&gt; Lens' (Tx era) (TxWits era)
Lens' (Tx StandardBabbage) (TxWits StandardBabbage)
</span><span class="hs-identifier hs-var">witsTxL</span></span><span> </span><span class="annot"><span class="annottext">((TxWits StandardBabbage -&gt; Identity (TxWits StandardBabbage))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; ((Redeemers StandardBabbage
     -&gt; Identity (Redeemers StandardBabbage))
    -&gt; TxWits StandardBabbage -&gt; Identity (TxWits StandardBabbage))
-&gt; (Redeemers StandardBabbage
    -&gt; Identity (Redeemers StandardBabbage))
-&gt; AlonzoTx StandardBabbage
-&gt; Identity (AlonzoTx StandardBabbage)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Redeemers StandardBabbage -&gt; Identity (Redeemers StandardBabbage))
-&gt; TxWits StandardBabbage -&gt; Identity (TxWits StandardBabbage)
forall era.
AlonzoEraTxWits era =&gt;
Lens' (TxWits era) (Redeemers era)
Lens' (TxWits StandardBabbage) (Redeemers StandardBabbage)
</span><span class="hs-identifier hs-var">rdmrsTxWitsL</span></span><span> </span><span class="annot"><span class="annottext">((Redeemers StandardBabbage
  -&gt; Identity (Redeemers StandardBabbage))
 -&gt; AlonzoTx StandardBabbage -&gt; Identity (AlonzoTx StandardBabbage))
-&gt; Redeemers StandardBabbage
-&gt; AlonzoTx StandardBabbage
-&gt; AlonzoTx StandardBabbage
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Map (TxIn StandardCrypto) (Data StandardBabbage)
-&gt; Set (TxIn StandardCrypto) -&gt; Redeemers StandardBabbage
forall {era} {era} {k}.
(PlutusPurpose AsIndex era ~ AlonzoPlutusPurpose AsIndex era,
 Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 AlonzoEraScript era, Ord k, Era era, NFData (TxCert era)) =&gt;
Map k (Data era) -&gt; Set k -&gt; Redeemers era
</span><a href="#local-6989586621680311007"><span class="hs-identifier hs-var">mkRedeemers</span></a></span><span> </span><span class="annot"><span class="annottext">Map (TxIn StandardCrypto) (Data StandardBabbage)
</span><a href="#local-6989586621680310999"><span class="hs-identifier hs-var">newRedeemers</span></a></span><span> </span><span class="annot"><span class="annottext">Set (TxIn StandardCrypto)
</span><a href="#local-6989586621680311005"><span class="hs-identifier hs-var">newInputs</span></a></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-comment">-- Make redeemers (with zeroed units) from a TxIn -&gt; Data map and a set of transaction inputs</span><span>
</span><span id="line-286"></span><span>  </span><span id="local-6989586621680311007"><span class="annot"><span class="annottext">mkRedeemers :: Map k (Data era) -&gt; Set k -&gt; Redeemers era
</span><a href="#local-6989586621680311007"><span class="hs-identifier hs-var hs-var">mkRedeemers</span></a></span></span><span> </span><span id="local-6989586621680311452"><span class="annot"><span class="annottext">Map k (Data era)
</span><a href="#local-6989586621680311452"><span class="hs-identifier hs-var">resolved</span></a></span></span><span> </span><span id="local-6989586621680311453"><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621680311453"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><span class="annottext">Map (PlutusPurpose AsIndex era) (Data era, ExUnits)
-&gt; Redeemers era
Map (AlonzoPlutusPurpose AsIndex era) (Data era, ExUnits)
-&gt; Redeemers era
forall era.
AlonzoEraScript era =&gt;
Map (PlutusPurpose AsIndex era) (Data era, ExUnits)
-&gt; Redeemers era
</span><span class="hs-identifier hs-var">Redeemers</span></span><span> </span><span class="annot"><span class="annottext">(Map (AlonzoPlutusPurpose AsIndex era) (Data era, ExUnits)
 -&gt; Redeemers era)
-&gt; ([(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
    -&gt; Map (AlonzoPlutusPurpose AsIndex era) (Data era, ExUnits))
-&gt; [(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
-&gt; Redeemers era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
-&gt; Map (AlonzoPlutusPurpose AsIndex era) (Data era, ExUnits)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
 -&gt; Redeemers era)
-&gt; [(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
-&gt; Redeemers era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><span class="annottext">([(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
 -&gt; k -&gt; [(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))])
-&gt; [(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
-&gt; Set k
-&gt; [(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; Set a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680311456"><span class="annot"><span class="annottext">[(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
</span><a href="#local-6989586621680311456"><span class="hs-identifier hs-var">newRedeemerData</span></a></span></span><span> </span><span id="local-6989586621680311457"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680311457"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-290"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680311458"><span class="annot"><span class="annottext">ix :: Word32
</span><a href="#local-6989586621680311458"><span class="hs-identifier hs-var hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word32) -&gt; Int -&gt; Word32
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">k -&gt; Set k -&gt; Int
forall a. Ord a =&gt; a -&gt; Set a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#findIndex"><span class="hs-identifier hs-var">Set.findIndex</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680311457"><span class="hs-identifier hs-var">txin</span></a></span><span> </span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621680311453"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-291"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k (Data era) -&gt; Maybe (Data era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680311457"><span class="hs-identifier hs-var">txin</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Data era)
</span><a href="#local-6989586621680311452"><span class="hs-identifier hs-var">resolved</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-292"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (Data era)
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
</span><a href="#local-6989586621680311456"><span class="hs-identifier hs-var">newRedeemerData</span></a></span><span>
</span><span id="line-293"></span><span>                  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680311460"><span class="annot"><span class="annottext">Data era
</span><a href="#local-6989586621680311460"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AsIndex Word32 (TxIn (EraCrypto era))
-&gt; AlonzoPlutusPurpose AsIndex era
forall (f :: * -&gt; * -&gt; *) era.
f Word32 (TxIn (EraCrypto era)) -&gt; AlonzoPlutusPurpose f era
</span><span class="hs-identifier hs-var">AlonzoSpending</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AsIndex Word32 (TxIn (EraCrypto era))
forall ix it. ix -&gt; AsIndex ix it
</span><span class="hs-identifier hs-var">AsIndex</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621680311458"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Data era
</span><a href="#local-6989586621680311460"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; ExUnits
</span><span class="hs-identifier hs-var">ExUnits</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))
-&gt; [(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
-&gt; [(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(AlonzoPlutusPurpose AsIndex era, (Data era, ExUnits))]
</span><a href="#local-6989586621680311456"><span class="hs-identifier hs-var">newRedeemerData</span></a></span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621680311453"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-comment">-- Create a TxIn -&gt; Data map of all spending redeemers</span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621680311000"><span class="annot"><span class="annottext">resolveSpendingRedeemers :: Tx era -&gt; Map (TxIn (EraCrypto era)) (Data era)
</span><a href="#local-6989586621680311000"><span class="hs-identifier hs-var hs-var">resolveSpendingRedeemers</span></a></span></span><span> </span><span id="local-6989586621680313387"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621680313387"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><span class="annottext">(PlutusPurpose AsIndex era
 -&gt; (Data era, ExUnits) -&gt; Map (TxIn (EraCrypto era)) (Data era))
-&gt; Map (PlutusPurpose AsIndex era) (Data era, ExUnits)
-&gt; Map (TxIn (EraCrypto era)) (Data era)
forall m k a. Monoid m =&gt; (k -&gt; a -&gt; m) -&gt; Map k a -&gt; m
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#foldMapWithKey"><span class="hs-identifier hs-var">Map.foldMapWithKey</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680313389"><span class="annot"><span class="annottext">PlutusPurpose AsIndex era
</span><a href="#local-6989586621680313389"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313390"><span class="annot"><span class="annottext">Data era
</span><a href="#local-6989586621680313390"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313391"><span class="annot"><span class="annottext">ExUnits
</span><a href="#local-6989586621680313391"><span class="hs-identifier hs-var">_ex</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-303"></span><span>          </span><span class="hs-comment">-- XXX: Should soon be available through cardano-ledger-api again</span><span>
</span><span id="line-304"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxBody era
-&gt; PlutusPurpose AsIndex era
-&gt; StrictMaybe (PlutusPurpose AsItem era)
forall era.
AlonzoEraTxBody era =&gt;
TxBody era
-&gt; PlutusPurpose AsIndex era
-&gt; StrictMaybe (PlutusPurpose AsItem era)
</span><span class="hs-identifier hs-var">redeemerPointerInverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621680313387"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting (TxBody era) (Tx era) (TxBody era) -&gt; TxBody era
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (TxBody era) (Tx era) (TxBody era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><span class="hs-identifier hs-var">bodyTxL</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusPurpose AsIndex era
</span><a href="#local-6989586621680313389"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-305"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">SJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AlonzoSpending</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AsItem</span></span><span> </span><span id="local-6989586621680313393"><span class="annot"><span class="annottext">TxIn (EraCrypto era)
</span><a href="#local-6989586621680313393"><span class="hs-identifier hs-var">txIn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIn (EraCrypto era)
-&gt; Data era -&gt; Map (TxIn (EraCrypto era)) (Data era)
forall k a. k -&gt; a -&gt; Map k a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (EraCrypto era)
</span><a href="#local-6989586621680313393"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="annot"><span class="annottext">Data era
</span><a href="#local-6989586621680313390"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-306"></span><span>            </span><span class="annot"><span class="annottext">StrictMaybe (PlutusPurpose AsItem era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (TxIn (EraCrypto era)) (Data era)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-307"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Redeemers era
-&gt; Map (PlutusPurpose AsIndex era) (Data era, ExUnits)
forall era.
Redeemers era
-&gt; Map (PlutusPurpose AsIndex era) (Data era, ExUnits)
</span><span class="hs-identifier hs-var">unRedeemers</span></span><span> </span><span class="annot"><span class="annottext">(Redeemers era
 -&gt; Map (PlutusPurpose AsIndex era) (Data era, ExUnits))
-&gt; Redeemers era
-&gt; Map (PlutusPurpose AsIndex era) (Data era, ExUnits)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621680313387"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Getting (Redeemers era) (Tx era) (Redeemers era)
-&gt; Redeemers era
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">(TxWits era -&gt; Const (Redeemers era) (TxWits era))
-&gt; Tx era -&gt; Const (Redeemers era) (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxWits era)
Lens' (Tx era) (TxWits era)
</span><span class="hs-identifier hs-var">witsTxL</span></span><span> </span><span class="annot"><span class="annottext">((TxWits era -&gt; Const (Redeemers era) (TxWits era))
 -&gt; Tx era -&gt; Const (Redeemers era) (Tx era))
-&gt; ((Redeemers era -&gt; Const (Redeemers era) (Redeemers era))
    -&gt; TxWits era -&gt; Const (Redeemers era) (TxWits era))
-&gt; Getting (Redeemers era) (Tx era) (Redeemers era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Redeemers era -&gt; Const (Redeemers era) (Redeemers era))
-&gt; TxWits era -&gt; Const (Redeemers era) (TxWits era)
forall era.
AlonzoEraTxWits era =&gt;
Lens' (TxWits era) (Redeemers era)
Lens' (TxWits era) (Redeemers era)
</span><span class="hs-identifier hs-var">rdmrsTxWitsL</span></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>  </span><span id="local-6989586621680311006"><span class="annot"><span class="annottext">initialScriptRef :: TxIn
</span><a href="#local-6989586621680311006"><span class="hs-identifier hs-var hs-var">initialScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-311"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#%24sel%3AinitialReference%3AScriptRegistry"><span class="hs-identifier hs-var">initialReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680310969"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>  </span><span id="local-6989586621680311004"><span class="annot"><span class="annottext">initialRedeemer :: HashableScriptData
</span><a href="#local-6989586621680311004"><span class="hs-identifier hs-var hs-var">initialRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><span class="annottext">Redeemer -&gt; HashableScriptData
forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">(Redeemer -&gt; HashableScriptData)
-&gt; (InitialRedeemer -&gt; Redeemer)
-&gt; InitialRedeemer
-&gt; HashableScriptData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InitialRedeemer -&gt; Redeemer
</span><span class="hs-identifier hs-var">Initial.redeemer</span></span><span> </span><span class="annot"><span class="annottext">(InitialRedeemer -&gt; HashableScriptData)
-&gt; InitialRedeemer -&gt; HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-315"></span><span>      </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; InitialRedeemer
</span><span class="hs-identifier hs-var">Initial.ViaCommit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; TxOutRef
</span><span class="hs-identifier hs-var">toPlutusTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; TxOutRef) -&gt; [TxIn] -&gt; [TxOutRef]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621680313400"><span class="hs-identifier hs-var">committedTxIns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>  </span><span id="local-6989586621680313400"><span class="annot"><span class="annottext">committedTxIns :: [TxIn]
</span><a href="#local-6989586621680313400"><span class="hs-identifier hs-var hs-var">committedTxIns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; [TxIn]
forall era. Tx era -&gt; [TxIn]
</span><span class="hs-identifier hs-var">txIns'</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680310978"><span class="hs-identifier hs-var">blueprintTx</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621680310982"><span class="annot"><span class="annottext">commitOutput :: TxOut CtxUTxO
</span><a href="#local-6989586621680310982"><span class="hs-identifier hs-var hs-var">commitOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value -&gt; TxOutDatum CtxUTxO -&gt; ReferenceScript -&gt; TxOut CtxUTxO
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621680313402"><span class="hs-identifier hs-var">commitAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680313403"><span class="hs-identifier hs-var">commitValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxUTxO
</span><a href="#local-6989586621680313404"><span class="hs-identifier hs-var">commitDatum</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>  </span><span id="local-6989586621680313405"><span class="annot"><span class="annottext">commitScript :: PlutusScript lang
</span><a href="#local-6989586621680313405"><span class="hs-identifier hs-var hs-var">commitScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Commit.validatorScript</span></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>  </span><span id="local-6989586621680313402"><span class="annot"><span class="annottext">commitAddress :: AddressInEra
</span><a href="#local-6989586621680313402"><span class="hs-identifier hs-var hs-var">commitAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><span class="annottext">forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680310968"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680313405"><span class="hs-identifier hs-var">commitScript</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>  </span><span id="local-6989586621680313407"><span class="annot"><span class="annottext">utxoToCommit :: UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313407"><span class="hs-identifier hs-var hs-var">utxoToCommit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)] -&gt; UTxO' (TxOut CtxUTxO)
forall out. [(TxIn, out)] -&gt; UTxO' out
</span><span class="hs-identifier hs-var">UTxO.fromPairs</span></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO)] -&gt; UTxO' (TxOut CtxUTxO))
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; UTxO' (TxOut CtxUTxO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; Maybe (TxIn, TxOut CtxUTxO))
-&gt; [TxIn] -&gt; [(TxIn, TxOut CtxUTxO)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680313410"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313410"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313410"><span class="hs-identifier hs-var">txin</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; (TxIn, TxOut CtxUTxO))
-&gt; Maybe (TxOut CtxUTxO) -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; UTxO' (TxOut CtxUTxO) -&gt; Maybe (TxOut CtxUTxO)
forall out. TxIn -&gt; UTxO' out -&gt; Maybe out
</span><span class="hs-identifier hs-var">UTxO.resolve</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313410"><span class="hs-identifier hs-var">txin</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
UTxOType Tx
</span><a href="#local-6989586621680313412"><span class="hs-identifier hs-var">lookupUTxO</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621680313400"><span class="hs-identifier hs-var">committedTxIns</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span>  </span><span id="local-6989586621680313403"><span class="annot"><span class="annottext">commitValue :: Value
</span><a href="#local-6989586621680313403"><span class="hs-identifier hs-var hs-var">commitValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680310974"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Value) -&gt; UTxO' (TxOut CtxUTxO) -&gt; Value
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; UTxO' a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#foldMap"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313407"><span class="hs-identifier hs-var">utxoToCommit</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>  </span><span id="local-6989586621680313404"><span class="annot"><span class="annottext">commitDatum :: TxOutDatum CtxUTxO
</span><a href="#local-6989586621680313404"><span class="hs-identifier hs-var hs-var">commitDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><span class="annottext">Datum -&gt; TxOutDatum CtxUTxO
forall era a ctx.
(ToScriptData a, IsBabbageEraOnwards era) =&gt;
a -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">mkTxOutDatumInline</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; TxOutDatum CtxUTxO) -&gt; Datum -&gt; TxOutDatum CtxUTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; UTxO' (TxOut CtxUTxO) -&gt; CurrencySymbol -&gt; Datum
</span><a href="Hydra.Chain.Direct.Tx.html#mkCommitDatum"><span class="hs-identifier hs-var">mkCommitDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680310971"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313407"><span class="hs-identifier hs-var">utxoToCommit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680310970"><span class="hs-identifier hs-var">headId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#CommitBlueprintTx"><span class="hs-identifier hs-type">CommitBlueprintTx</span></a></span><span class="hs-special">{</span><span id="local-6989586621680313412"><span class="annot"><span class="annottext">UTxOType Tx
lookupUTxO :: UTxOType Tx
$sel:lookupUTxO:CommitBlueprintTx :: forall tx. CommitBlueprintTx tx -&gt; UTxOType tx
</span><a href="#local-6989586621680313412"><span class="hs-identifier hs-var hs-var">lookupUTxO</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680310978"><span class="annot"><span class="annottext">Tx
blueprintTx :: Tx
$sel:blueprintTx:CommitBlueprintTx :: forall tx. CommitBlueprintTx tx -&gt; tx
</span><a href="#local-6989586621680310978"><span class="hs-identifier hs-var hs-var">blueprintTx</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommitBlueprintTx Tx
</span><a href="#local-6989586621680310972"><span class="hs-identifier hs-var">commitBlueprintTx</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkCommitDatum"><span class="hs-identifier hs-type">mkCommitDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CurrencySymbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Plutus.Datum</span></span><span>
</span><span id="line-340"></span><span id="mkCommitDatum"><span class="annot"><span class="annottext">mkCommitDatum :: Party -&gt; UTxO' (TxOut CtxUTxO) -&gt; CurrencySymbol -&gt; Datum
</span><a href="Hydra.Chain.Direct.Tx.html#mkCommitDatum"><span class="hs-identifier hs-var hs-var">mkCommitDatum</span></a></span></span><span> </span><span id="local-6989586621680313421"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680313421"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621680313422"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313422"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680313423"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680313423"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="annottext">DatumType -&gt; Datum
</span><span class="hs-identifier hs-var">Commit.datum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party -&gt; Party
</span><a href="Hydra.Party.html#partyToChain"><span class="hs-identifier hs-var">partyToChain</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680313421"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621680313425"><span class="hs-identifier hs-var">commits</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680313423"><span class="hs-identifier hs-var">headId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-343"></span><span>  </span><span id="local-6989586621680313425"><span class="annot"><span class="annottext">commits :: [Commit]
</span><a href="#local-6989586621680313425"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO) -&gt; Maybe Commit)
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; [Commit]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; Maybe Commit
</span><span class="hs-identifier hs-var">Commit.serializeCommit</span></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO)] -&gt; [Commit])
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; [Commit]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; [(TxIn, TxOut CtxUTxO)]
forall out. UTxO' out -&gt; [(TxIn, out)]
</span><span class="hs-identifier hs-var">UTxO.pairs</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313422"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="hs-comment">-- | Create a transaction collecting all &quot;committed&quot; utxo and opening a Head,</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- i.e. driving the Head script state.</span><span>
</span><span id="line-348"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#collectComTx"><span class="hs-identifier hs-type">collectComTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-349"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-350"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Published Hydra scripts to reference.</span></span><span>
</span><span id="line-351"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-352"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Party who's authorizing this transaction</span></span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Head identifier</span></span><span>
</span><span id="line-355"></span><span>  </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Parameters of the head to collect .</span></span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier hs-type">HeadParameters</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span></span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-comment">-- | Data needed to spend the commit output produced by each party.</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-comment">-- Should contain the PT and is locked by @&#957;_commit@ script.</span><span>
</span><span id="line-362"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-comment">-- | UTxO to be used to collect.</span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-comment">-- Should match whatever is recorded in the commit inputs.</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-367"></span><span id="collectComTx"><span class="annot"><span class="annottext">collectComTx :: NetworkId
-&gt; ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; HeadId
-&gt; HeadParameters
-&gt; (TxIn, TxOut CtxUTxO)
-&gt; Map TxIn (TxOut CtxUTxO)
-&gt; UTxO' (TxOut CtxUTxO)
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#collectComTx"><span class="hs-identifier hs-var hs-var">collectComTx</span></a></span></span><span> </span><span id="local-6989586621680313429"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680313429"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680313430"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313430"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621680313431"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680313431"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span id="local-6989586621680313432"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680313432"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span id="local-6989586621680313433"><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621680313433"><span class="hs-identifier hs-var">headParameters</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313434"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313434"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313435"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313435"><span class="hs-identifier hs-var">initialHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680313436"><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313436"><span class="hs-identifier hs-var">commits</span></a></span></span><span> </span><span id="local-6989586621680313437"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313437"><span class="hs-identifier hs-var">utxoToCollect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-370"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
-&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313434"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313438"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
-&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))
</span><a href="#local-6989586621680313439"><span class="hs-identifier hs-var">mkCommit</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era)))
-&gt; [TxIn] -&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO) -&gt; [TxIn]
forall k a. Map k a -&gt; [k]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313436"><span class="hs-identifier hs-var">commits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313441"><span class="hs-identifier hs-var">commitScriptRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313442"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680313443"><span class="hs-identifier hs-var">headOutput</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-373"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier hs-var">addExtraRequiredSigners</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680313431"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
forall era build.
TxMetadataInEra era
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><span class="hs-identifier hs-var">setTxMetadata</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxMetadata -&gt; TxMetadataInEra
</span><span class="hs-identifier hs-var">TxMetadataInEra</span></span><span> </span><span class="annot"><span class="annottext">(TxMetadata -&gt; TxMetadataInEra) -&gt; TxMetadata -&gt; TxMetadataInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TxMetadata
</span><a href="Hydra.Chain.Direct.Tx.html#mkHydraHeadV1TxName"><span class="hs-identifier hs-var">mkHydraHeadV1TxName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;CollectComTx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier hs-type">HeadParameters</span></a></span><span class="hs-special">{</span><span id="local-6989586621680313445"><span class="annot"><span class="annottext">[Party]
$sel:parties:HeadParameters :: HeadParameters -&gt; [Party]
parties :: [Party]
</span><a href="Hydra.Chain.html#%24sel%3Aparties%3AHeadParameters"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313446"><span class="annot"><span class="annottext">ContestationPeriod
$sel:contestationPeriod:HeadParameters :: HeadParameters -&gt; ContestationPeriod
contestationPeriod :: ContestationPeriod
</span><a href="Hydra.Chain.html#%24sel%3AcontestationPeriod%3AHeadParameters"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621680313433"><span class="hs-identifier hs-var">headParameters</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>  </span><span id="local-6989586621680313438"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313438"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn Era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-381"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguageInEra lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; HashableScriptData
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313442"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313451"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">InlineScriptDatum</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680313453"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621680313451"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621680313451"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621680313442"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621680313442"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#%24sel%3AheadReference%3AScriptRegistry"><span class="hs-identifier hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313430"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>  </span><span id="local-6989586621680313453"><span class="annot"><span class="annottext">headRedeemer :: HashableScriptData
</span><a href="#local-6989586621680313453"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input -&gt; HashableScriptData
forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.CollectCom</span></span><span>
</span><span id="line-385"></span><span>  </span><span id="local-6989586621680313443"><span class="annot"><span class="annottext">headOutput :: TxOut CtxTx
</span><a href="#local-6989586621680313443"><span class="hs-identifier hs-var hs-var">headOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-386"></span><span>    </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value -&gt; TxOutDatum CtxTx -&gt; ReferenceScript -&gt; TxOut CtxTx
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span>
</span><span id="line-387"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680313429"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313451"><span class="hs-identifier hs-var">headScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313435"><span class="hs-identifier hs-var">initialHeadOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680313457"><span class="hs-identifier hs-var">commitValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>      </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680313458"><span class="hs-identifier hs-var">headDatumAfter</span></a></span><span>
</span><span id="line-390"></span><span>      </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-391"></span><span>  </span><span id="local-6989586621680313458"><span class="annot"><span class="annottext">headDatumAfter :: TxOutDatum CtxTx
</span><a href="#local-6989586621680313458"><span class="hs-identifier hs-var hs-var">headDatumAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><span class="annottext">State -&gt; TxOutDatum CtxTx
forall era a ctx.
(ToScriptData a, IsBabbageEraOnwards era) =&gt;
a -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">mkTxOutDatumInline</span></span><span>
</span><span id="line-393"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:parties:Initial :: [Party]
</span><span class="hs-identifier hs-var">Head.parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party -&gt; Party
</span><a href="Hydra.Party.html#partyToChain"><span class="hs-identifier hs-var">partyToChain</span></a></span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Party) -&gt; [Party] -&gt; [Party]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680313445"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
utxoHash :: BuiltinByteString
$sel:utxoHash:Initial :: BuiltinByteString
</span><a href="#local-6989586621680313460"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:Initial :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><a href="Hydra.ContestationPeriod.html#toChain"><span class="hs-identifier hs-var">toChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680313446"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Initial :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680313432"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span>  </span><span id="local-6989586621680313460"><span class="annot"><span class="annottext">utxoHash :: BuiltinByteString
</span><a href="#local-6989586621680313460"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BuiltinByteString
forall a arep. ToBuiltin a arep =&gt; a -&gt; arep
</span><span class="hs-identifier hs-var">toBuiltin</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; BuiltinByteString)
-&gt; ByteString -&gt; BuiltinByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tx. IsTx tx =&gt; UTxOType tx -&gt; ByteString
</span><a href="Hydra.Ledger.html#hashUTxO"><span class="hs-identifier hs-var">hashUTxO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
UTxOType Tx
</span><a href="#local-6989586621680313437"><span class="hs-identifier hs-var">utxoToCollect</span></a></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span>  </span><span id="local-6989586621680313439"><span class="annot"><span class="annottext">mkCommit :: TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))
</span><a href="#local-6989586621680313439"><span class="hs-identifier hs-var hs-var">mkCommit</span></a></span></span><span> </span><span id="local-6989586621680313462"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313462"><span class="hs-identifier hs-var">commitTxIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313462"><span class="hs-identifier hs-var">commitTxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313463"><span class="hs-identifier hs-var">commitWitness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>  </span><span id="local-6989586621680313463"><span class="annot"><span class="annottext">commitWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313463"><span class="hs-identifier hs-var hs-var">commitWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn Era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-405"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-406"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguageInEra lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; HashableScriptData
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313441"><span class="hs-identifier hs-var">commitScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313464"><span class="hs-identifier hs-var">commitScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">InlineScriptDatum</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680313465"><span class="hs-identifier hs-var">commitRedeemer</span></a></span><span>
</span><span id="line-407"></span><span>  </span><span id="local-6989586621680313441"><span class="annot"><span class="annottext">commitScriptRef :: TxIn
</span><a href="#local-6989586621680313441"><span class="hs-identifier hs-var hs-var">commitScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#%24sel%3AcommitReference%3AScriptRegistry"><span class="hs-identifier hs-var">commitReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313430"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>  </span><span id="local-6989586621680313457"><span class="annot"><span class="annottext">commitValue :: Value
</span><a href="#local-6989586621680313457"><span class="hs-identifier hs-var hs-var">commitValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Value] -&gt; Value) -&gt; [Value] -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Value) -&gt; [TxOut CtxUTxO] -&gt; [Value]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO) -&gt; [TxOut CtxUTxO]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313436"><span class="hs-identifier hs-var">commits</span></a></span><span>
</span><span id="line-411"></span><span>  </span><span id="local-6989586621680313464"><span class="annot"><span class="annottext">commitScript :: PlutusScript
</span><a href="#local-6989586621680313464"><span class="hs-identifier hs-var hs-var">commitScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Commit.validatorScript</span></span><span>
</span><span id="line-413"></span><span>  </span><span id="local-6989586621680313465"><span class="annot"><span class="annottext">commitRedeemer :: HashableScriptData
</span><a href="#local-6989586621680313465"><span class="hs-identifier hs-var hs-var">commitRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><span class="annottext">Redeemer -&gt; HashableScriptData
forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">(Redeemer -&gt; HashableScriptData) -&gt; Redeemer -&gt; HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RedeemerType -&gt; Redeemer
</span><span class="hs-identifier hs-var">Commit.redeemer</span></span><span> </span><span class="annot"><span class="annottext">RedeemerType
</span><span class="hs-identifier hs-var">Commit.ViaCollectCom</span></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="hs-comment">-- | Low-level data type of a snapshot to close the head with. This is different</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- to the 'ConfirmedSnasphot', which is provided to `CloseTx` as it also</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- contains relevant chain state like the 'openUtxoHash'.</span><span>
</span><span id="line-419"></span><span class="hs-keyword">data</span><span> </span><span id="ClosingSnapshot"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosingSnapshot"><span class="hs-identifier hs-var">ClosingSnapshot</span></a></span></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CloseWithInitialSnapshot"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-var">CloseWithInitialSnapshot</span></a></span></span><span> </span><span class="hs-special">{</span><span id="openUtxoHash"><span class="annot"><span class="annottext">ClosingSnapshot -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#openUtxoHash"><span class="hs-identifier hs-var hs-var">openUtxoHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CloseWithConfirmedSnapshot"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithConfirmedSnapshot"><span class="hs-identifier hs-var">CloseWithConfirmedSnapshot</span></a></span></span><span>
</span><span id="line-422"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AsnapshotNumber%3ACloseWithInitialSnapshot"><span class="annot"><span class="annottext">ClosingSnapshot -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#SnapshotNumber"><span class="hs-identifier hs-type">SnapshotNumber</span></a></span><span>
</span><span id="line-423"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcloseUtxoHash%3ACloseWithInitialSnapshot"><span class="annot"><span class="annottext">ClosingSnapshot -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcloseUtxoHash%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var hs-var">closeUtxoHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span>
</span><span id="line-424"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- XXX: This is a bit of a wart and stems from the fact that our</span><span>
</span><span id="line-425"></span><span>        </span><span class="hs-comment">-- SignableRepresentation of 'Snapshot' is in fact the snapshotNumber</span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-comment">-- and the closeUtxoHash as also included above</span><span>
</span><span id="line-427"></span><span>        </span><span id="%24sel%3Asignatures%3ACloseWithInitialSnapshot"><span class="annot"><span class="annottext">ClosingSnapshot -&gt; MultiSignature (Snapshot Tx)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Asignatures%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var hs-var">signatures</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Crypto.html#MultiSignature"><span class="hs-identifier hs-type">MultiSignature</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier hs-type">Snapshot</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="hs-keyword">data</span><span> </span><span id="CloseTxError"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseTxError"><span class="hs-identifier hs-var">CloseTxError</span></a></span></span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="InvalidHeadIdInClose"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InvalidHeadIdInClose"><span class="hs-identifier hs-var">InvalidHeadIdInClose</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AheadId%3AInvalidHeadIdInClose"><span class="annot"><span class="annottext">CloseTxError -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AInvalidHeadIdInClose"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CannotFindHeadOutputToClose"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CannotFindHeadOutputToClose"><span class="hs-identifier hs-var">CannotFindHeadOutputToClose</span></a></span></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313481"><span id="local-6989586621680313486"><span id="local-6989586621680313490"><span class="annot"><span class="annottext">Int -&gt; CloseTxError -&gt; ShowS
[CloseTxError] -&gt; ShowS
CloseTxError -&gt; String
(Int -&gt; CloseTxError -&gt; ShowS)
-&gt; (CloseTxError -&gt; String)
-&gt; ([CloseTxError] -&gt; ShowS)
-&gt; Show CloseTxError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CloseTxError -&gt; ShowS
showsPrec :: Int -&gt; CloseTxError -&gt; ShowS
$cshow :: CloseTxError -&gt; String
show :: CloseTxError -&gt; String
$cshowList :: [CloseTxError] -&gt; ShowS
showList :: [CloseTxError] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="hs-comment">-- | Create a transaction closing a head with either the initial snapshot or</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- with a multi-signed confirmed snapshot.</span><span>
</span><span id="line-437"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#closeTx"><span class="hs-identifier hs-type">closeTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Published Hydra scripts to reference.</span></span><span>
</span><span id="line-439"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-440"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Party who's authorizing this transaction</span></span><span>
</span><span id="line-441"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-442"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The snapshot to close with, can be either initial or confirmed one.</span></span><span>
</span><span id="line-443"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosingSnapshot"><span class="hs-identifier hs-type">ClosingSnapshot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Lower validity slot number, usually a current or quite recent slot number.</span></span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Upper validity slot and UTC time to compute the contestation deadline time.</span></span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#PointInTime"><span class="hs-identifier hs-type">PointInTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span></span><span>
</span><span id="line-449"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-type">OpenThreadOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Head identifier</span></span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-452"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-453"></span><span id="closeTx"><span class="annot"><span class="annottext">closeTx :: ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; ClosingSnapshot
-&gt; SlotNo
-&gt; PointInTime
-&gt; OpenThreadOutput
-&gt; HeadId
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#closeTx"><span class="hs-identifier hs-var hs-var">closeTx</span></a></span></span><span> </span><span id="local-6989586621680313493"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313493"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621680313494"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680313494"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span id="local-6989586621680313495"><span class="annot"><span class="annottext">ClosingSnapshot
</span><a href="#local-6989586621680313495"><span class="hs-identifier hs-var">closing</span></a></span></span><span> </span><span id="local-6989586621680313496"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680313496"><span class="hs-identifier hs-var">startSlotNo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313497"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680313497"><span class="hs-identifier hs-var">endSlotNo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313498"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680313498"><span class="hs-identifier hs-var">utcTime</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680313499"><span class="annot"><span class="annottext">OpenThreadOutput
</span><a href="#local-6989586621680313499"><span class="hs-identifier hs-var">openThreadOutput</span></a></span></span><span> </span><span id="local-6989586621680313500"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680313500"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-454"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-456"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
-&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313501"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313502"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313503"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680313504"><span class="hs-identifier hs-var">headOutputAfter</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-459"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier hs-var">addExtraRequiredSigners</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680313494"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-460"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#setValidityLowerBound"><span class="hs-identifier hs-var">setValidityLowerBound</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680313496"><span class="hs-identifier hs-var">startSlotNo</span></a></span><span>
</span><span id="line-461"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#setValidityUpperBound"><span class="hs-identifier hs-var">setValidityUpperBound</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680313497"><span class="hs-identifier hs-var">endSlotNo</span></a></span><span>
</span><span id="line-462"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
forall era build.
TxMetadataInEra era
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><span class="hs-identifier hs-var">setTxMetadata</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxMetadata -&gt; TxMetadataInEra
</span><span class="hs-identifier hs-var">TxMetadataInEra</span></span><span> </span><span class="annot"><span class="annottext">(TxMetadata -&gt; TxMetadataInEra) -&gt; TxMetadata -&gt; TxMetadataInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TxMetadata
</span><a href="Hydra.Chain.Direct.Tx.html#mkHydraHeadV1TxName"><span class="hs-identifier hs-var">mkHydraHeadV1TxName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;CloseTx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-type">OpenThreadOutput</span></a></span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:openThreadUTxO:OpenThreadOutput :: OpenThreadOutput -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenThreadUTxO%3AOpenThreadOutput"><span class="hs-identifier hs-var">openThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313501"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313501"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313505"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313505"><span class="hs-identifier hs-var">headOutputBefore</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313506"><span class="annot"><span class="annottext">ContestationPeriod
$sel:openContestationPeriod:OpenThreadOutput :: OpenThreadOutput -&gt; ContestationPeriod
openContestationPeriod :: ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenContestationPeriod%3AOpenThreadOutput"><span class="hs-identifier hs-var hs-var">openContestationPeriod</span></a></span></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313507"><span class="annot"><span class="annottext">[Party]
$sel:openParties:OpenThreadOutput :: OpenThreadOutput -&gt; [Party]
openParties :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenParties%3AOpenThreadOutput"><span class="hs-identifier hs-var hs-var">openParties</span></a></span></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenThreadOutput
</span><a href="#local-6989586621680313499"><span class="hs-identifier hs-var">openThreadOutput</span></a></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>  </span><span id="local-6989586621680313502"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313502"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-471"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn Era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-472"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguageInEra lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; HashableScriptData
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313503"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313508"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">InlineScriptDatum</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680313509"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>  </span><span id="local-6989586621680313503"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621680313503"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#%24sel%3AheadReference%3AScriptRegistry"><span class="hs-identifier hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313493"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>  </span><span id="local-6989586621680313508"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621680313508"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span>  </span><span id="local-6989586621680313509"><span class="annot"><span class="annottext">headRedeemer :: HashableScriptData
</span><a href="#local-6989586621680313509"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><span class="annottext">Input -&gt; HashableScriptData
forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span>
</span><span id="line-483"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Close</span></span><span>
</span><span id="line-484"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[BuiltinByteString]
signature :: [BuiltinByteString]
$sel:signature:CollectCom :: [BuiltinByteString]
</span><a href="#local-6989586621680313511"><span class="hs-keyword hs-var hs-var">signature</span></a></span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>  </span><span id="local-6989586621680313504"><span class="annot"><span class="annottext">headOutputAfter :: TxOut CtxTx
</span><a href="#local-6989586621680313504"><span class="hs-identifier hs-var hs-var">headOutputAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><span class="annottext">(TxOutDatum CtxUTxO -&gt; TxOutDatum CtxTx)
-&gt; TxOut CtxUTxO -&gt; TxOut CtxTx
forall ctx0 era ctx1.
(TxOutDatum ctx0 era -&gt; TxOutDatum ctx1 era)
-&gt; TxOut ctx0 era -&gt; TxOut ctx1 era
</span><span class="hs-identifier hs-var">modifyTxOutDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutDatum CtxTx -&gt; TxOutDatum CtxUTxO -&gt; TxOutDatum CtxTx
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680313515"><span class="hs-identifier hs-var">headDatumAfter</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313505"><span class="hs-identifier hs-var">headOutputBefore</span></a></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span>  </span><span id="local-6989586621680313515"><span class="annot"><span class="annottext">headDatumAfter :: TxOutDatum CtxTx
</span><a href="#local-6989586621680313515"><span class="hs-identifier hs-var hs-var">headDatumAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><span class="annottext">State -&gt; TxOutDatum CtxTx
forall era a ctx.
(ToScriptData a, IsBabbageEraOnwards era) =&gt;
a -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">mkTxOutDatumInline</span></span><span>
</span><span id="line-492"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span>
</span><span id="line-493"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Integer
snapshotNumber :: Integer
$sel:snapshotNumber:Initial :: Integer
</span><a href="#local-6989586621680313517"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoHash:Initial :: BuiltinByteString
</span><span class="hs-identifier hs-var">utxoHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BuiltinByteString
forall a arep. ToBuiltin a arep =&gt; a -&gt; arep
</span><span class="hs-identifier hs-var">toBuiltin</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680313519"><span class="hs-identifier hs-var">utxoHashBytes</span></a></span><span>
</span><span id="line-495"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:Initial :: [Party]
</span><span class="hs-identifier hs-var">parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680313507"><span class="hs-identifier hs-var">openParties</span></a></span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">POSIXTime
contestationDeadline :: POSIXTime
$sel:contestationDeadline:Initial :: POSIXTime
</span><a href="#local-6989586621680313520"><span class="hs-identifier hs-var hs-var">contestationDeadline</span></a></span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:Initial :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680313506"><span class="hs-identifier hs-var">openContestationPeriod</span></a></span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Initial :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680313500"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contesters:Initial :: [PubKeyHash]
</span><span class="hs-identifier hs-var">contesters</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span>  </span><span id="local-6989586621680313517"><span class="annot"><span class="annottext">snapshotNumber :: Integer
</span><a href="#local-6989586621680313517"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">(SnapshotNumber -&gt; Integer) -&gt; SnapshotNumber -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ClosingSnapshot
</span><a href="#local-6989586621680313495"><span class="hs-identifier hs-var">closing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><span class="hs-number">0</span></span><span>
</span><span id="line-504"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithConfirmedSnapshot"><span class="hs-identifier hs-type">CloseWithConfirmedSnapshot</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:snapshotNumber:CloseWithInitialSnapshot :: ClosingSnapshot -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680313523"><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621680313523"><span class="hs-identifier hs-var">sn</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621680313523"><span class="hs-identifier hs-var">sn</span></a></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span> </span><span id="local-6989586621680313519"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680313519"><span class="hs-identifier hs-var">utxoHashBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ClosingSnapshot
</span><a href="#local-6989586621680313495"><span class="hs-identifier hs-var">closing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-507"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span class="hs-special">{</span><span id="local-6989586621680313524"><span class="annot"><span class="annottext">UTxOHash
openUtxoHash :: ClosingSnapshot -&gt; UTxOHash
openUtxoHash :: UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#openUtxoHash"><span class="hs-identifier hs-var hs-var">openUtxoHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOHash
</span><a href="#local-6989586621680313524"><span class="hs-identifier hs-var">openUtxoHash</span></a></span><span>
</span><span id="line-508"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithConfirmedSnapshot"><span class="hs-identifier hs-type">CloseWithConfirmedSnapshot</span></a></span><span class="hs-special">{</span><span id="local-6989586621680313525"><span class="annot"><span class="annottext">UTxOHash
$sel:closeUtxoHash:CloseWithInitialSnapshot :: ClosingSnapshot -&gt; UTxOHash
closeUtxoHash :: UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcloseUtxoHash%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var hs-var">closeUtxoHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOHash
</span><a href="#local-6989586621680313525"><span class="hs-identifier hs-var">closeUtxoHash</span></a></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>  </span><span id="local-6989586621680313511"><span class="annot"><span class="annottext">signature :: [BuiltinByteString]
</span><a href="#local-6989586621680313511"><span class="hs-keyword hs-var hs-var">signature</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ClosingSnapshot
</span><a href="#local-6989586621680313495"><span class="hs-identifier hs-var">closing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-511"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[BuiltinByteString]
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithConfirmedSnapshot"><span class="hs-identifier hs-type">CloseWithConfirmedSnapshot</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:signatures:CloseWithInitialSnapshot :: ClosingSnapshot -&gt; MultiSignature (Snapshot Tx)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Asignatures%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var">signatures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680313526"><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621680313526"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx) -&gt; [BuiltinByteString]
forall {k} (a :: k). MultiSignature a -&gt; [BuiltinByteString]
</span><a href="Hydra.Crypto.html#toPlutusSignatures"><span class="hs-identifier hs-var">toPlutusSignatures</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621680313526"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>  </span><span id="local-6989586621680313520"><span class="annot"><span class="annottext">contestationDeadline :: POSIXTime
</span><a href="#local-6989586621680313520"><span class="hs-identifier hs-var hs-var">contestationDeadline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-515"></span><span>    </span><span class="annot"><span class="annottext">POSIXTime -&gt; ContestationPeriod -&gt; POSIXTime
</span><span class="hs-identifier hs-var">addContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; POSIXTime
</span><span class="hs-identifier hs-var">posixFromUTCTime</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680313498"><span class="hs-identifier hs-var">utcTime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680313506"><span class="hs-identifier hs-var">openContestationPeriod</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="hs-keyword">data</span><span> </span><span id="ContestTxError"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestTxError"><span class="hs-identifier hs-var">ContestTxError</span></a></span></span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="InvalidHeadIdInContest"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InvalidHeadIdInContest"><span class="hs-identifier hs-var">InvalidHeadIdInContest</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AheadId%3AInvalidHeadIdInContest"><span class="annot"><span class="annottext">ContestTxError -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AInvalidHeadIdInContest"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CannotFindHeadOutputToContest"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CannotFindHeadOutputToContest"><span class="hs-identifier hs-var">CannotFindHeadOutputToContest</span></a></span></span><span>
</span><span id="line-520"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingHeadDatumInContest"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#MissingHeadDatumInContest"><span class="hs-identifier hs-var">MissingHeadDatumInContest</span></a></span></span><span>
</span><span id="line-521"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingHeadRedeemerInContest"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#MissingHeadRedeemerInContest"><span class="hs-identifier hs-var">MissingHeadRedeemerInContest</span></a></span></span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="WrongDatumInContest"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#WrongDatumInContest"><span class="hs-identifier hs-var">WrongDatumInContest</span></a></span></span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FailedToConvertFromScriptDataInContest"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FailedToConvertFromScriptDataInContest"><span class="hs-identifier hs-var">FailedToConvertFromScriptDataInContest</span></a></span></span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313535"><span id="local-6989586621680313539"><span id="local-6989586621680313543"><span class="annot"><span class="annottext">Int -&gt; ContestTxError -&gt; ShowS
[ContestTxError] -&gt; ShowS
ContestTxError -&gt; String
(Int -&gt; ContestTxError -&gt; ShowS)
-&gt; (ContestTxError -&gt; String)
-&gt; ([ContestTxError] -&gt; ShowS)
-&gt; Show ContestTxError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ContestTxError -&gt; ShowS
showsPrec :: Int -&gt; ContestTxError -&gt; ShowS
$cshow :: ContestTxError -&gt; String
show :: ContestTxError -&gt; String
$cshowList :: [ContestTxError] -&gt; ShowS
showList :: [ContestTxError] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span class="hs-comment">-- XXX: This function is VERY similar to the 'closeTx' function (only notable</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- difference being the redeemer, which is in itself also the same structure as</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- the close's one. We could potentially refactor this to avoid repetition or do</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- something more principled at the protocol level itself and &quot;merge&quot; close and</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- contest as one operation.</span><span>
</span><span id="line-531"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#contestTx"><span class="hs-identifier hs-type">contestTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-532"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Published Hydra scripts to reference.</span></span><span>
</span><span id="line-533"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-534"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Party who's authorizing this transaction</span></span><span>
</span><span id="line-535"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-536"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Contested snapshot number (i.e. the one we contest to)</span></span><span>
</span><span id="line-537"></span><span>  </span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier hs-type">Snapshot</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Multi-signature of the whole snapshot</span></span><span>
</span><span id="line-539"></span><span>  </span><span class="annot"><a href="Hydra.Crypto.html#MultiSignature"><span class="hs-identifier hs-type">MultiSignature</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier hs-type">Snapshot</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-540"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Current slot and posix time to be used as the contestation time.</span></span><span>
</span><span id="line-541"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#PointInTime"><span class="hs-identifier hs-type">PointInTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-542"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span></span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-type">ClosedThreadOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-545"></span><span>  </span><span class="annot"><a href="Hydra.ContestationPeriod.html#ContestationPeriod"><span class="hs-identifier hs-type">ContestationPeriod</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-547"></span><span id="contestTx"><span class="annot"><span class="annottext">contestTx :: ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; Snapshot Tx
-&gt; MultiSignature (Snapshot Tx)
-&gt; PointInTime
-&gt; ClosedThreadOutput
-&gt; HeadId
-&gt; ContestationPeriod
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#contestTx"><span class="hs-identifier hs-var hs-var">contestTx</span></a></span></span><span> </span><span id="local-6989586621680313546"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313546"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621680313547"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680313547"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier hs-type">Snapshot</span></a></span><span class="hs-special">{</span><span id="local-6989586621680313549"><span class="annot"><span class="annottext">SnapshotNumber
number :: SnapshotNumber
$sel:number:Snapshot :: forall tx. Snapshot tx -&gt; SnapshotNumber
</span><a href="#local-6989586621680313549"><span class="hs-identifier hs-var hs-var">number</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313551"><span class="annot"><span class="annottext">UTxOType Tx
utxo :: UTxOType Tx
$sel:utxo:Snapshot :: forall tx. Snapshot tx -&gt; UTxOType tx
</span><a href="#local-6989586621680313551"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680313553"><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621680313553"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313554"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680313554"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680313555"><span class="annot"><span class="annottext">ClosedThreadOutput
</span><a href="#local-6989586621680313555"><span class="hs-identifier hs-var">closedThreadOutput</span></a></span></span><span> </span><span id="local-6989586621680313556"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680313556"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span id="local-6989586621680313557"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680313557"><span class="hs-identifier hs-var">contestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-548"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-549"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-550"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
-&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313558"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313559"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-551"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313560"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-552"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680313561"><span class="hs-identifier hs-var">headOutputAfter</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-553"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier hs-var">addExtraRequiredSigners</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680313547"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-554"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#setValidityUpperBound"><span class="hs-identifier hs-var">setValidityUpperBound</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680313554"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-555"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
forall era build.
TxMetadataInEra era
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><span class="hs-identifier hs-var">setTxMetadata</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxMetadata -&gt; TxMetadataInEra
</span><span class="hs-identifier hs-var">TxMetadataInEra</span></span><span> </span><span class="annot"><span class="annottext">(TxMetadata -&gt; TxMetadataInEra) -&gt; TxMetadata -&gt; TxMetadataInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TxMetadata
</span><a href="Hydra.Chain.Direct.Tx.html#mkHydraHeadV1TxName"><span class="hs-identifier hs-var">mkHydraHeadV1TxName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ContestTx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-557"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-type">ClosedThreadOutput</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:closedThreadUTxO:ClosedThreadOutput :: ClosedThreadOutput -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedThreadUTxO%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313558"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313558"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313562"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313562"><span class="hs-identifier hs-var">headOutputBefore</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313563"><span class="annot"><span class="annottext">[Party]
$sel:closedParties:ClosedThreadOutput :: ClosedThreadOutput -&gt; [Party]
closedParties :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedParties%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedParties</span></a></span></span><span>
</span><span id="line-560"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313564"><span class="annot"><span class="annottext">POSIXTime
$sel:closedContestationDeadline:ClosedThreadOutput :: ClosedThreadOutput -&gt; POSIXTime
closedContestationDeadline :: POSIXTime
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContestationDeadline%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedContestationDeadline</span></a></span></span><span>
</span><span id="line-561"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313565"><span class="annot"><span class="annottext">[PubKeyHash]
$sel:closedContesters:ClosedThreadOutput :: ClosedThreadOutput -&gt; [PubKeyHash]
closedContesters :: [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContesters%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedContesters</span></a></span></span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClosedThreadOutput
</span><a href="#local-6989586621680313555"><span class="hs-identifier hs-var">closedThreadOutput</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>  </span><span id="local-6989586621680313559"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313559"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-565"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn Era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-566"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-567"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguageInEra lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; HashableScriptData
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313560"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313566"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">InlineScriptDatum</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680313567"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-568"></span><span>  </span><span id="local-6989586621680313560"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621680313560"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-569"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#%24sel%3AheadReference%3AScriptRegistry"><span class="hs-identifier hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313546"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>  </span><span id="local-6989586621680313566"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621680313566"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-571"></span><span>    </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-572"></span><span>  </span><span id="local-6989586621680313567"><span class="annot"><span class="annottext">headRedeemer :: HashableScriptData
</span><a href="#local-6989586621680313567"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-573"></span><span>    </span><span class="annot"><span class="annottext">Input -&gt; HashableScriptData
forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span>
</span><span id="line-574"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Contest</span></span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:signature:CollectCom :: [BuiltinByteString]
</span><span class="hs-keyword hs-var">signature</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx) -&gt; [BuiltinByteString]
forall {k} (a :: k). MultiSignature a -&gt; [BuiltinByteString]
</span><a href="Hydra.Crypto.html#toPlutusSignatures"><span class="hs-identifier hs-var">toPlutusSignatures</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621680313553"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-576"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-577"></span><span>  </span><span id="local-6989586621680313561"><span class="annot"><span class="annottext">headOutputAfter :: TxOut CtxTx
</span><a href="#local-6989586621680313561"><span class="hs-identifier hs-var hs-var">headOutputAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><span class="annottext">(TxOutDatum CtxUTxO -&gt; TxOutDatum CtxTx)
-&gt; TxOut CtxUTxO -&gt; TxOut CtxTx
forall ctx0 era ctx1.
(TxOutDatum ctx0 era -&gt; TxOutDatum ctx1 era)
-&gt; TxOut ctx0 era -&gt; TxOut ctx1 era
</span><span class="hs-identifier hs-var">modifyTxOutDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutDatum CtxTx -&gt; TxOutDatum CtxUTxO -&gt; TxOutDatum CtxTx
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680313569"><span class="hs-identifier hs-var">headDatumAfter</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313562"><span class="hs-identifier hs-var">headOutputBefore</span></a></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>  </span><span id="local-6989586621680313570"><span class="annot"><span class="annottext">contester :: PubKeyHash
</span><a href="#local-6989586621680313570"><span class="hs-identifier hs-var hs-var">contester</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; PubKeyHash
</span><span class="hs-identifier hs-var">toPlutusKeyHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680313547"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span>  </span><span id="local-6989586621680313572"><span class="annot"><span class="annottext">onChainConstestationPeriod :: ContestationPeriod
</span><a href="#local-6989586621680313572"><span class="hs-identifier hs-var hs-var">onChainConstestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><a href="Hydra.ContestationPeriod.html#toChain"><span class="hs-identifier hs-var">toChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680313557"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span>  </span><span id="local-6989586621680313573"><span class="annot"><span class="annottext">newContestationDeadline :: POSIXTime
</span><a href="#local-6989586621680313573"><span class="hs-identifier hs-var hs-var">newContestationDeadline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-585"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[PubKeyHash] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621680313570"><span class="hs-identifier hs-var">contester</span></a></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; [PubKeyHash] -&gt; [PubKeyHash]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621680313565"><span class="hs-identifier hs-var">closedContesters</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">[Party] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680313563"><span class="hs-identifier hs-var">closedParties</span></a></span><span>
</span><span id="line-586"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680313564"><span class="hs-identifier hs-var">closedContestationDeadline</span></a></span><span>
</span><span id="line-587"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; ContestationPeriod -&gt; POSIXTime
</span><span class="hs-identifier hs-var">addContestationPeriod</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680313564"><span class="hs-identifier hs-var">closedContestationDeadline</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680313572"><span class="hs-identifier hs-var">onChainConstestationPeriod</span></a></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>  </span><span id="local-6989586621680313569"><span class="annot"><span class="annottext">headDatumAfter :: TxOutDatum CtxTx
</span><a href="#local-6989586621680313569"><span class="hs-identifier hs-var hs-var">headDatumAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-590"></span><span>    </span><span class="annot"><span class="annottext">State -&gt; TxOutDatum CtxTx
forall era a ctx.
(ToScriptData a, IsBabbageEraOnwards era) =&gt;
a -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">mkTxOutDatumInline</span></span><span>
</span><span id="line-591"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span>
</span><span id="line-592"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:snapshotNumber:Initial :: Integer
</span><span class="hs-identifier hs-var">snapshotNumber</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621680313549"><span class="hs-identifier hs-var">number</span></a></span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
$sel:utxoHash:Initial :: BuiltinByteString
utxoHash :: BuiltinByteString
</span><span class="hs-identifier hs-var hs-var">utxoHash</span></span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:Initial :: [Party]
</span><span class="hs-identifier hs-var">parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680313563"><span class="hs-identifier hs-var">closedParties</span></a></span><span>
</span><span id="line-595"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationDeadline:Initial :: POSIXTime
</span><span class="hs-identifier hs-var">contestationDeadline</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680313573"><span class="hs-identifier hs-var">newContestationDeadline</span></a></span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:Initial :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680313572"><span class="hs-identifier hs-var">onChainConstestationPeriod</span></a></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Initial :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680313556"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contesters:Initial :: [PubKeyHash]
</span><span class="hs-identifier hs-var">contesters</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621680313570"><span class="hs-identifier hs-var">contester</span></a></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; [PubKeyHash] -&gt; [PubKeyHash]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621680313565"><span class="hs-identifier hs-var">closedContesters</span></a></span><span>
</span><span id="line-599"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-600"></span><span>  </span><span id="local-6989586621680313575"><span class="annot"><span class="annottext">utxoHash :: BuiltinByteString
</span><a href="#local-6989586621680313575"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BuiltinByteString
forall a arep. ToBuiltin a arep =&gt; a -&gt; arep
</span><span class="hs-identifier hs-var">toBuiltin</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; BuiltinByteString)
-&gt; ByteString -&gt; BuiltinByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tx. IsTx tx =&gt; UTxOType tx -&gt; ByteString
</span><a href="Hydra.Ledger.html#hashUTxO"><span class="hs-identifier hs-var">hashUTxO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><span class="annottext">UTxOType Tx
</span><a href="#local-6989586621680313551"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="hs-keyword">data</span><span> </span><span id="FanoutTxError"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutTxError"><span class="hs-identifier hs-var">FanoutTxError</span></a></span></span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CannotFindHeadOutputToFanout"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CannotFindHeadOutputToFanout"><span class="hs-identifier hs-var">CannotFindHeadOutputToFanout</span></a></span></span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingHeadDatumInFanout"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#MissingHeadDatumInFanout"><span class="hs-identifier hs-var">MissingHeadDatumInFanout</span></a></span></span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="WrongDatumInFanout"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#WrongDatumInFanout"><span class="hs-identifier hs-var">WrongDatumInFanout</span></a></span></span><span>
</span><span id="line-606"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FailedToConvertFromScriptDataInFanout"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FailedToConvertFromScriptDataInFanout"><span class="hs-identifier hs-var">FailedToConvertFromScriptDataInFanout</span></a></span></span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313581"><span id="local-6989586621680313583"><span id="local-6989586621680313587"><span class="annot"><span class="annottext">Int -&gt; FanoutTxError -&gt; ShowS
[FanoutTxError] -&gt; ShowS
FanoutTxError -&gt; String
(Int -&gt; FanoutTxError -&gt; ShowS)
-&gt; (FanoutTxError -&gt; String)
-&gt; ([FanoutTxError] -&gt; ShowS)
-&gt; Show FanoutTxError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; FanoutTxError -&gt; ShowS
showsPrec :: Int -&gt; FanoutTxError -&gt; ShowS
$cshow :: FanoutTxError -&gt; String
show :: FanoutTxError -&gt; String
$cshowList :: [FanoutTxError] -&gt; ShowS
showList :: [FanoutTxError] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span class="hs-comment">-- | Create the fanout transaction, which distributes the closed state</span><span>
</span><span id="line-610"></span><span class="hs-comment">-- accordingly. The head validator allows fanout only &gt; deadline, so we need</span><span>
</span><span id="line-611"></span><span class="hs-comment">-- to set the lower bound to be deadline + 1 slot.</span><span>
</span><span id="line-612"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#fanoutTx"><span class="hs-identifier hs-type">fanoutTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-613"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Published Hydra scripts to reference.</span></span><span>
</span><span id="line-614"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-615"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Snapshotted UTxO to fanout on layer 1</span></span><span>
</span><span id="line-616"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-617"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span></span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-619"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Contestation deadline as SlotNo, used to set lower tx validity bound.</span></span><span>
</span><span id="line-620"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-621"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Minting Policy script, made from initial seed</span></span><span>
</span><span id="line-622"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PlutusScript</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-623"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-624"></span><span id="fanoutTx"><span class="annot"><span class="annottext">fanoutTx :: ScriptRegistry
-&gt; UTxO' (TxOut CtxUTxO)
-&gt; (TxIn, TxOut CtxUTxO)
-&gt; SlotNo
-&gt; PlutusScript
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#fanoutTx"><span class="hs-identifier hs-var hs-var">fanoutTx</span></a></span></span><span> </span><span id="local-6989586621680313590"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313590"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621680313591"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313591"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313592"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313592"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313593"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313593"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680313594"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680313594"><span class="hs-identifier hs-var">deadlineSlotNo</span></a></span></span><span> </span><span id="local-6989586621680313595"><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313595"><span class="hs-identifier hs-var">headTokenScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-625"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-626"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-627"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
-&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313592"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313596"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-628"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313597"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-629"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx]
</span><a href="#local-6989586621680313598"><span class="hs-identifier hs-var">orderedTxOutsToFanout</span></a></span><span>
</span><span id="line-630"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
-&gt; MintAction
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
forall redeemer.
ToScriptData redeemer =&gt;
PlutusScript
-&gt; redeemer
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#burnTokens"><span class="hs-identifier hs-var">burnTokens</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313595"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span> </span><span class="annot"><span class="annottext">MintAction
</span><span class="hs-identifier hs-var">Burn</span></span><span> </span><span class="annot"><span class="annottext">[(AssetName, Quantity)]
</span><a href="#local-6989586621680313599"><span class="hs-identifier hs-var">headTokens</span></a></span><span>
</span><span id="line-631"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#setValidityLowerBound"><span class="hs-identifier hs-var">setValidityLowerBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680313594"><span class="hs-identifier hs-var">deadlineSlotNo</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; SlotNo
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
forall era build.
TxMetadataInEra era
-&gt; TxBodyContent build era -&gt; TxBodyContent build era
</span><span class="hs-identifier hs-var">setTxMetadata</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxMetadata -&gt; TxMetadataInEra
</span><span class="hs-identifier hs-var">TxMetadataInEra</span></span><span> </span><span class="annot"><span class="annottext">(TxMetadata -&gt; TxMetadataInEra) -&gt; TxMetadata -&gt; TxMetadataInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; TxMetadata
</span><a href="Hydra.Chain.Direct.Tx.html#mkHydraHeadV1TxName"><span class="hs-identifier hs-var">mkHydraHeadV1TxName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;FanoutTx&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-634"></span><span>  </span><span id="local-6989586621680313596"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313596"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-635"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn Era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-636"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-637"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguageInEra lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; HashableScriptData
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313597"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313601"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">InlineScriptDatum</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680313602"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-638"></span><span>  </span><span id="local-6989586621680313597"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621680313597"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-639"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#%24sel%3AheadReference%3AScriptRegistry"><span class="hs-identifier hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313590"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>  </span><span id="local-6989586621680313601"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621680313601"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-641"></span><span>    </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-642"></span><span>  </span><span id="local-6989586621680313602"><span class="annot"><span class="annottext">headRedeemer :: HashableScriptData
</span><a href="#local-6989586621680313602"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-643"></span><span>    </span><span class="annot"><span class="annottext">Input -&gt; HashableScriptData
forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Input
</span><span class="hs-identifier hs-var">Head.Fanout</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Input) -&gt; Integer -&gt; Input
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Int
forall a. UTxO' a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313591"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>  </span><span id="local-6989586621680313599"><span class="annot"><span class="annottext">headTokens :: [(AssetName, Quantity)]
</span><a href="#local-6989586621680313599"><span class="hs-identifier hs-var hs-var">headTokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><span class="annottext">PlutusScript -&gt; Value -&gt; [(AssetName, Quantity)]
</span><a href="Hydra.Chain.Direct.Tx.html#headTokensFromValue"><span class="hs-identifier hs-var">headTokensFromValue</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313595"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313593"><span class="hs-identifier hs-var">headOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span>  </span><span id="local-6989586621680313598"><span class="annot"><span class="annottext">orderedTxOutsToFanout :: [TxOut CtxTx]
</span><a href="#local-6989586621680313598"><span class="hs-identifier hs-var hs-var">orderedTxOutsToFanout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-649"></span><span>    </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; TxOut CtxTx) -&gt; [TxOut CtxUTxO] -&gt; [TxOut CtxTx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; [TxOut CtxUTxO]
forall a. UTxO' a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313591"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span class="hs-keyword">data</span><span> </span><span id="AbortTxError"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortTxError"><span class="hs-identifier hs-var">AbortTxError</span></a></span></span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="OverlappingInputs"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OverlappingInputs"><span class="hs-identifier hs-var">OverlappingInputs</span></a></span></span><span>
</span><span id="line-653"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CannotFindHeadOutputToAbort"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CannotFindHeadOutputToAbort"><span class="hs-identifier hs-var">CannotFindHeadOutputToAbort</span></a></span></span><span>
</span><span id="line-654"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313610"><span id="local-6989586621680313612"><span id="local-6989586621680313616"><span class="annot"><span class="annottext">Int -&gt; AbortTxError -&gt; ShowS
[AbortTxError] -&gt; ShowS
AbortTxError -&gt; String
(Int -&gt; AbortTxError -&gt; ShowS)
-&gt; (AbortTxError -&gt; String)
-&gt; ([AbortTxError] -&gt; ShowS)
-&gt; Show AbortTxError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; AbortTxError -&gt; ShowS
showsPrec :: Int -&gt; AbortTxError -&gt; ShowS
$cshow :: AbortTxError -&gt; String
show :: AbortTxError -&gt; String
$cshowList :: [AbortTxError] -&gt; ShowS
showList :: [AbortTxError] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="hs-comment">-- | Create transaction which aborts a head by spending the Head output and all</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- other &quot;initial&quot; outputs.</span><span>
</span><span id="line-658"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#abortTx"><span class="hs-identifier hs-type">abortTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-659"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Committed UTxOs to reimburse.</span></span><span>
</span><span id="line-660"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-661"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Published Hydra scripts to reference.</span></span><span>
</span><span id="line-662"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-663"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Party who's authorizing this transaction</span></span><span>
</span><span id="line-664"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-665"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span></span><span>
</span><span id="line-666"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-667"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Script for monetary policy to burn tokens</span></span><span>
</span><span id="line-668"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PlutusScript</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-comment">-- | Data needed to spend the initial output sent to each party to the Head.</span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-comment">-- Should contain the PT and is locked by initial script.</span><span>
</span><span id="line-671"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-672"></span><span>  </span><span class="hs-comment">-- | Data needed to spend commit outputs.</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-comment">-- Should contain the PT and is locked by commit script.</span><span>
</span><span id="line-674"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortTxError"><span class="hs-identifier hs-type">AbortTxError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-676"></span><span id="abortTx"><span class="annot"><span class="annottext">abortTx :: UTxO' (TxOut CtxUTxO)
-&gt; ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; (TxIn, TxOut CtxUTxO)
-&gt; PlutusScript
-&gt; Map TxIn (TxOut CtxUTxO)
-&gt; Map TxIn (TxOut CtxUTxO)
-&gt; Either AbortTxError Tx
</span><a href="Hydra.Chain.Direct.Tx.html#abortTx"><span class="hs-identifier hs-var hs-var">abortTx</span></a></span></span><span> </span><span id="local-6989586621680313619"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313619"><span class="hs-identifier hs-var">committedUTxO</span></a></span></span><span> </span><span id="local-6989586621680313620"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313620"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621680313621"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680313621"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313622"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313622"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313623"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313623"><span class="hs-identifier hs-var">initialHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680313624"><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313624"><span class="hs-identifier hs-var">headTokenScript</span></a></span></span><span> </span><span id="local-6989586621680313625"><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313625"><span class="hs-identifier hs-var">initialsToAbort</span></a></span></span><span> </span><span id="local-6989586621680313626"><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313626"><span class="hs-identifier hs-var">commitsToAbort</span></a></span></span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut CtxUTxO) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key (Map TxIn (TxOut CtxUTxO))
-&gt; Map TxIn (TxOut CtxUTxO)
-&gt; Maybe (Val (Map TxIn (TxOut CtxUTxO)))
forall t. StaticMap t =&gt; Key t -&gt; t -&gt; Maybe (Val t)
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">Key (Map TxIn (TxOut CtxUTxO))
TxIn
</span><a href="#local-6989586621680313622"><span class="hs-identifier hs-var">headInput</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313625"><span class="hs-identifier hs-var">initialsToAbort</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-678"></span><span>      </span><span class="annot"><span class="annottext">AbortTxError -&gt; Either AbortTxError Tx
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">AbortTxError
</span><a href="Hydra.Chain.Direct.Tx.html#OverlappingInputs"><span class="hs-identifier hs-var">OverlappingInputs</span></a></span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-680"></span><span>      </span><span class="annot"><span class="annottext">Tx -&gt; Either AbortTxError Tx
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx -&gt; Either AbortTxError Tx) -&gt; Tx -&gt; Either AbortTxError Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-681"></span><span>        </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-682"></span><span>          </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-683"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
-&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313622"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313629"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
-&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
</span><a href="#local-6989586621680313630"><span class="hs-identifier hs-var">initialInputs</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
-&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
-&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
</span><a href="#local-6989586621680313631"><span class="hs-identifier hs-var">commitInputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313632"><span class="hs-identifier hs-var">initialScriptRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313633"><span class="hs-identifier hs-var">commitScriptRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313634"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-685"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx]
</span><a href="#local-6989586621680313635"><span class="hs-identifier hs-var">reimbursedOutputs</span></a></span><span>
</span><span id="line-686"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
-&gt; MintAction
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
forall redeemer.
ToScriptData redeemer =&gt;
PlutusScript
-&gt; redeemer
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#burnTokens"><span class="hs-identifier hs-var">burnTokens</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313624"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span> </span><span class="annot"><span class="annottext">MintAction
</span><span class="hs-identifier hs-var">Burn</span></span><span> </span><span class="annot"><span class="annottext">[(AssetName, Quantity)]
</span><a href="#local-6989586621680313636"><span class="hs-identifier hs-var">headTokens</span></a></span><span>
</span><span id="line-687"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier hs-var">addExtraRequiredSigners</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680313621"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-688"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-689"></span><span>  </span><span id="local-6989586621680313629"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313629"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-690"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn Era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-691"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-692"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguageInEra lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; HashableScriptData
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313634"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313637"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">InlineScriptDatum</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680313638"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span id="local-6989586621680313634"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621680313634"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-694"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#%24sel%3AheadReference%3AScriptRegistry"><span class="hs-identifier hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313620"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>  </span><span id="local-6989586621680313637"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621680313637"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-697"></span><span>  </span><span id="local-6989586621680313638"><span class="annot"><span class="annottext">headRedeemer :: HashableScriptData
</span><a href="#local-6989586621680313638"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-698"></span><span>    </span><span class="annot"><span class="annottext">Input -&gt; HashableScriptData
forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.Abort</span></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span>  </span><span id="local-6989586621680313630"><span class="annot"><span class="annottext">initialInputs :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
</span><a href="#local-6989586621680313630"><span class="hs-identifier hs-var hs-var">initialInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))
</span><a href="#local-6989586621680313641"><span class="hs-identifier hs-var">mkAbortInitial</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era)))
-&gt; [TxIn] -&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO) -&gt; [TxIn]
forall k a. Map k a -&gt; [k]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313625"><span class="hs-identifier hs-var">initialsToAbort</span></a></span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span>  </span><span id="local-6989586621680313631"><span class="annot"><span class="annottext">commitInputs :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
</span><a href="#local-6989586621680313631"><span class="hs-identifier hs-var hs-var">commitInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))
</span><a href="#local-6989586621680313642"><span class="hs-identifier hs-var">mkAbortCommit</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era)))
-&gt; [TxIn] -&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO) -&gt; [TxIn]
forall k a. Map k a -&gt; [k]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313626"><span class="hs-identifier hs-var">commitsToAbort</span></a></span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span>  </span><span id="local-6989586621680313636"><span class="annot"><span class="annottext">headTokens :: [(AssetName, Quantity)]
</span><a href="#local-6989586621680313636"><span class="hs-identifier hs-var hs-var">headTokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-705"></span><span>    </span><span class="annot"><span class="annottext">PlutusScript -&gt; Value -&gt; [(AssetName, Quantity)]
</span><a href="Hydra.Chain.Direct.Tx.html#headTokensFromValue"><span class="hs-identifier hs-var">headTokensFromValue</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313624"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [(AssetName, Quantity)])
-&gt; Value -&gt; [(AssetName, Quantity)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-706"></span><span>      </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-707"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680313623"><span class="hs-identifier hs-var">initialHeadOutput</span></a></span><span>
</span><span id="line-708"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Value) -&gt; Map TxIn (TxOut CtxUTxO) -&gt; Value
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Map TxIn a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#foldMap"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313625"><span class="hs-identifier hs-var">initialsToAbort</span></a></span><span>
</span><span id="line-709"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Value) -&gt; Map TxIn (TxOut CtxUTxO) -&gt; Value
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Map TxIn a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#foldMap"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO)
</span><a href="#local-6989586621680313626"><span class="hs-identifier hs-var">commitsToAbort</span></a></span><span>
</span><span id="line-710"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span>  </span><span id="local-6989586621680313641"><span class="annot"><span class="annottext">mkAbortInitial :: TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))
</span><a href="#local-6989586621680313641"><span class="hs-identifier hs-var hs-var">mkAbortInitial</span></a></span></span><span> </span><span id="local-6989586621680313643"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313643"><span class="hs-identifier hs-var">initialInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313643"><span class="hs-identifier hs-var">initialInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313644"><span class="hs-identifier hs-var">abortInitialWitness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>  </span><span id="local-6989586621680313644"><span class="annot"><span class="annottext">abortInitialWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313644"><span class="hs-identifier hs-var hs-var">abortInitialWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn Era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-715"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-716"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguageInEra lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; HashableScriptData
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313632"><span class="hs-identifier hs-var">initialScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313645"><span class="hs-identifier hs-var">initialScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">InlineScriptDatum</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680313646"><span class="hs-identifier hs-var">initialRedeemer</span></a></span><span>
</span><span id="line-717"></span><span>  </span><span id="local-6989586621680313632"><span class="annot"><span class="annottext">initialScriptRef :: TxIn
</span><a href="#local-6989586621680313632"><span class="hs-identifier hs-var hs-var">initialScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-718"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#%24sel%3AinitialReference%3AScriptRegistry"><span class="hs-identifier hs-var">initialReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313620"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>  </span><span id="local-6989586621680313645"><span class="annot"><span class="annottext">initialScript :: PlutusScript
</span><a href="#local-6989586621680313645"><span class="hs-identifier hs-var hs-var">initialScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-720"></span><span>    </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Initial.validatorScript</span></span><span>
</span><span id="line-721"></span><span>  </span><span id="local-6989586621680313646"><span class="annot"><span class="annottext">initialRedeemer :: HashableScriptData
</span><a href="#local-6989586621680313646"><span class="hs-identifier hs-var hs-var">initialRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-722"></span><span>    </span><span class="annot"><span class="annottext">Redeemer -&gt; HashableScriptData
forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">(Redeemer -&gt; HashableScriptData) -&gt; Redeemer -&gt; HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InitialRedeemer -&gt; Redeemer
</span><span class="hs-identifier hs-var">Initial.redeemer</span></span><span> </span><span class="annot"><span class="annottext">InitialRedeemer
</span><span class="hs-identifier hs-var">Initial.ViaAbort</span></span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span>  </span><span id="local-6989586621680313642"><span class="annot"><span class="annottext">mkAbortCommit :: TxIn -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn Era))
</span><a href="#local-6989586621680313642"><span class="hs-identifier hs-var hs-var">mkAbortCommit</span></a></span></span><span> </span><span id="local-6989586621680313649"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313649"><span class="hs-identifier hs-var">commitInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313649"><span class="hs-identifier hs-var">commitInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313650"><span class="hs-identifier hs-var">abortCommitWitness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>  </span><span id="local-6989586621680313650"><span class="annot"><span class="annottext">abortCommitWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn Era)
</span><a href="#local-6989586621680313650"><span class="hs-identifier hs-var hs-var">abortCommitWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-726"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn Era
 -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era))
-&gt; Witness WitCtxTxIn Era
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-727"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-728"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; HashableScriptData
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguageInEra lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; HashableScriptData
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680313633"><span class="hs-identifier hs-var">commitScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680313651"><span class="hs-identifier hs-var">commitScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">InlineScriptDatum</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680313652"><span class="hs-identifier hs-var">commitRedeemer</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span id="local-6989586621680313633"><span class="annot"><span class="annottext">commitScriptRef :: TxIn
</span><a href="#local-6989586621680313633"><span class="hs-identifier hs-var hs-var">commitScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-730"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#%24sel%3AcommitReference%3AScriptRegistry"><span class="hs-identifier hs-var">commitReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680313620"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>  </span><span id="local-6989586621680313651"><span class="annot"><span class="annottext">commitScript :: PlutusScript
</span><a href="#local-6989586621680313651"><span class="hs-identifier hs-var hs-var">commitScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-732"></span><span>    </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Commit.validatorScript</span></span><span>
</span><span id="line-733"></span><span>  </span><span id="local-6989586621680313652"><span class="annot"><span class="annottext">commitRedeemer :: HashableScriptData
</span><a href="#local-6989586621680313652"><span class="hs-identifier hs-var hs-var">commitRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-734"></span><span>    </span><span class="annot"><span class="annottext">Redeemer -&gt; HashableScriptData
forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RedeemerType -&gt; Redeemer
</span><span class="hs-identifier hs-var">Commit.redeemer</span></span><span> </span><span class="annot"><span class="annottext">RedeemerType
</span><span class="hs-identifier hs-var">Commit.ViaAbort</span></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span>  </span><span id="local-6989586621680313635"><span class="annot"><span class="annottext">reimbursedOutputs :: [TxOut CtxTx]
</span><a href="#local-6989586621680313635"><span class="hs-identifier hs-var hs-var">reimbursedOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; TxOut CtxTx)
-&gt; ((TxIn, TxOut CtxUTxO) -&gt; TxOut CtxUTxO)
-&gt; (TxIn, TxOut CtxUTxO)
-&gt; TxOut CtxTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxOut CtxUTxO
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO) -&gt; TxOut CtxTx)
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; [TxOut CtxTx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; [(TxIn, TxOut CtxUTxO)]
forall out. UTxO' out -&gt; [(TxIn, out)]
</span><span class="hs-identifier hs-var">UTxO.pairs</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313619"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span class="annot"><span class="hs-comment">-- * Observe Hydra Head transactions</span></span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span class="annot"><span class="hs-comment">-- | Generalised type for arbitrary Head observations on-chain.</span></span><span>
</span><span id="line-741"></span><span class="hs-keyword">data</span><span> </span><span id="HeadObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#HeadObservation"><span class="hs-identifier hs-var">HeadObservation</span></a></span></span><span>
</span><span id="line-742"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoHeadTx"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NoHeadTx"><span class="hs-identifier hs-var">NoHeadTx</span></a></span></span><span>
</span><span id="line-743"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Init"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Init"><span class="hs-identifier hs-var">Init</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-type">InitObservation</span></a></span><span>
</span><span id="line-744"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Abort"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Abort"><span class="hs-identifier hs-var">Abort</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-type">AbortObservation</span></a></span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Commit"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Commit"><span class="hs-identifier hs-var">Commit</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-type">CommitObservation</span></a></span><span>
</span><span id="line-746"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CollectCom"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectCom"><span class="hs-identifier hs-var">CollectCom</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-type">CollectComObservation</span></a></span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Close"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Close"><span class="hs-identifier hs-var">Close</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-type">CloseObservation</span></a></span><span>
</span><span id="line-748"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Contest"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Contest"><span class="hs-identifier hs-var">Contest</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-type">ContestObservation</span></a></span><span>
</span><span id="line-749"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Fanout"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-type">FanoutObservation</span></a></span><span>
</span><span id="line-750"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313665"><span id="local-6989586621680313681"><span class="annot"><span class="annottext">HeadObservation -&gt; HeadObservation -&gt; Bool
(HeadObservation -&gt; HeadObservation -&gt; Bool)
-&gt; (HeadObservation -&gt; HeadObservation -&gt; Bool)
-&gt; Eq HeadObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: HeadObservation -&gt; HeadObservation -&gt; Bool
== :: HeadObservation -&gt; HeadObservation -&gt; Bool
$c/= :: HeadObservation -&gt; HeadObservation -&gt; Bool
/= :: HeadObservation -&gt; HeadObservation -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313685"><span id="local-6989586621680313708"><span id="local-6989586621680313712"><span class="annot"><span class="annottext">Int -&gt; HeadObservation -&gt; ShowS
[HeadObservation] -&gt; ShowS
HeadObservation -&gt; String
(Int -&gt; HeadObservation -&gt; ShowS)
-&gt; (HeadObservation -&gt; String)
-&gt; ([HeadObservation] -&gt; ShowS)
-&gt; Show HeadObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; HeadObservation -&gt; ShowS
showsPrec :: Int -&gt; HeadObservation -&gt; ShowS
$cshow :: HeadObservation -&gt; String
show :: HeadObservation -&gt; String
$cshowList :: [HeadObservation] -&gt; ShowS
showList :: [HeadObservation] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313715"><span id="local-6989586621680313717"><span class="annot"><span class="annottext">(forall x. HeadObservation -&gt; Rep HeadObservation x)
-&gt; (forall x. Rep HeadObservation x -&gt; HeadObservation)
-&gt; Generic HeadObservation
forall x. Rep HeadObservation x -&gt; HeadObservation
forall x. HeadObservation -&gt; Rep HeadObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. HeadObservation -&gt; Rep HeadObservation x
from :: forall x. HeadObservation -&gt; Rep HeadObservation x
$cto :: forall x. Rep HeadObservation x -&gt; HeadObservation
to :: forall x. Rep HeadObservation x -&gt; HeadObservation
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680313721"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#HeadObservation"><span class="hs-identifier hs-type">HeadObservation</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-753"></span><span>  </span><span id="local-6989586621680313844"><span class="annot"><span class="annottext">arbitrary :: Gen HeadObservation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen HeadObservation
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span class="annot"><span class="hs-comment">-- | Observe any Hydra head transaction.</span></span><span>
</span><span id="line-756"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeHeadTx"><span class="hs-identifier hs-type">observeHeadTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#HeadObservation"><span class="hs-identifier hs-type">HeadObservation</span></a></span><span>
</span><span id="line-757"></span><span id="observeHeadTx"><span class="annot"><span class="annottext">observeHeadTx :: NetworkId -&gt; UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeHeadTx"><span class="hs-identifier hs-var hs-var">observeHeadTx</span></a></span></span><span> </span><span id="local-6989586621680313846"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680313846"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680313847"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313847"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680313848"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680313848"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-758"></span><span>  </span><span class="annot"><span class="annottext">HeadObservation -&gt; Maybe HeadObservation -&gt; HeadObservation
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#NoHeadTx"><span class="hs-identifier hs-var">NoHeadTx</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe HeadObservation -&gt; HeadObservation)
-&gt; Maybe HeadObservation -&gt; HeadObservation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-759"></span><span>    </span><span class="annot"><span class="annottext">(NotAnInitReason -&gt; Maybe HeadObservation)
-&gt; (InitObservation -&gt; Maybe HeadObservation)
-&gt; Either NotAnInitReason InitObservation
-&gt; Maybe HeadObservation
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe HeadObservation -&gt; NotAnInitReason -&gt; Maybe HeadObservation
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HeadObservation
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeadObservation -&gt; Maybe HeadObservation
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(HeadObservation -&gt; Maybe HeadObservation)
-&gt; (InitObservation -&gt; HeadObservation)
-&gt; InitObservation
-&gt; Maybe HeadObservation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InitObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Init"><span class="hs-identifier hs-var">Init</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; Either NotAnInitReason InitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeInitTx"><span class="hs-identifier hs-var">observeInitTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680313848"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AbortObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Abort"><span class="hs-identifier hs-var">Abort</span></a></span><span> </span><span class="annot"><span class="annottext">(AbortObservation -&gt; HeadObservation)
-&gt; Maybe AbortObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe AbortObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeAbortTx"><span class="hs-identifier hs-var">observeAbortTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313847"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680313848"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-761"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CommitObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Commit"><span class="hs-identifier hs-var">Commit</span></a></span><span> </span><span class="annot"><span class="annottext">(CommitObservation -&gt; HeadObservation)
-&gt; Maybe CommitObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe CommitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCommitTx"><span class="hs-identifier hs-var">observeCommitTx</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680313846"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313847"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680313848"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-762"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CollectComObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#CollectCom"><span class="hs-identifier hs-var">CollectCom</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectComObservation -&gt; HeadObservation)
-&gt; Maybe CollectComObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe CollectComObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCollectComTx"><span class="hs-identifier hs-var">observeCollectComTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313847"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680313848"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-763"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CloseObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Close"><span class="hs-identifier hs-var">Close</span></a></span><span> </span><span class="annot"><span class="annottext">(CloseObservation -&gt; HeadObservation)
-&gt; Maybe CloseObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe CloseObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCloseTx"><span class="hs-identifier hs-var">observeCloseTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313847"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680313848"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-764"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ContestObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Contest"><span class="hs-identifier hs-var">Contest</span></a></span><span> </span><span class="annot"><span class="annottext">(ContestObservation -&gt; HeadObservation)
-&gt; Maybe ContestObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe ContestObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeContestTx"><span class="hs-identifier hs-var">observeContestTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313847"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680313848"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-765"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FanoutObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span><span> </span><span class="annot"><span class="annottext">(FanoutObservation -&gt; HeadObservation)
-&gt; Maybe FanoutObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe FanoutObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeFanoutTx"><span class="hs-identifier hs-var">observeFanoutTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680313847"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680313848"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="annot"><span class="hs-comment">-- | Data which can be observed from an `initTx`.</span></span><span>
</span><span id="line-768"></span><span class="hs-keyword">data</span><span> </span><span id="InitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-var">InitObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-var">InitObservation</span></a></span></span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AinitialThreadUTxO%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialThreadUTxO%3AInitObservation"><span class="hs-identifier hs-var hs-var">initialThreadUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Ainitials%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; [(TxIn, TxOut CtxUTxO)]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Ainitials%3AInitObservation"><span class="hs-identifier hs-var hs-var">initials</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AInitObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- XXX: This is cardano-specific, while headId, parties and</span><span>
</span><span id="line-773"></span><span>    </span><span class="hs-comment">-- contestationPeriod are already generic here. Check which is more</span><span>
</span><span id="line-774"></span><span>    </span><span class="hs-comment">-- convenient and consistent!</span><span>
</span><span id="line-775"></span><span>    </span><span id="%24sel%3AseedTxIn%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; TxIn
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AseedTxIn%3AInitObservation"><span class="hs-identifier hs-var hs-var">seedTxIn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span>
</span><span id="line-776"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcontestationPeriod%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestationPeriod%3AInitObservation"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.ContestationPeriod.html#ContestationPeriod"><span class="hs-identifier hs-type">ContestationPeriod</span></a></span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aparties%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparties%3AInitObservation"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- XXX: Improve naming</span><span>
</span><span id="line-779"></span><span>    </span><span id="%24sel%3Aparticipants%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; [OnChainId]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparticipants%3AInitObservation"><span class="hs-identifier hs-var hs-var">participants</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.OnChainId.html#OnChainId"><span class="hs-identifier hs-type">OnChainId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-780"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-781"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680313868"><span id="local-6989586621680313883"><span id="local-6989586621680313886"><span class="annot"><span class="annottext">Int -&gt; InitObservation -&gt; ShowS
[InitObservation] -&gt; ShowS
InitObservation -&gt; String
(Int -&gt; InitObservation -&gt; ShowS)
-&gt; (InitObservation -&gt; String)
-&gt; ([InitObservation] -&gt; ShowS)
-&gt; Show InitObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; InitObservation -&gt; ShowS
showsPrec :: Int -&gt; InitObservation -&gt; ShowS
$cshow :: InitObservation -&gt; String
show :: InitObservation -&gt; String
$cshowList :: [InitObservation] -&gt; ShowS
showList :: [InitObservation] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313891"><span id="local-6989586621680313906"><span class="annot"><span class="annottext">InitObservation -&gt; InitObservation -&gt; Bool
(InitObservation -&gt; InitObservation -&gt; Bool)
-&gt; (InitObservation -&gt; InitObservation -&gt; Bool)
-&gt; Eq InitObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: InitObservation -&gt; InitObservation -&gt; Bool
== :: InitObservation -&gt; InitObservation -&gt; Bool
$c/= :: InitObservation -&gt; InitObservation -&gt; Bool
/= :: InitObservation -&gt; InitObservation -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680313911"><span id="local-6989586621680313913"><span class="annot"><span class="annottext">(forall x. InitObservation -&gt; Rep InitObservation x)
-&gt; (forall x. Rep InitObservation x -&gt; InitObservation)
-&gt; Generic InitObservation
forall x. Rep InitObservation x -&gt; InitObservation
forall x. InitObservation -&gt; Rep InitObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. InitObservation -&gt; Rep InitObservation x
from :: forall x. InitObservation -&gt; Rep InitObservation x
$cto :: forall x. Rep InitObservation x -&gt; InitObservation
to :: forall x. Rep InitObservation x -&gt; InitObservation
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680313917"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-type">InitObservation</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-784"></span><span>  </span><span id="local-6989586621680314003"><span class="annot"><span class="annottext">arbitrary :: Gen InitObservation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen InitObservation
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span class="hs-keyword">data</span><span> </span><span id="NotAnInitReason"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAnInitReason"><span class="hs-identifier hs-var">NotAnInitReason</span></a></span></span><span>
</span><span id="line-787"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoHeadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NoHeadOutput"><span class="hs-identifier hs-var">NoHeadOutput</span></a></span></span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NotAHeadDatum"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAHeadDatum"><span class="hs-identifier hs-var">NotAHeadDatum</span></a></span></span><span>
</span><span id="line-789"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoSTFound"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NoSTFound"><span class="hs-identifier hs-var">NoSTFound</span></a></span></span><span>
</span><span id="line-790"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NotAHeadPolicy"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAHeadPolicy"><span class="hs-identifier hs-var">NotAHeadPolicy</span></a></span></span><span>
</span><span id="line-791"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314009"><span id="local-6989586621680314011"><span id="local-6989586621680314015"><span class="annot"><span class="annottext">Int -&gt; NotAnInitReason -&gt; ShowS
[NotAnInitReason] -&gt; ShowS
NotAnInitReason -&gt; String
(Int -&gt; NotAnInitReason -&gt; ShowS)
-&gt; (NotAnInitReason -&gt; String)
-&gt; ([NotAnInitReason] -&gt; ShowS)
-&gt; Show NotAnInitReason
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; NotAnInitReason -&gt; ShowS
showsPrec :: Int -&gt; NotAnInitReason -&gt; ShowS
$cshow :: NotAnInitReason -&gt; String
show :: NotAnInitReason -&gt; String
$cshowList :: [NotAnInitReason] -&gt; ShowS
showList :: [NotAnInitReason] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314018"><span id="local-6989586621680314020"><span class="annot"><span class="annottext">NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
(NotAnInitReason -&gt; NotAnInitReason -&gt; Bool)
-&gt; (NotAnInitReason -&gt; NotAnInitReason -&gt; Bool)
-&gt; Eq NotAnInitReason
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
== :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
$c/= :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
/= :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314024"><span id="local-6989586621680314026"><span class="annot"><span class="annottext">(forall x. NotAnInitReason -&gt; Rep NotAnInitReason x)
-&gt; (forall x. Rep NotAnInitReason x -&gt; NotAnInitReason)
-&gt; Generic NotAnInitReason
forall x. Rep NotAnInitReason x -&gt; NotAnInitReason
forall x. NotAnInitReason -&gt; Rep NotAnInitReason x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. NotAnInitReason -&gt; Rep NotAnInitReason x
from :: forall x. NotAnInitReason -&gt; Rep NotAnInitReason x
$cto :: forall x. Rep NotAnInitReason x -&gt; NotAnInitReason
to :: forall x. Rep NotAnInitReason x -&gt; NotAnInitReason
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-792"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314029"><span id="local-6989586621680314036"><span id="local-6989586621680314039"><span id="local-6989586621680314042"><span id="local-6989586621680314045"><span class="annot"><span class="annottext">[NotAnInitReason] -&gt; Value
[NotAnInitReason] -&gt; Encoding
NotAnInitReason -&gt; Bool
NotAnInitReason -&gt; Value
NotAnInitReason -&gt; Encoding
(NotAnInitReason -&gt; Value)
-&gt; (NotAnInitReason -&gt; Encoding)
-&gt; ([NotAnInitReason] -&gt; Value)
-&gt; ([NotAnInitReason] -&gt; Encoding)
-&gt; (NotAnInitReason -&gt; Bool)
-&gt; ToJSON NotAnInitReason
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: NotAnInitReason -&gt; Value
toJSON :: NotAnInitReason -&gt; Value
$ctoEncoding :: NotAnInitReason -&gt; Encoding
toEncoding :: NotAnInitReason -&gt; Encoding
$ctoJSONList :: [NotAnInitReason] -&gt; Value
toJSONList :: [NotAnInitReason] -&gt; Value
$ctoEncodingList :: [NotAnInitReason] -&gt; Encoding
toEncodingList :: [NotAnInitReason] -&gt; Encoding
$comitField :: NotAnInitReason -&gt; Bool
omitField :: NotAnInitReason -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314157"><span id="local-6989586621680314164"><span id="local-6989586621680314167"><span class="annot"><span class="annottext">Maybe NotAnInitReason
Value -&gt; Parser [NotAnInitReason]
Value -&gt; Parser NotAnInitReason
(Value -&gt; Parser NotAnInitReason)
-&gt; (Value -&gt; Parser [NotAnInitReason])
-&gt; Maybe NotAnInitReason
-&gt; FromJSON NotAnInitReason
forall a.
(Value -&gt; Parser a)
-&gt; (Value -&gt; Parser [a]) -&gt; Maybe a -&gt; FromJSON a
$cparseJSON :: Value -&gt; Parser NotAnInitReason
parseJSON :: Value -&gt; Parser NotAnInitReason
$cparseJSONList :: Value -&gt; Parser [NotAnInitReason]
parseJSONList :: Value -&gt; Parser [NotAnInitReason]
$comittedField :: Maybe NotAnInitReason
omittedField :: Maybe NotAnInitReason
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680314258"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAnInitReason"><span class="hs-identifier hs-type">NotAnInitReason</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-795"></span><span>  </span><span id="local-6989586621680314291"><span class="annot"><span class="annottext">arbitrary :: Gen NotAnInitReason
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen NotAnInitReason
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span class="hs-comment">-- | Identify a init tx by checking the output value for holding tokens that are</span><span>
</span><span id="line-798"></span><span class="hs-comment">-- valid head tokens (checked by seed + policy).</span><span>
</span><span id="line-799"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeInitTx"><span class="hs-identifier hs-type">observeInitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-800"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-801"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAnInitReason"><span class="hs-identifier hs-type">NotAnInitReason</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-type">InitObservation</span></a></span><span>
</span><span id="line-802"></span><span id="observeInitTx"><span class="annot"><span class="annottext">observeInitTx :: Tx -&gt; Either NotAnInitReason InitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeInitTx"><span class="hs-identifier hs-var hs-var">observeInitTx</span></a></span></span><span> </span><span id="local-6989586621680314292"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314292"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-803"></span><span>  </span><span class="hs-comment">-- XXX: Lots of redundant information here</span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680314293"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680314293"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314294"><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680314294"><span class="hs-identifier hs-var">headOut</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314295"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680314295"><span class="hs-identifier hs-var">headState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-805"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason
-&gt; Maybe (Word, TxOut CtxTx, State)
-&gt; Either NotAnInitReason (Word, TxOut CtxTx, State)
forall {a} {b}. a -&gt; Maybe b -&gt; Either a b
</span><a href="#local-6989586621680314296"><span class="hs-identifier hs-var">maybeLeft</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NoHeadOutput"><span class="hs-identifier hs-var">NoHeadOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Word, TxOut CtxTx, State)
 -&gt; Either NotAnInitReason (Word, TxOut CtxTx, State))
-&gt; Maybe (Word, TxOut CtxTx, State)
-&gt; Either NotAnInitReason (Word, TxOut CtxTx, State)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-806"></span><span>      </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx) -&gt; Maybe (Word, TxOut CtxTx, State))
-&gt; [(Word, TxOut CtxTx)] -&gt; Maybe (Word, TxOut CtxTx, State)
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Maybe b) -&gt; t a -&gt; Maybe b
</span><a href="Hydra.Chain.Direct.Tx.html#findFirst"><span class="hs-identifier hs-var">findFirst</span></a></span><span> </span><span class="annot"><span class="annottext">(Word, TxOut CtxTx) -&gt; Maybe (Word, TxOut CtxTx, State)
forall {a} {t} {era}.
FromData a =&gt;
(t, TxOut CtxTx era) -&gt; Maybe (t, TxOut CtxTx era, a)
</span><a href="#local-6989586621680314298"><span class="hs-identifier hs-var">matchHeadOutput</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word, TxOut CtxTx)]
</span><a href="#local-6989586621680314299"><span class="hs-identifier hs-var">indexedOutputs</span></a></span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span>  </span><span class="hs-comment">-- check that we have a proper head</span><span>
</span><span id="line-809"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680314300"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314300"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314301"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680314301"><span class="hs-identifier hs-var">contestationPeriod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314302"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680314302"><span class="hs-identifier hs-var">onChainParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314303"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314303"><span class="hs-identifier hs-var">seedTxIn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680314295"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-810"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Initial</span></span><span> </span><span id="local-6989586621680314304"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680314304"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span id="local-6989586621680314305"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680314305"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621680314306"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680314306"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621680314307"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680314307"><span class="hs-identifier hs-var">outRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-811"></span><span>      </span><span id="local-6989586621680314308"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314308"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Maybe PolicyId
forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m PolicyId
</span><span class="hs-identifier hs-var">fromPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680314306"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PolicyId
-&gt; NotAnInitReason -&gt; Either NotAnInitReason PolicyId
forall a e. Maybe a -&gt; e -&gt; Either e a
</span><span class="hs-operator hs-var">?&gt;</span></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NotAHeadPolicy"><span class="hs-identifier hs-var">NotAHeadPolicy</span></a></span><span>
</span><span id="line-812"></span><span>      </span><span class="annot"><span class="annottext">(PolicyId, ContestationPeriod, [Party], TxIn)
-&gt; Either
     NotAnInitReason (PolicyId, ContestationPeriod, [Party], TxIn)
forall a. a -&gt; Either NotAnInitReason a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314308"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><a href="Hydra.ContestationPeriod.html#fromChain"><span class="hs-identifier hs-var">fromChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680314304"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680314305"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; TxIn
</span><span class="hs-identifier hs-var">fromPlutusTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680314307"><span class="hs-identifier hs-var">outRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>    </span><span class="annot"><span class="annottext">State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
-&gt; Either
     NotAnInitReason (PolicyId, ContestationPeriod, [Party], TxIn)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NotAHeadDatum"><span class="hs-identifier hs-var">NotAHeadDatum</span></a></span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680314312"><span class="annot"><span class="annottext">stQuantity :: Quantity
</span><a href="#local-6989586621680314312"><span class="hs-identifier hs-var hs-var">stQuantity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; AssetId -&gt; Quantity
</span><span class="hs-identifier hs-var">selectAsset</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680314294"><span class="hs-identifier hs-var">headOut</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314300"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-comment">-- check that ST is present in the head output</span><span>
</span><span id="line-818"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680314312"><span class="hs-identifier hs-var">stQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-819"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NoSTFound"><span class="hs-identifier hs-var">NoSTFound</span></a></span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>  </span><span class="hs-comment">-- check that we are using the same seed and headId matches</span><span>
</span><span id="line-822"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314300"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; PolicyId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; PolicyId
</span><span class="hs-identifier hs-var">HeadTokens.headPolicyId</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314303"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NotAHeadPolicy"><span class="hs-identifier hs-var">NotAHeadPolicy</span></a></span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span>  </span><span class="annot"><span class="annottext">InitObservation -&gt; Either NotAnInitReason InitObservation
forall a. a -&gt; Either NotAnInitReason a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(InitObservation -&gt; Either NotAnInitReason InitObservation)
-&gt; InitObservation -&gt; Either NotAnInitReason InitObservation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-826"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-type">InitObservation</span></a></span><span>
</span><span id="line-827"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:headId:InitObservation :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AInitObservation"><span class="hs-identifier hs-var">headId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-var">mkHeadId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314300"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-828"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn
$sel:seedTxIn:InitObservation :: TxIn
seedTxIn :: TxIn
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AseedTxIn%3AInitObservation"><span class="hs-identifier hs-var hs-var">seedTxIn</span></a></span><span>
</span><span id="line-829"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:initialThreadUTxO:InitObservation :: (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialThreadUTxO%3AInitObservation"><span class="hs-identifier hs-var">initialThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; Word -&gt; TxIn
forall era. Tx era -&gt; Word -&gt; TxIn
</span><span class="hs-identifier hs-var">mkTxIn</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314292"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680314293"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; TxOut CtxUTxO
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
</span><span class="hs-identifier hs-var">toCtxUTxOTxOut</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680314294"><span class="hs-identifier hs-var">headOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)]
$sel:initials:InitObservation :: [(TxIn, TxOut CtxUTxO)]
initials :: [(TxIn, TxOut CtxUTxO)]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Ainitials%3AInitObservation"><span class="hs-identifier hs-var hs-var">initials</span></a></span><span>
</span><span id="line-831"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
$sel:contestationPeriod:InitObservation :: ContestationPeriod
contestationPeriod :: ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestationPeriod%3AInitObservation"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-832"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:InitObservation :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparties%3AInitObservation"><span class="hs-identifier hs-var">parties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Maybe Party) -&gt; [Party] -&gt; [Party]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Maybe Party
forall (m :: * -&gt; *). MonadFail m =&gt; Party -&gt; m Party
</span><a href="Hydra.Party.html#partyFromChain"><span class="hs-identifier hs-var">partyFromChain</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680314302"><span class="hs-identifier hs-var">onChainParties</span></a></span><span>
</span><span id="line-833"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:participants:InitObservation :: [OnChainId]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparticipants%3AInitObservation"><span class="hs-identifier hs-var">participants</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; OnChainId
</span><a href="Hydra.Chain.Direct.Tx.html#assetNameToOnChainId"><span class="hs-identifier hs-var">assetNameToOnChainId</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; OnChainId) -&gt; [AssetName] -&gt; [OnChainId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; [AssetName]
</span><a href="#local-6989586621680314320"><span class="hs-identifier hs-var">mintedTokenNames</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314300"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-834"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-835"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-836"></span><span>  </span><span id="local-6989586621680314296"><span class="annot"><span class="annottext">maybeLeft :: a -&gt; Maybe b -&gt; Either a b
</span><a href="#local-6989586621680314296"><span class="hs-identifier hs-var hs-var">maybeLeft</span></a></span></span><span> </span><span id="local-6989586621680314321"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680314321"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either a b -&gt; (b -&gt; Either a b) -&gt; Maybe b -&gt; Either a b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either a b
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680314321"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either a b
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>  </span><span id="local-6989586621680314298"><span class="annot"><span class="annottext">matchHeadOutput :: (t, TxOut CtxTx era) -&gt; Maybe (t, TxOut CtxTx era, a)
</span><a href="#local-6989586621680314298"><span class="hs-identifier hs-var hs-var">matchHeadOutput</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314330"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680314330"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314331"><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621680314331"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-839"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript -&gt; TxOut CtxTx era -&gt; Bool
forall lang ctx era.
IsPlutusScriptLanguage lang =&gt;
PlutusScript lang -&gt; TxOut ctx era -&gt; Bool
</span><span class="hs-identifier hs-var">isScriptTxOut</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680314333"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621680314331"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-840"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680314330"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621680314331"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (t, TxOut CtxTx era, a))
-&gt; Maybe a -&gt; Maybe (t, TxOut CtxTx era, a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe a
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">(HashableScriptData -&gt; Maybe a)
-&gt; Maybe HashableScriptData -&gt; Maybe a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621680314331"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span>  </span><span id="local-6989586621680314333"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621680314333"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span>  </span><span id="local-6989586621680314299"><span class="annot"><span class="annottext">indexedOutputs :: [(Word, TxOut CtxTx)]
</span><a href="#local-6989586621680314299"><span class="hs-identifier hs-var hs-var">indexedOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word] -&gt; [TxOut CtxTx] -&gt; [(Word, TxOut CtxTx)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; [TxOut CtxTx]
forall era. Tx era -&gt; [TxOut CtxTx era]
</span><span class="hs-identifier hs-var">txOuts'</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314292"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span>  </span><span id="local-6989586621680314338"><span class="annot"><span class="annottext">initialOutputs :: [(Word, TxOut CtxTx)]
</span><a href="#local-6989586621680314338"><span class="hs-identifier hs-var hs-var">initialOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx) -&gt; Bool)
-&gt; [(Word, TxOut CtxTx)] -&gt; [(Word, TxOut CtxTx)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Bool
forall {ctx} {era}. TxOut ctx era -&gt; Bool
</span><a href="#local-6989586621680314339"><span class="hs-identifier hs-var">isInitial</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Bool)
-&gt; ((Word, TxOut CtxTx) -&gt; TxOut CtxTx)
-&gt; (Word, TxOut CtxTx)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Word, TxOut CtxTx) -&gt; TxOut CtxTx
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Word, TxOut CtxTx)]
</span><a href="#local-6989586621680314299"><span class="hs-identifier hs-var">indexedOutputs</span></a></span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span>  </span><span id="local-6989586621680314318"><span class="annot"><span class="annottext">initials :: [(TxIn, TxOut CtxUTxO)]
</span><a href="#local-6989586621680314318"><span class="hs-identifier hs-var hs-var">initials</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-849"></span><span>    </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx) -&gt; (TxIn, TxOut CtxUTxO))
-&gt; [(Word, TxOut CtxTx)] -&gt; [(TxIn, TxOut CtxUTxO)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span>
</span><span id="line-850"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Word -&gt; TxIn)
-&gt; (TxOut CtxTx -&gt; TxOut CtxUTxO)
-&gt; (Word, TxOut CtxTx)
-&gt; (TxIn, TxOut CtxUTxO)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Bifunctor.html#bimap"><span class="hs-identifier hs-var">bimap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; Word -&gt; TxIn
forall era. Tx era -&gt; Word -&gt; TxIn
</span><span class="hs-identifier hs-var">mkTxIn</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314292"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; TxOut CtxUTxO
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
</span><span class="hs-identifier hs-var">toCtxUTxOTxOut</span></span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>      </span><span class="annot"><span class="annottext">[(Word, TxOut CtxTx)]
</span><a href="#local-6989586621680314338"><span class="hs-identifier hs-var">initialOutputs</span></a></span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span>  </span><span id="local-6989586621680314339"><span class="annot"><span class="annottext">isInitial :: TxOut ctx era -&gt; Bool
</span><a href="#local-6989586621680314339"><span class="hs-identifier hs-var hs-var">isInitial</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlutusScript -&gt; TxOut ctx era -&gt; Bool
forall lang ctx era.
IsPlutusScriptLanguage lang =&gt;
PlutusScript lang -&gt; TxOut ctx era -&gt; Bool
</span><span class="hs-identifier hs-var">isScriptTxOut</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680314342"><span class="hs-identifier hs-var">initialScript</span></a></span><span>
</span><span id="line-854"></span><span>
</span><span id="line-855"></span><span>  </span><span id="local-6989586621680314342"><span class="annot"><span class="annottext">initialScript :: PlutusScript
</span><a href="#local-6989586621680314342"><span class="hs-identifier hs-var hs-var">initialScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Initial.validatorScript</span></span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span>  </span><span id="local-6989586621680314320"><span class="annot"><span class="annottext">mintedTokenNames :: PolicyId -&gt; [AssetName]
</span><a href="#local-6989586621680314320"><span class="hs-identifier hs-var hs-var">mintedTokenNames</span></a></span></span><span> </span><span id="local-6989586621680314343"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314343"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-858"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680314344"><span class="hs-identifier hs-var">assetName</span></a></span><span>
</span><span id="line-859"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetId</span></span><span> </span><span id="local-6989586621680314345"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314345"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span id="local-6989586621680314344"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680314344"><span class="hs-identifier hs-var">assetName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314346"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680314346"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; [(AssetId, Quantity)]
forall era. Tx era -&gt; [(AssetId, Quantity)]
</span><span class="hs-identifier hs-var">txMintAssets</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314292"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-860"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680314346"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span> </span><span class="hs-comment">-- NOTE: Only consider unique tokens</span><span>
</span><span id="line-861"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314345"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; PolicyId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314343"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-862"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680314344"><span class="hs-identifier hs-var">assetName</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; AssetName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span>
</span><span id="line-863"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span class="annot"><span class="hs-comment">-- | Full observation of a commit transaction.</span></span><span>
</span><span id="line-866"></span><span class="hs-keyword">data</span><span> </span><span id="CommitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-var">CommitObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CommitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-var">CommitObservation</span></a></span></span><span>
</span><span id="line-867"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcommitOutput%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcommitOutput%3ACommitObservation"><span class="hs-identifier hs-var hs-var">commitOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aparty%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; Party
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparty%3ACommitObservation"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span>
</span><span id="line-869"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Hydra participant who committed the UTxO.</span></span><span>
</span><span id="line-870"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acommitted%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; UTxO' (TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acommitted%3ACommitObservation"><span class="hs-identifier hs-var hs-var">committed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACommitObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314355"><span id="local-6989586621680314364"><span class="annot"><span class="annottext">CommitObservation -&gt; CommitObservation -&gt; Bool
(CommitObservation -&gt; CommitObservation -&gt; Bool)
-&gt; (CommitObservation -&gt; CommitObservation -&gt; Bool)
-&gt; Eq CommitObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CommitObservation -&gt; CommitObservation -&gt; Bool
== :: CommitObservation -&gt; CommitObservation -&gt; Bool
$c/= :: CommitObservation -&gt; CommitObservation -&gt; Bool
/= :: CommitObservation -&gt; CommitObservation -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314367"><span id="local-6989586621680314377"><span id="local-6989586621680314380"><span class="annot"><span class="annottext">Int -&gt; CommitObservation -&gt; ShowS
[CommitObservation] -&gt; ShowS
CommitObservation -&gt; String
(Int -&gt; CommitObservation -&gt; ShowS)
-&gt; (CommitObservation -&gt; String)
-&gt; ([CommitObservation] -&gt; ShowS)
-&gt; Show CommitObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CommitObservation -&gt; ShowS
showsPrec :: Int -&gt; CommitObservation -&gt; ShowS
$cshow :: CommitObservation -&gt; String
show :: CommitObservation -&gt; String
$cshowList :: [CommitObservation] -&gt; ShowS
showList :: [CommitObservation] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314383"><span id="local-6989586621680314385"><span class="annot"><span class="annottext">(forall x. CommitObservation -&gt; Rep CommitObservation x)
-&gt; (forall x. Rep CommitObservation x -&gt; CommitObservation)
-&gt; Generic CommitObservation
forall x. Rep CommitObservation x -&gt; CommitObservation
forall x. CommitObservation -&gt; Rep CommitObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CommitObservation -&gt; Rep CommitObservation x
from :: forall x. CommitObservation -&gt; Rep CommitObservation x
$cto :: forall x. Rep CommitObservation x -&gt; CommitObservation
to :: forall x. Rep CommitObservation x -&gt; CommitObservation
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680314389"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-type">CommitObservation</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-876"></span><span>  </span><span id="local-6989586621680314441"><span class="annot"><span class="annottext">arbitrary :: Gen CommitObservation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen CommitObservation
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span class="hs-comment">-- | Identify a commit tx by:</span><span>
</span><span id="line-879"></span><span class="hs-comment">--</span><span>
</span><span id="line-880"></span><span class="hs-comment">-- - Check that its spending from the init validator,</span><span>
</span><span id="line-881"></span><span class="hs-comment">-- - Find the outputs which pays to the commit validator,</span><span>
</span><span id="line-882"></span><span class="hs-comment">-- - Using the datum of that output, deserialize the committed output,</span><span>
</span><span id="line-883"></span><span class="hs-comment">-- - Reconstruct the committed UTxO from both values (tx input and output).</span><span>
</span><span id="line-884"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeCommitTx"><span class="hs-identifier hs-type">observeCommitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-885"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-886"></span><span>  </span><span class="hs-comment">-- | A UTxO set to lookup tx inputs. Should at least contain the input</span><span>
</span><span id="line-887"></span><span>  </span><span class="hs-comment">-- spending from &#957;Initial.</span><span>
</span><span id="line-888"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-889"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-890"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-type">CommitObservation</span></a></span><span>
</span><span id="line-891"></span><span id="observeCommitTx"><span class="annot"><span class="annottext">observeCommitTx :: NetworkId -&gt; UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe CommitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCommitTx"><span class="hs-identifier hs-var hs-var">observeCommitTx</span></a></span></span><span> </span><span id="local-6989586621680314442"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680314442"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680314443"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314443"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680314444"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314444"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-892"></span><span>  </span><span class="hs-comment">-- NOTE: Instead checking to spend from initial we could be looking at the</span><span>
</span><span id="line-893"></span><span>  </span><span class="hs-comment">-- seed:</span><span>
</span><span id="line-894"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-comment">--  - We must check that participation token in output satisfies</span><span>
</span><span id="line-896"></span><span>  </span><span class="hs-comment">--      policyId = hash(mu_head(seed))</span><span>
</span><span id="line-897"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-comment">--  - This allows us to assume (by induction) the output datum at the commit</span><span>
</span><span id="line-899"></span><span>  </span><span class="hs-comment">--    script is legit</span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-901"></span><span>  </span><span class="hs-comment">--  - Further, we need to assert / assume that only one script is spent = onle</span><span>
</span><span id="line-902"></span><span>  </span><span class="hs-comment">--    one redeemer matches the InitialRedeemer, as we do not have information</span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-comment">--    which of the inputs is spending from the initial script otherwise.</span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-905"></span><span>  </span><span class="hs-comment">--  Right now we only have the headId in the datum, so we use that in place of</span><span>
</span><span id="line-906"></span><span>  </span><span class="hs-comment">--  the seed -&gt; THIS CAN NOT BE TRUSTED.</span><span>
</span><span id="line-907"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680314445"><span class="hs-identifier hs-var">isSpendingFromInitial</span></a></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680314446"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314446"><span class="hs-identifier hs-var">commitIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314447"><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680314447"><span class="hs-identifier hs-var">commitOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AddressInEra -&gt; Tx -&gt; Maybe (TxIn, TxOut CtxTx)
forall era.
AddressInEra era -&gt; Tx era -&gt; Maybe (TxIn, TxOut CtxTx era)
</span><span class="hs-identifier hs-var">findTxOutByAddress</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621680314449"><span class="hs-identifier hs-var">commitAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314444"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-910"></span><span>  </span><span id="local-6989586621680314450"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314450"><span class="hs-identifier hs-var">dat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680314447"><span class="hs-identifier hs-var">commitOut</span></a></span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680314451"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680314451"><span class="hs-identifier hs-var">onChainParty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314452"><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621680314452"><span class="hs-identifier hs-var">onChainCommits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314453"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680314453"><span class="hs-identifier hs-var">headId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Commit.DatumType</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe DatumType
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314450"><span class="hs-identifier hs-var">dat</span></a></span><span>
</span><span id="line-912"></span><span>  </span><span id="local-6989586621680314454"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680314454"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Party -&gt; Maybe Party
forall (m :: * -&gt; *). MonadFail m =&gt; Party -&gt; m Party
</span><a href="Hydra.Party.html#partyFromChain"><span class="hs-identifier hs-var">partyFromChain</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680314451"><span class="hs-identifier hs-var">onChainParty</span></a></span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span>  </span><span class="hs-comment">-- NOTE: If we have the resolved inputs (utxo) then we could avoid putting</span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-comment">-- the commit into the datum (+ changing the hashing strategy of</span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-comment">-- collect/fanout)</span><span>
</span><span id="line-917"></span><span>  </span><span id="local-6989586621680314455"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314455"><span class="hs-identifier hs-var">committed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-918"></span><span>    </span><span id="local-6989586621680314456"><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)]
</span><a href="#local-6989586621680314456"><span class="hs-identifier hs-var">committedUTxO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Commit -&gt; Maybe (TxIn, TxOut CtxUTxO))
-&gt; [Commit] -&gt; Maybe [(TxIn, TxOut CtxUTxO)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Network -&gt; Commit -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">Commit.deserializeCommit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; Network
</span><span class="hs-identifier hs-var">networkIdToNetwork</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680314442"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621680314452"><span class="hs-identifier hs-var">onChainCommits</span></a></span><span>
</span><span id="line-919"></span><span>    </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Maybe (UTxO' (TxOut CtxUTxO))
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO' (TxOut CtxUTxO) -&gt; Maybe (UTxO' (TxOut CtxUTxO)))
-&gt; ([(TxIn, TxOut CtxUTxO)] -&gt; UTxO' (TxOut CtxUTxO))
-&gt; [(TxIn, TxOut CtxUTxO)]
-&gt; Maybe (UTxO' (TxOut CtxUTxO))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)] -&gt; UTxO' (TxOut CtxUTxO)
forall out. [(TxIn, out)] -&gt; UTxO' out
</span><span class="hs-identifier hs-var">UTxO.fromPairs</span></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO)] -&gt; Maybe (UTxO' (TxOut CtxUTxO)))
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; Maybe (UTxO' (TxOut CtxUTxO))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)]
</span><a href="#local-6989586621680314456"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span>  </span><span id="local-6989586621680314459"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314459"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Maybe PolicyId
forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m PolicyId
</span><span class="hs-identifier hs-var">fromPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680314453"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-922"></span><span>  </span><span class="annot"><span class="annottext">CommitObservation -&gt; Maybe CommitObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-923"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-type">CommitObservation</span></a></span><span>
</span><span id="line-924"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:commitOutput:CommitObservation :: (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcommitOutput%3ACommitObservation"><span class="hs-identifier hs-var">commitOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314446"><span class="hs-identifier hs-var">commitIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; TxOut CtxUTxO
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToUTxOContext f =&gt;
f CtxTx era -&gt; f CtxUTxO era
</span><span class="hs-identifier hs-var">toUTxOContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680314447"><span class="hs-identifier hs-var">commitOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Party
$sel:party:CommitObservation :: Party
party :: Party
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparty%3ACommitObservation"><span class="hs-identifier hs-var hs-var">party</span></a></span><span>
</span><span id="line-926"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
$sel:committed:CommitObservation :: UTxO' (TxOut CtxUTxO)
committed :: UTxO' (TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acommitted%3ACommitObservation"><span class="hs-identifier hs-var hs-var">committed</span></a></span><span>
</span><span id="line-927"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:CommitObservation :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACommitObservation"><span class="hs-identifier hs-var">headId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-var">mkHeadId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314459"><span class="hs-identifier hs-var">policyId</span></a></span><span>
</span><span id="line-928"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-929"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-930"></span><span>  </span><span class="annot"><a href="#local-6989586621680314445"><span class="hs-identifier hs-type">isSpendingFromInitial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-931"></span><span>  </span><span id="local-6989586621680314445"><span class="annot"><span class="annottext">isSpendingFromInitial :: Bool
</span><a href="#local-6989586621680314445"><span class="hs-identifier hs-var hs-var">isSpendingFromInitial</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-932"></span><span>    </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Bool) -&gt; UTxO' (TxOut CtxUTxO) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680314462"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314462"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; AddressInEra
forall ctx. TxOut ctx -&gt; AddressInEra
</span><span class="hs-identifier hs-var">txOutAddress</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314462"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra -&gt; AddressInEra -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621680314464"><span class="hs-identifier hs-var">initialAddress</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314443"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314444"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span>  </span><span id="local-6989586621680314464"><span class="annot"><span class="annottext">initialAddress :: AddressInEra
</span><a href="#local-6989586621680314464"><span class="hs-identifier hs-var hs-var">initialAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680314442"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314466"><span class="hs-identifier hs-var">initialScript</span></a></span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span>  </span><span id="local-6989586621680314466"><span class="annot"><span class="annottext">initialScript :: PlutusScript lang
</span><a href="#local-6989586621680314466"><span class="hs-identifier hs-var hs-var">initialScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Initial.validatorScript</span></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>  </span><span id="local-6989586621680314449"><span class="annot"><span class="annottext">commitAddress :: AddressInEra
</span><a href="#local-6989586621680314449"><span class="hs-identifier hs-var hs-var">commitAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680314442"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314467"><span class="hs-identifier hs-var">commitScript</span></a></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span>  </span><span id="local-6989586621680314467"><span class="annot"><span class="annottext">commitScript :: PlutusScript lang
</span><a href="#local-6989586621680314467"><span class="hs-identifier hs-var hs-var">commitScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Commit.validatorScript</span></span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span><span class="hs-keyword">data</span><span> </span><span id="CollectComObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-var">CollectComObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CollectComObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-var">CollectComObservation</span></a></span></span><span>
</span><span id="line-943"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AthreadOutput%3ACollectComObservation"><span class="annot"><span class="annottext">CollectComObservation -&gt; OpenThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">threadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-type">OpenThreadOutput</span></a></span><span>
</span><span id="line-944"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3ACollectComObservation"><span class="annot"><span class="annottext">CollectComObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-945"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AutxoHash%3ACollectComObservation"><span class="annot"><span class="annottext">CollectComObservation -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AutxoHash%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-947"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314473"><span id="local-6989586621680314479"><span id="local-6989586621680314482"><span class="annot"><span class="annottext">Int -&gt; CollectComObservation -&gt; ShowS
[CollectComObservation] -&gt; ShowS
CollectComObservation -&gt; String
(Int -&gt; CollectComObservation -&gt; ShowS)
-&gt; (CollectComObservation -&gt; String)
-&gt; ([CollectComObservation] -&gt; ShowS)
-&gt; Show CollectComObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CollectComObservation -&gt; ShowS
showsPrec :: Int -&gt; CollectComObservation -&gt; ShowS
$cshow :: CollectComObservation -&gt; String
show :: CollectComObservation -&gt; String
$cshowList :: [CollectComObservation] -&gt; ShowS
showList :: [CollectComObservation] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314485"><span id="local-6989586621680314490"><span class="annot"><span class="annottext">CollectComObservation -&gt; CollectComObservation -&gt; Bool
(CollectComObservation -&gt; CollectComObservation -&gt; Bool)
-&gt; (CollectComObservation -&gt; CollectComObservation -&gt; Bool)
-&gt; Eq CollectComObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
== :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
$c/= :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
/= :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314493"><span id="local-6989586621680314495"><span class="annot"><span class="annottext">(forall x. CollectComObservation -&gt; Rep CollectComObservation x)
-&gt; (forall x. Rep CollectComObservation x -&gt; CollectComObservation)
-&gt; Generic CollectComObservation
forall x. Rep CollectComObservation x -&gt; CollectComObservation
forall x. CollectComObservation -&gt; Rep CollectComObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CollectComObservation -&gt; Rep CollectComObservation x
from :: forall x. CollectComObservation -&gt; Rep CollectComObservation x
$cto :: forall x. Rep CollectComObservation x -&gt; CollectComObservation
to :: forall x. Rep CollectComObservation x -&gt; CollectComObservation
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680314499"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-type">CollectComObservation</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-950"></span><span>  </span><span id="local-6989586621680314538"><span class="annot"><span class="annottext">arbitrary :: Gen CollectComObservation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen CollectComObservation
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span class="hs-comment">-- | Identify a collectCom tx by lookup up the input spending the Head output</span><span>
</span><span id="line-953"></span><span class="hs-comment">-- and decoding its redeemer.</span><span>
</span><span id="line-954"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeCollectComTx"><span class="hs-identifier hs-type">observeCollectComTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-955"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-956"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-957"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-958"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-type">CollectComObservation</span></a></span><span>
</span><span id="line-959"></span><span id="observeCollectComTx"><span class="annot"><span class="annottext">observeCollectComTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe CollectComObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCollectComTx"><span class="hs-identifier hs-var hs-var">observeCollectComTx</span></a></span></span><span> </span><span id="local-6989586621680314539"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314539"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680314540"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314540"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-960"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680314541"><span class="annot"><span class="annottext">inputUTxO :: UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314541"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314539"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314540"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-961"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680314542"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314542"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314543"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314543"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314541"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314545"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-962"></span><span>  </span><span id="local-6989586621680314546"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680314546"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314540"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314542"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-963"></span><span>  </span><span id="local-6989586621680314548"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314548"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314543"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-964"></span><span>  </span><span id="local-6989586621680314549"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680314549"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314548"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-965"></span><span>  </span><span id="local-6989586621680314550"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680314550"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314543"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-966"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680314549"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680314546"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-967"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Initial</span></span><span class="hs-special">{</span><span id="local-6989586621680314552"><span class="annot"><span class="annottext">[Party]
$sel:parties:Initial :: State -&gt; [Party]
parties :: [Party]
</span><span class="hs-identifier hs-var hs-var">parties</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314553"><span class="annot"><span class="annottext">ContestationPeriod
$sel:contestationPeriod:Initial :: State -&gt; ContestationPeriod
contestationPeriod :: ContestationPeriod
</span><span class="hs-identifier hs-var hs-var">contestationPeriod</span></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.CollectCom</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-968"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680314554"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314554"><span class="hs-identifier hs-var">newHeadInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314555"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314555"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314540"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314545"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-969"></span><span>      </span><span id="local-6989586621680314557"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314557"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314555"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-970"></span><span>      </span><span id="local-6989586621680314558"><span class="annot"><span class="annottext">UTxOHash
</span><a href="#local-6989586621680314558"><span class="hs-identifier hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; UTxOHash) -&gt; Maybe ByteString -&gt; Maybe UTxOHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe ByteString
</span><a href="#local-6989586621680314559"><span class="hs-identifier hs-var">decodeUtxoHash</span></a></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314557"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span>
</span><span id="line-971"></span><span>      </span><span class="annot"><span class="annottext">CollectComObservation -&gt; Maybe CollectComObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-972"></span><span>        </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-type">CollectComObservation</span></a></span><span>
</span><span id="line-973"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:threadOutput:CollectComObservation :: OpenThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACollectComObservation"><span class="hs-identifier hs-var">threadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-974"></span><span>              </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-type">OpenThreadOutput</span></a></span><span>
</span><span id="line-975"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:openThreadUTxO:OpenThreadOutput :: (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenThreadUTxO%3AOpenThreadOutput"><span class="hs-identifier hs-var">openThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314554"><span class="hs-identifier hs-var">newHeadInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314555"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-976"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:openParties:OpenThreadOutput :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenParties%3AOpenThreadOutput"><span class="hs-identifier hs-var">openParties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680314552"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-977"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:openContestationPeriod:OpenThreadOutput :: ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenContestationPeriod%3AOpenThreadOutput"><span class="hs-identifier hs-var">openContestationPeriod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680314553"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-978"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-979"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeadId
$sel:headId:CollectComObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-980"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxOHash
$sel:utxoHash:CollectComObservation :: UTxOHash
utxoHash :: UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AutxoHash%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span><span>
</span><span id="line-981"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-982"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe CollectComObservation
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-983"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-984"></span><span>  </span><span id="local-6989586621680314545"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621680314545"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-985"></span><span>  </span><span id="local-6989586621680314559"><span class="annot"><span class="annottext">decodeUtxoHash :: HashableScriptData -&gt; Maybe ByteString
</span><a href="#local-6989586621680314559"><span class="hs-identifier hs-var hs-var">decodeUtxoHash</span></a></span></span><span> </span><span id="local-6989586621680314562"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314562"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-986"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314562"><span class="hs-identifier hs-var">datum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-987"></span><span>      </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span class="hs-special">{</span><span id="local-6989586621680314563"><span class="annot"><span class="annottext">BuiltinByteString
$sel:utxoHash:Initial :: State -&gt; BuiltinByteString
utxoHash :: BuiltinByteString
</span><span class="hs-identifier hs-var hs-var">utxoHash</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe ByteString) -&gt; ByteString -&gt; Maybe ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ByteString
forall arep a. FromBuiltin arep a =&gt; arep -&gt; a
</span><span class="hs-identifier hs-var">fromBuiltin</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621680314563"><span class="hs-identifier hs-var">utxoHash</span></a></span><span>
</span><span id="line-988"></span><span>      </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span class="hs-keyword">data</span><span> </span><span id="CloseObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-var">CloseObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CloseObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-var">CloseObservation</span></a></span></span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AthreadOutput%3ACloseObservation"><span class="annot"><span class="annottext">CloseObservation -&gt; ClosedThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACloseObservation"><span class="hs-identifier hs-var hs-var">threadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-type">ClosedThreadOutput</span></a></span><span>
</span><span id="line-992"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3ACloseObservation"><span class="annot"><span class="annottext">CloseObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACloseObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-993"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AsnapshotNumber%3ACloseObservation"><span class="annot"><span class="annottext">CloseObservation -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseObservation"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#SnapshotNumber"><span class="hs-identifier hs-type">SnapshotNumber</span></a></span><span>
</span><span id="line-994"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-995"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314569"><span id="local-6989586621680314576"><span id="local-6989586621680314579"><span class="annot"><span class="annottext">Int -&gt; CloseObservation -&gt; ShowS
[CloseObservation] -&gt; ShowS
CloseObservation -&gt; String
(Int -&gt; CloseObservation -&gt; ShowS)
-&gt; (CloseObservation -&gt; String)
-&gt; ([CloseObservation] -&gt; ShowS)
-&gt; Show CloseObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CloseObservation -&gt; ShowS
showsPrec :: Int -&gt; CloseObservation -&gt; ShowS
$cshow :: CloseObservation -&gt; String
show :: CloseObservation -&gt; String
$cshowList :: [CloseObservation] -&gt; ShowS
showList :: [CloseObservation] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314582"><span id="local-6989586621680314588"><span class="annot"><span class="annottext">CloseObservation -&gt; CloseObservation -&gt; Bool
(CloseObservation -&gt; CloseObservation -&gt; Bool)
-&gt; (CloseObservation -&gt; CloseObservation -&gt; Bool)
-&gt; Eq CloseObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CloseObservation -&gt; CloseObservation -&gt; Bool
== :: CloseObservation -&gt; CloseObservation -&gt; Bool
$c/= :: CloseObservation -&gt; CloseObservation -&gt; Bool
/= :: CloseObservation -&gt; CloseObservation -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314591"><span id="local-6989586621680314593"><span class="annot"><span class="annottext">(forall x. CloseObservation -&gt; Rep CloseObservation x)
-&gt; (forall x. Rep CloseObservation x -&gt; CloseObservation)
-&gt; Generic CloseObservation
forall x. Rep CloseObservation x -&gt; CloseObservation
forall x. CloseObservation -&gt; Rep CloseObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CloseObservation -&gt; Rep CloseObservation x
from :: forall x. CloseObservation -&gt; Rep CloseObservation x
$cto :: forall x. Rep CloseObservation x -&gt; CloseObservation
to :: forall x. Rep CloseObservation x -&gt; CloseObservation
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680314597"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-type">CloseObservation</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-998"></span><span>  </span><span id="local-6989586621680314637"><span class="annot"><span class="annottext">arbitrary :: Gen CloseObservation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen CloseObservation
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span class="hs-comment">-- | Identify a close tx by lookup up the input spending the Head output and</span><span>
</span><span id="line-1001"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-1002"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeCloseTx"><span class="hs-identifier hs-type">observeCloseTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1003"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-1004"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1005"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1006"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-type">CloseObservation</span></a></span><span>
</span><span id="line-1007"></span><span id="observeCloseTx"><span class="annot"><span class="annottext">observeCloseTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe CloseObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCloseTx"><span class="hs-identifier hs-var hs-var">observeCloseTx</span></a></span></span><span> </span><span id="local-6989586621680314638"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314638"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680314639"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314639"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680314640"><span class="annot"><span class="annottext">inputUTxO :: UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314640"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314638"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314639"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1009"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680314641"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314641"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314642"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314642"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314640"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314643"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-1010"></span><span>  </span><span id="local-6989586621680314644"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680314644"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314639"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314641"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-1011"></span><span>  </span><span id="local-6989586621680314645"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314645"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314642"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-1012"></span><span>  </span><span id="local-6989586621680314646"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680314646"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314645"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-1013"></span><span>  </span><span id="local-6989586621680314647"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680314647"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314642"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680314646"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680314644"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1015"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span class="hs-special">{</span><span id="local-6989586621680314648"><span class="annot"><span class="annottext">[Party]
$sel:parties:Initial :: State -&gt; [Party]
parties :: [Party]
</span><span class="hs-identifier hs-var hs-var">parties</span></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Close</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1016"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680314649"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314649"><span class="hs-identifier hs-var">newHeadInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314650"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314650"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314639"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314643"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-1017"></span><span>      </span><span id="local-6989586621680314651"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314651"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314650"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-1018"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680314652"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680314652"><span class="hs-identifier hs-var">closeContestationDeadline</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314653"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680314653"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314651"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1019"></span><span>        </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span class="hs-special">{</span><span id="local-6989586621680314654"><span class="annot"><span class="annottext">POSIXTime
$sel:contestationDeadline:Initial :: State -&gt; POSIXTime
contestationDeadline :: POSIXTime
</span><span class="hs-identifier hs-var hs-var">contestationDeadline</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314655"><span class="annot"><span class="annottext">Integer
$sel:snapshotNumber:Initial :: State -&gt; Integer
snapshotNumber :: Integer
</span><span class="hs-identifier hs-var hs-var">snapshotNumber</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(POSIXTime, Integer) -&gt; Maybe (POSIXTime, Integer)
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680314654"><span class="hs-identifier hs-var">contestationDeadline</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680314655"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span>        </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (POSIXTime, Integer)
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1021"></span><span>      </span><span class="annot"><span class="annottext">CloseObservation -&gt; Maybe CloseObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-1022"></span><span>        </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-type">CloseObservation</span></a></span><span>
</span><span id="line-1023"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:threadOutput:CloseObservation :: ClosedThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACloseObservation"><span class="hs-identifier hs-var">threadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1024"></span><span>              </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-type">ClosedThreadOutput</span></a></span><span>
</span><span id="line-1025"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:closedThreadUTxO:ClosedThreadOutput :: (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedThreadUTxO%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314649"><span class="hs-identifier hs-var">newHeadInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314650"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedParties:ClosedThreadOutput :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedParties%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedParties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680314648"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-1027"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedContestationDeadline:ClosedThreadOutput :: POSIXTime
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContestationDeadline%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedContestationDeadline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680314652"><span class="hs-identifier hs-var">closeContestationDeadline</span></a></span><span>
</span><span id="line-1028"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedContesters:ClosedThreadOutput :: [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContesters%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedContesters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1029"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1030"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeadId
$sel:headId:CloseObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACloseObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-1031"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:snapshotNumber:CloseObservation :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseObservation"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SnapshotNumber
</span><a href="Hydra.Snapshot.html#fromChainSnapshot"><span class="hs-identifier hs-var">fromChainSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680314653"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span><span>
</span><span id="line-1032"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1033"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe CloseObservation
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1034"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1035"></span><span>  </span><span id="local-6989586621680314643"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621680314643"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span class="hs-keyword">data</span><span> </span><span id="ContestObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-var">ContestObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ContestObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-var">ContestObservation</span></a></span></span><span>
</span><span id="line-1038"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcontestedThreadOutput%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestedThreadOutput%3AContestObservation"><span class="hs-identifier hs-var hs-var">contestedThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-1039"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AContestObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-1040"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AsnapshotNumber%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3AContestObservation"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#SnapshotNumber"><span class="hs-identifier hs-type">SnapshotNumber</span></a></span><span>
</span><span id="line-1041"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcontestationDeadline%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; UTCTime
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestationDeadline%3AContestObservation"><span class="hs-identifier hs-var hs-var">contestationDeadline</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-1042"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acontesters%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acontesters%3AContestObservation"><span class="hs-identifier hs-var hs-var">contesters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Plutus.PubKeyHash</span></span><span class="hs-special">]</span><span>
</span><span id="line-1043"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1044"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314663"><span id="local-6989586621680314675"><span id="local-6989586621680314678"><span class="annot"><span class="annottext">Int -&gt; ContestObservation -&gt; ShowS
[ContestObservation] -&gt; ShowS
ContestObservation -&gt; String
(Int -&gt; ContestObservation -&gt; ShowS)
-&gt; (ContestObservation -&gt; String)
-&gt; ([ContestObservation] -&gt; ShowS)
-&gt; Show ContestObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ContestObservation -&gt; ShowS
showsPrec :: Int -&gt; ContestObservation -&gt; ShowS
$cshow :: ContestObservation -&gt; String
show :: ContestObservation -&gt; String
$cshowList :: [ContestObservation] -&gt; ShowS
showList :: [ContestObservation] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314681"><span id="local-6989586621680314692"><span class="annot"><span class="annottext">ContestObservation -&gt; ContestObservation -&gt; Bool
(ContestObservation -&gt; ContestObservation -&gt; Bool)
-&gt; (ContestObservation -&gt; ContestObservation -&gt; Bool)
-&gt; Eq ContestObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ContestObservation -&gt; ContestObservation -&gt; Bool
== :: ContestObservation -&gt; ContestObservation -&gt; Bool
$c/= :: ContestObservation -&gt; ContestObservation -&gt; Bool
/= :: ContestObservation -&gt; ContestObservation -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314695"><span id="local-6989586621680314697"><span class="annot"><span class="annottext">(forall x. ContestObservation -&gt; Rep ContestObservation x)
-&gt; (forall x. Rep ContestObservation x -&gt; ContestObservation)
-&gt; Generic ContestObservation
forall x. Rep ContestObservation x -&gt; ContestObservation
forall x. ContestObservation -&gt; Rep ContestObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. ContestObservation -&gt; Rep ContestObservation x
from :: forall x. ContestObservation -&gt; Rep ContestObservation x
$cto :: forall x. Rep ContestObservation x -&gt; ContestObservation
to :: forall x. Rep ContestObservation x -&gt; ContestObservation
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>
</span><span id="line-1046"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680314701"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-type">ContestObservation</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1047"></span><span>  </span><span id="local-6989586621680314764"><span class="annot"><span class="annottext">arbitrary :: Gen ContestObservation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen ContestObservation
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span class="hs-comment">-- | Identify a close tx by lookup up the input spending the Head output and</span><span>
</span><span id="line-1050"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-1051"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeContestTx"><span class="hs-identifier hs-type">observeContestTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1052"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-1053"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1054"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1055"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-type">ContestObservation</span></a></span><span>
</span><span id="line-1056"></span><span id="observeContestTx"><span class="annot"><span class="annottext">observeContestTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe ContestObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeContestTx"><span class="hs-identifier hs-var hs-var">observeContestTx</span></a></span></span><span> </span><span id="local-6989586621680314765"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314765"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680314766"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314766"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1057"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680314767"><span class="annot"><span class="annottext">inputUTxO :: UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314767"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314765"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314766"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1058"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680314768"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314768"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314769"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314769"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314767"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314770"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-1059"></span><span>  </span><span id="local-6989586621680314771"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680314771"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314766"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314768"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-1060"></span><span>  </span><span id="local-6989586621680314772"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314772"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314769"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-1061"></span><span>  </span><span id="local-6989586621680314773"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680314773"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314772"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-1062"></span><span>  </span><span id="local-6989586621680314774"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680314774"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314769"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-1063"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680314773"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680314771"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1064"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Contest</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1065"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680314775"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314775"><span class="hs-identifier hs-var">newHeadInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314776"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314776"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314766"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314770"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-1066"></span><span>      </span><span id="local-6989586621680314777"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314777"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314776"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-1067"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314778"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680314778"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314779"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680314779"><span class="hs-identifier hs-var">contestationDeadline</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314780"><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621680314780"><span class="hs-identifier hs-var">contesters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; (Integer, POSIXTime, [PubKeyHash])
</span><a href="#local-6989586621680314781"><span class="hs-identifier hs-var">decodeDatum</span></a></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314777"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span>
</span><span id="line-1068"></span><span>      </span><span class="annot"><span class="annottext">ContestObservation -&gt; Maybe ContestObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-1069"></span><span>        </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-type">ContestObservation</span></a></span><span>
</span><span id="line-1070"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:contestedThreadOutput:ContestObservation :: (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestedThreadOutput%3AContestObservation"><span class="hs-identifier hs-var">contestedThreadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314775"><span class="hs-identifier hs-var">newHeadInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314776"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1071"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeadId
$sel:headId:ContestObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AContestObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-1072"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:snapshotNumber:ContestObservation :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3AContestObservation"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SnapshotNumber
</span><a href="Hydra.Snapshot.html#fromChainSnapshot"><span class="hs-identifier hs-var">fromChainSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680314778"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span><span>
</span><span id="line-1073"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationDeadline:ContestObservation :: UTCTime
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestationDeadline%3AContestObservation"><span class="hs-identifier hs-var">contestationDeadline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">posixToUTCTime</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680314779"><span class="hs-identifier hs-var">contestationDeadline</span></a></span><span>
</span><span id="line-1074"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
$sel:contesters:ContestObservation :: [PubKeyHash]
contesters :: [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acontesters%3AContestObservation"><span class="hs-identifier hs-var hs-var">contesters</span></a></span><span>
</span><span id="line-1075"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1076"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ContestObservation
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1077"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1078"></span><span>  </span><span id="local-6989586621680314770"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621680314770"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-1079"></span><span>
</span><span id="line-1080"></span><span>  </span><span id="local-6989586621680314781"><span class="annot"><span class="annottext">decodeDatum :: HashableScriptData -&gt; (Integer, POSIXTime, [PubKeyHash])
</span><a href="#local-6989586621680314781"><span class="hs-identifier hs-var hs-var">decodeDatum</span></a></span></span><span> </span><span id="local-6989586621680314790"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314790"><span class="hs-identifier hs-var">headDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1081"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680314790"><span class="hs-identifier hs-var">headDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1082"></span><span>      </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span class="hs-special">{</span><span id="local-6989586621680314791"><span class="annot"><span class="annottext">Integer
$sel:snapshotNumber:Initial :: State -&gt; Integer
snapshotNumber :: Integer
</span><span class="hs-identifier hs-var hs-var">snapshotNumber</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314792"><span class="annot"><span class="annottext">POSIXTime
$sel:contestationDeadline:Initial :: State -&gt; POSIXTime
contestationDeadline :: POSIXTime
</span><span class="hs-identifier hs-var hs-var">contestationDeadline</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314793"><span class="annot"><span class="annottext">[PubKeyHash]
$sel:contesters:Initial :: State -&gt; [PubKeyHash]
contesters :: [PubKeyHash]
</span><span class="hs-identifier hs-var hs-var">contesters</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680314791"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680314792"><span class="hs-identifier hs-var">contestationDeadline</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621680314793"><span class="hs-identifier hs-var">contesters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1083"></span><span>      </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Integer, POSIXTime, [PubKeyHash])
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;wrong state in output datum&quot;</span></span><span>
</span><span id="line-1084"></span><span>
</span><span id="line-1085"></span><span class="hs-keyword">newtype</span><span> </span><span id="FanoutObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-var">FanoutObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FanoutObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-var">FanoutObservation</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AheadId%3AFanoutObservation"><span class="annot"><span class="annottext">FanoutObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AFanoutObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314798"><span id="local-6989586621680314801"><span class="annot"><span class="annottext">FanoutObservation -&gt; FanoutObservation -&gt; Bool
(FanoutObservation -&gt; FanoutObservation -&gt; Bool)
-&gt; (FanoutObservation -&gt; FanoutObservation -&gt; Bool)
-&gt; Eq FanoutObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: FanoutObservation -&gt; FanoutObservation -&gt; Bool
== :: FanoutObservation -&gt; FanoutObservation -&gt; Bool
$c/= :: FanoutObservation -&gt; FanoutObservation -&gt; Bool
/= :: FanoutObservation -&gt; FanoutObservation -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314804"><span id="local-6989586621680314808"><span id="local-6989586621680314811"><span class="annot"><span class="annottext">Int -&gt; FanoutObservation -&gt; ShowS
[FanoutObservation] -&gt; ShowS
FanoutObservation -&gt; String
(Int -&gt; FanoutObservation -&gt; ShowS)
-&gt; (FanoutObservation -&gt; String)
-&gt; ([FanoutObservation] -&gt; ShowS)
-&gt; Show FanoutObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; FanoutObservation -&gt; ShowS
showsPrec :: Int -&gt; FanoutObservation -&gt; ShowS
$cshow :: FanoutObservation -&gt; String
show :: FanoutObservation -&gt; String
$cshowList :: [FanoutObservation] -&gt; ShowS
showList :: [FanoutObservation] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314814"><span id="local-6989586621680314816"><span class="annot"><span class="annottext">(forall x. FanoutObservation -&gt; Rep FanoutObservation x)
-&gt; (forall x. Rep FanoutObservation x -&gt; FanoutObservation)
-&gt; Generic FanoutObservation
forall x. Rep FanoutObservation x -&gt; FanoutObservation
forall x. FanoutObservation -&gt; Rep FanoutObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. FanoutObservation -&gt; Rep FanoutObservation x
from :: forall x. FanoutObservation -&gt; Rep FanoutObservation x
$cto :: forall x. Rep FanoutObservation x -&gt; FanoutObservation
to :: forall x. Rep FanoutObservation x -&gt; FanoutObservation
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680314820"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-type">FanoutObservation</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1088"></span><span>  </span><span id="local-6989586621680314839"><span class="annot"><span class="annottext">arbitrary :: Gen FanoutObservation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen FanoutObservation
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span class="hs-comment">-- | Identify a fanout tx by lookup up the input spending the Head output and</span><span>
</span><span id="line-1091"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-1092"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeFanoutTx"><span class="hs-identifier hs-type">observeFanoutTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1093"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-1094"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1095"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1096"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-type">FanoutObservation</span></a></span><span>
</span><span id="line-1097"></span><span id="observeFanoutTx"><span class="annot"><span class="annottext">observeFanoutTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe FanoutObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeFanoutTx"><span class="hs-identifier hs-var hs-var">observeFanoutTx</span></a></span></span><span> </span><span id="local-6989586621680314840"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314840"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680314841"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314841"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1098"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680314842"><span class="annot"><span class="annottext">inputUTxO :: UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314842"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314840"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314841"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1099"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680314843"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314843"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314844"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314844"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314842"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314845"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-1100"></span><span>  </span><span id="local-6989586621680314846"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680314846"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314844"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-1101"></span><span>  </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314841"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314843"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-1102"></span><span>    </span><span class="annot"><span class="annottext">Maybe Input
-&gt; (Input -&gt; Maybe FanoutObservation) -&gt; Maybe FanoutObservation
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1103"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Fanout</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FanoutObservation -&gt; Maybe FanoutObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-type">FanoutObservation</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">HeadId
$sel:headId:FanoutObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AFanoutObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1104"></span><span>      </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe FanoutObservation
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1105"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1106"></span><span>  </span><span id="local-6989586621680314845"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621680314845"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-1107"></span><span>
</span><span id="line-1108"></span><span class="hs-keyword">newtype</span><span> </span><span id="AbortObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-var">AbortObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AbortObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-var">AbortObservation</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AheadId%3AAbortObservation"><span class="annot"><span class="annottext">AbortObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AAbortObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680314850"><span id="local-6989586621680314853"><span class="annot"><span class="annottext">AbortObservation -&gt; AbortObservation -&gt; Bool
(AbortObservation -&gt; AbortObservation -&gt; Bool)
-&gt; (AbortObservation -&gt; AbortObservation -&gt; Bool)
-&gt; Eq AbortObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: AbortObservation -&gt; AbortObservation -&gt; Bool
== :: AbortObservation -&gt; AbortObservation -&gt; Bool
$c/= :: AbortObservation -&gt; AbortObservation -&gt; Bool
/= :: AbortObservation -&gt; AbortObservation -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314856"><span id="local-6989586621680314860"><span id="local-6989586621680314863"><span class="annot"><span class="annottext">Int -&gt; AbortObservation -&gt; ShowS
[AbortObservation] -&gt; ShowS
AbortObservation -&gt; String
(Int -&gt; AbortObservation -&gt; ShowS)
-&gt; (AbortObservation -&gt; String)
-&gt; ([AbortObservation] -&gt; ShowS)
-&gt; Show AbortObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; AbortObservation -&gt; ShowS
showsPrec :: Int -&gt; AbortObservation -&gt; ShowS
$cshow :: AbortObservation -&gt; String
show :: AbortObservation -&gt; String
$cshowList :: [AbortObservation] -&gt; ShowS
showList :: [AbortObservation] -&gt; ShowS
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314866"><span id="local-6989586621680314868"><span class="annot"><span class="annottext">(forall x. AbortObservation -&gt; Rep AbortObservation x)
-&gt; (forall x. Rep AbortObservation x -&gt; AbortObservation)
-&gt; Generic AbortObservation
forall x. Rep AbortObservation x -&gt; AbortObservation
forall x. AbortObservation -&gt; Rep AbortObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. AbortObservation -&gt; Rep AbortObservation x
from :: forall x. AbortObservation -&gt; Rep AbortObservation x
$cto :: forall x. Rep AbortObservation x -&gt; AbortObservation
to :: forall x. Rep AbortObservation x -&gt; AbortObservation
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1109"></span><span>
</span><span id="line-1110"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680314872"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-type">AbortObservation</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1111"></span><span>  </span><span id="local-6989586621680314891"><span class="annot"><span class="annottext">arbitrary :: Gen AbortObservation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen AbortObservation
forall a.
(Generic a, GA UnsizedOpts (Rep a),
 UniformWeight (Weights_ (Rep a))) =&gt;
Gen a
</span><span class="hs-identifier hs-var">genericArbitrary</span></span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span class="hs-comment">-- | Identify an abort tx by looking up the input spending the Head output and</span><span>
</span><span id="line-1114"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-1115"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeAbortTx"><span class="hs-identifier hs-type">observeAbortTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1116"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-1117"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1118"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1119"></span><span>  </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-type">AbortObservation</span></a></span><span>
</span><span id="line-1120"></span><span id="observeAbortTx"><span class="annot"><span class="annottext">observeAbortTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe AbortObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeAbortTx"><span class="hs-identifier hs-var hs-var">observeAbortTx</span></a></span></span><span> </span><span id="local-6989586621680314892"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314892"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680314893"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314893"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1121"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680314894"><span class="annot"><span class="annottext">inputUTxO :: UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314894"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314892"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314893"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1122"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680314895"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314895"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314896"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314896"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680314894"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall {lang}. PlutusScript lang
</span><a href="#local-6989586621680314897"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-1123"></span><span>  </span><span id="local-6989586621680314898"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680314898"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680314896"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-1124"></span><span>  </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680314893"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314895"><span class="hs-identifier hs-var">headInput</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Input
-&gt; (Input -&gt; Maybe AbortObservation) -&gt; Maybe AbortObservation
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1125"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.Abort</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AbortObservation -&gt; Maybe AbortObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(AbortObservation -&gt; Maybe AbortObservation)
-&gt; AbortObservation -&gt; Maybe AbortObservation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; AbortObservation
</span><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-var">AbortObservation</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680314898"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-1126"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe AbortObservation
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1127"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1128"></span><span>  </span><span id="local-6989586621680314897"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621680314897"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span class="annot"><span class="hs-comment">-- * Cardano specific identifiers</span></span><span>
</span><span id="line-1131"></span><span>
</span><span id="line-1132"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-type">mkHeadId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-1133"></span><span id="mkHeadId"><span class="annot"><span class="annottext">mkHeadId :: PolicyId -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-var hs-var">mkHeadId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HeadId
</span><a href="Hydra.HeadId.html#UnsafeHeadId"><span class="hs-identifier hs-var">UnsafeHeadId</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; HeadId)
-&gt; (PolicyId -&gt; ByteString) -&gt; PolicyId -&gt; HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; ByteString
forall a. SerialiseAsRawBytes a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">serialiseToRawBytes</span></span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-type">headIdToCurrencySymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CurrencySymbol</span></span><span>
</span><span id="line-1136"></span><span id="headIdToCurrencySymbol"><span class="annot"><span class="annottext">headIdToCurrencySymbol :: HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var hs-var">headIdToCurrencySymbol</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.HeadId.html#UnsafeHeadId"><span class="hs-identifier hs-type">UnsafeHeadId</span></a></span><span> </span><span id="local-6989586621680314901"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680314901"><span class="hs-identifier hs-var">headId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinByteString -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">CurrencySymbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; BuiltinByteString
forall a arep. ToBuiltin a arep =&gt; a -&gt; arep
</span><span class="hs-identifier hs-var">toBuiltin</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680314901"><span class="hs-identifier hs-var">headId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1137"></span><span>
</span><span id="line-1138"></span><span id="local-6989586621680309272"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#currencySymbolToHeadId"><span class="hs-identifier hs-type">currencySymbolToHeadId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.Fail.html#MonadFail"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680309272"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CurrencySymbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680309272"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span></span><span>
</span><span id="line-1139"></span><span id="currencySymbolToHeadId"><span class="annot"><span class="annottext">currencySymbolToHeadId :: forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#currencySymbolToHeadId"><span class="hs-identifier hs-var hs-var">currencySymbolToHeadId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PolicyId -&gt; HeadId) -&gt; m PolicyId -&gt; m HeadId
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-var">mkHeadId</span></a></span><span> </span><span class="annot"><span class="annottext">(m PolicyId -&gt; m HeadId)
-&gt; (CurrencySymbol -&gt; m PolicyId) -&gt; CurrencySymbol -&gt; m HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; m PolicyId
forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m PolicyId
</span><span class="hs-identifier hs-var">fromPlutusCurrencySymbol</span></span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span id="local-6989586621680309277"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#headIdToPolicyId"><span class="hs-identifier hs-type">headIdToPolicyId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.Fail.html#MonadFail"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680309277"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680309277"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span></span><span>
</span><span id="line-1142"></span><span id="headIdToPolicyId"><span class="annot"><span class="annottext">headIdToPolicyId :: forall (m :: * -&gt; *). MonadFail m =&gt; HeadId -&gt; m PolicyId
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToPolicyId"><span class="hs-identifier hs-var hs-var">headIdToPolicyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; m PolicyId
forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m PolicyId
</span><span class="hs-identifier hs-var">fromPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol -&gt; m PolicyId)
-&gt; (HeadId -&gt; CurrencySymbol) -&gt; HeadId -&gt; m PolicyId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span id="local-6989586621680309279"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#headSeedToTxIn"><span class="hs-identifier hs-type">headSeedToTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.Fail.html#MonadFail"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680309279"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadSeed"><span class="hs-identifier hs-type">HeadSeed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680309279"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span></span><span>
</span><span id="line-1145"></span><span id="headSeedToTxIn"><span class="annot"><span class="annottext">headSeedToTxIn :: forall (m :: * -&gt; *). MonadFail m =&gt; HeadSeed -&gt; m TxIn
</span><a href="Hydra.Chain.Direct.Tx.html#headSeedToTxIn"><span class="hs-identifier hs-var hs-var">headSeedToTxIn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.HeadId.html#UnsafeHeadSeed"><span class="hs-identifier hs-type">UnsafeHeadSeed</span></a></span><span> </span><span id="local-6989586621680314929"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680314929"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1146"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe TxIn
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><span class="hs-identifier hs-var">Aeson.decodeStrict</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680314929"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1147"></span><span>    </span><span class="annot"><span class="annottext">Maybe TxIn
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; m TxIn
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Control.Monad.Fail.html#fail"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m TxIn) -&gt; String -&gt; m TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to decode HeadSeed &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680314929"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-1148"></span><span>    </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680314932"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314932"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; m TxIn
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314932"><span class="hs-identifier hs-var">txIn</span></a></span><span>
</span><span id="line-1149"></span><span>
</span><span id="line-1150"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#txInToHeadSeed"><span class="hs-identifier hs-type">txInToHeadSeed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadSeed"><span class="hs-identifier hs-type">HeadSeed</span></a></span><span>
</span><span id="line-1151"></span><span id="txInToHeadSeed"><span class="annot"><span class="annottext">txInToHeadSeed :: TxIn -&gt; HeadSeed
</span><a href="Hydra.Chain.Direct.Tx.html#txInToHeadSeed"><span class="hs-identifier hs-var hs-var">txInToHeadSeed</span></a></span></span><span> </span><span id="local-6989586621680314934"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314934"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HeadSeed
</span><a href="Hydra.HeadId.html#UnsafeHeadSeed"><span class="hs-identifier hs-var">UnsafeHeadSeed</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; HeadSeed) -&gt; ByteString -&gt; HeadSeed
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall l s. LazyStrict l s =&gt; l -&gt; s
</span><span class="hs-identifier hs-var">toStrict</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">Aeson.encode</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680314934"><span class="hs-identifier hs-var">txin</span></a></span><span>
</span><span id="line-1152"></span><span>
</span><span id="line-1153"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#assetNameToOnChainId"><span class="hs-identifier hs-type">assetNameToOnChainId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.OnChainId.html#OnChainId"><span class="hs-identifier hs-type">OnChainId</span></a></span><span>
</span><span id="line-1154"></span><span id="assetNameToOnChainId"><span class="annot"><span class="annottext">assetNameToOnChainId :: AssetName -&gt; OnChainId
</span><a href="Hydra.Chain.Direct.Tx.html#assetNameToOnChainId"><span class="hs-identifier hs-var hs-var">assetNameToOnChainId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span> </span><span id="local-6989586621680314937"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680314937"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; OnChainId
</span><a href="Hydra.OnChainId.html#UnsafeOnChainId"><span class="hs-identifier hs-var">UnsafeOnChainId</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680314937"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#onChainIdToAssetName"><span class="hs-identifier hs-type">onChainIdToAssetName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.OnChainId.html#OnChainId"><span class="hs-identifier hs-type">OnChainId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span>
</span><span id="line-1157"></span><span id="onChainIdToAssetName"><span class="annot"><span class="annottext">onChainIdToAssetName :: OnChainId -&gt; AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#onChainIdToAssetName"><span class="hs-identifier hs-var hs-var">onChainIdToAssetName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; AssetName
</span><span class="hs-identifier hs-var">AssetName</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; AssetName)
-&gt; (OnChainId -&gt; ByteString) -&gt; OnChainId -&gt; AssetName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OnChainId -&gt; ByteString
forall a. SerialiseAsRawBytes a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">serialiseToRawBytes</span></span><span>
</span><span id="line-1158"></span><span>
</span><span id="line-1159"></span><span class="hs-comment">-- | Derive the 'OnChainId' from a Cardano 'PaymentKey'. The on-chain identifier</span><span>
</span><span id="line-1160"></span><span class="hs-comment">-- is the public key hash as it is also availble to plutus validators.</span><span>
</span><span id="line-1161"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#verificationKeyToOnChainId"><span class="hs-identifier hs-type">verificationKeyToOnChainId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.OnChainId.html#OnChainId"><span class="hs-identifier hs-type">OnChainId</span></a></span><span>
</span><span id="line-1162"></span><span id="verificationKeyToOnChainId"><span class="annot"><span class="annottext">verificationKeyToOnChainId :: VerificationKey PaymentKey -&gt; OnChainId
</span><a href="Hydra.Chain.Direct.Tx.html#verificationKeyToOnChainId"><span class="hs-identifier hs-var hs-var">verificationKeyToOnChainId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1163"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; OnChainId
</span><a href="Hydra.OnChainId.html#UnsafeOnChainId"><span class="hs-identifier hs-var">UnsafeOnChainId</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; OnChainId)
-&gt; (VerificationKey PaymentKey -&gt; ByteString)
-&gt; VerificationKey PaymentKey
-&gt; OnChainId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ByteString
forall arep a. FromBuiltin arep a =&gt; arep -&gt; a
</span><span class="hs-identifier hs-var">fromBuiltin</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinByteString -&gt; ByteString)
-&gt; (VerificationKey PaymentKey -&gt; BuiltinByteString)
-&gt; VerificationKey PaymentKey
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; BuiltinByteString
</span><span class="hs-identifier hs-var">getPubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(PubKeyHash -&gt; BuiltinByteString)
-&gt; (VerificationKey PaymentKey -&gt; PubKeyHash)
-&gt; VerificationKey PaymentKey
-&gt; BuiltinByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; PubKeyHash
</span><span class="hs-identifier hs-var">toPlutusKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(Hash PaymentKey -&gt; PubKeyHash)
-&gt; (VerificationKey PaymentKey -&gt; Hash PaymentKey)
-&gt; VerificationKey PaymentKey
-&gt; PubKeyHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span>
</span><span id="line-1164"></span><span>
</span><span id="line-1165"></span><span class="annot"><span class="hs-comment">-- * Helpers</span></span><span>
</span><span id="line-1166"></span><span>
</span><span id="line-1167"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#headTokensFromValue"><span class="hs-identifier hs-type">headTokensFromValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PlutusScript</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quantity</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1168"></span><span id="headTokensFromValue"><span class="annot"><span class="annottext">headTokensFromValue :: PlutusScript -&gt; Value -&gt; [(AssetName, Quantity)]
</span><a href="Hydra.Chain.Direct.Tx.html#headTokensFromValue"><span class="hs-identifier hs-var hs-var">headTokensFromValue</span></a></span></span><span> </span><span id="local-6989586621680314940"><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680314940"><span class="hs-identifier hs-var">headTokenScript</span></a></span></span><span> </span><span id="local-6989586621680314941"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680314941"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1169"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680314942"><span class="hs-identifier hs-var">assetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680314943"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetId</span></span><span> </span><span id="local-6989586621680314944"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314944"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621680314942"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680314942"><span class="hs-identifier hs-var">assetName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314943"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680314943"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; [(AssetId, Quantity)]
</span><span class="hs-identifier hs-var">valueToList</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680314941"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1171"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314944"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; PolicyId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Script PlutusScriptV2 -&gt; PolicyId
forall lang. Script lang -&gt; PolicyId
</span><span class="hs-identifier hs-var">scriptPolicyId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlutusScript -&gt; Script PlutusScriptV2
</span><span class="hs-identifier hs-var">PlutusScript</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680314940"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1172"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-1173"></span><span>
</span><span id="line-1174"></span><span class="annot"><span class="hs-comment">-- | Find first occurrence including a transformation.</span></span><span>
</span><span id="line-1175"></span><span id="local-6989586621680309202"><span id="local-6989586621680309203"><span id="local-6989586621680309204"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#findFirst"><span class="hs-identifier hs-type">findFirst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#Foldable"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680309202"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680309203"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680309204"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680309202"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680309203"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680309204"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-1176"></span><span id="findFirst"><span class="annot"><span class="annottext">findFirst :: forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Maybe b) -&gt; t a -&gt; Maybe b
</span><a href="Hydra.Chain.Direct.Tx.html#findFirst"><span class="hs-identifier hs-var hs-var">findFirst</span></a></span></span><span> </span><span id="local-6989586621680314952"><span class="annot"><span class="annottext">a -&gt; Maybe b
</span><a href="#local-6989586621680314952"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">First b -&gt; Maybe b
forall a. First a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Monoid.html#getFirst"><span class="hs-identifier hs-var">getFirst</span></a></span><span> </span><span class="annot"><span class="annottext">(First b -&gt; Maybe b) -&gt; (t a -&gt; First b) -&gt; t a -&gt; Maybe b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; First b) -&gt; t a -&gt; First b
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Foldable.html#foldMap"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe b -&gt; First b
forall a. Maybe a -&gt; First a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Monoid.html#First"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe b -&gt; First b) -&gt; (a -&gt; Maybe b) -&gt; a -&gt; First b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe b
</span><a href="#local-6989586621680314952"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1177"></span><span>
</span><span id="line-1178"></span><span id="local-6989586621680309298"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#findHeadAssetId"><span class="hs-identifier hs-type">findHeadAssetId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621680309298"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-1179"></span><span id="findHeadAssetId"><span class="annot"><span class="annottext">findHeadAssetId :: forall ctx. TxOut ctx -&gt; Maybe (PolicyId, AssetName)
</span><a href="Hydra.Chain.Direct.Tx.html#findHeadAssetId"><span class="hs-identifier hs-var hs-var">findHeadAssetId</span></a></span></span><span> </span><span id="local-6989586621680314960"><span class="annot"><span class="annottext">TxOut ctx
</span><a href="#local-6989586621680314960"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1180"></span><span>  </span><span class="annot"><span class="annottext">(((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
 -&gt; [(AssetId, Quantity)] -&gt; Maybe (PolicyId, AssetName))
-&gt; [(AssetId, Quantity)]
-&gt; ((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
-&gt; Maybe (PolicyId, AssetName)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
-&gt; [(AssetId, Quantity)] -&gt; Maybe (PolicyId, AssetName)
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Maybe b) -&gt; t a -&gt; Maybe b
</span><a href="Hydra.Chain.Direct.Tx.html#findFirst"><span class="hs-identifier hs-var">findFirst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; [(AssetId, Quantity)]
</span><span class="hs-identifier hs-var">valueToList</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [(AssetId, Quantity)]) -&gt; Value -&gt; [(AssetId, Quantity)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut ctx -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut ctx
</span><a href="#local-6989586621680314960"><span class="hs-identifier hs-var">txOut</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
 -&gt; Maybe (PolicyId, AssetName))
-&gt; ((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
-&gt; Maybe (PolicyId, AssetName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1181"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetId</span></span><span> </span><span id="local-6989586621680314962"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314962"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621680314963"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680314963"><span class="hs-identifier hs-var">aname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680314964"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680314964"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1182"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680314963"><span class="hs-identifier hs-var">aname</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; AssetName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680314964"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1183"></span><span>          </span><span class="annot"><span class="annottext">(PolicyId, AssetName) -&gt; Maybe (PolicyId, AssetName)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680314962"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680314963"><span class="hs-identifier hs-var">aname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1184"></span><span>    </span><span class="annot"><span class="annottext">(AssetId, Quantity)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1185"></span><span>      </span><span class="annot"><span class="annottext">Maybe (PolicyId, AssetName)
forall a. Maybe a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span class="annot"><span class="hs-comment">-- | Find (if it exists) the head identifier contained in given `TxOut`.</span></span><span>
</span><span id="line-1188"></span><span id="local-6989586621680309257"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-type">findStateToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621680309257"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.HeadId.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span></span><span>
</span><span id="line-1189"></span><span id="findStateToken"><span class="annot"><span class="annottext">findStateToken :: forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var hs-var">findStateToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1190"></span><span>  </span><span class="annot"><span class="annottext">((PolicyId, AssetName) -&gt; HeadId)
-&gt; Maybe (PolicyId, AssetName) -&gt; Maybe HeadId
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-var">mkHeadId</span></a></span><span> </span><span class="annot"><span class="annottext">(PolicyId -&gt; HeadId)
-&gt; ((PolicyId, AssetName) -&gt; PolicyId)
-&gt; (PolicyId, AssetName)
-&gt; HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(PolicyId, AssetName) -&gt; PolicyId
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (PolicyId, AssetName) -&gt; Maybe HeadId)
-&gt; (TxOut ctx -&gt; Maybe (PolicyId, AssetName))
-&gt; TxOut ctx
-&gt; Maybe HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/wqsa6d2n7mmdrj76zqk4d4pnm4mkjq8g-ghc-9.6.4-doc/share/doc/ghc-9.6.4/html/libraries/base-4.18.2.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut ctx -&gt; Maybe (PolicyId, AssetName)
forall ctx. TxOut ctx -&gt; Maybe (PolicyId, AssetName)
</span><a href="Hydra.Chain.Direct.Tx.html#findHeadAssetId"><span class="hs-identifier hs-var">findHeadAssetId</span></a></span><span>
</span><span id="line-1191"></span></pre></body></html>